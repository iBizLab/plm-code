!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,d(n.key),n)}}function n(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(){return o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},o.apply(this,arguments)}function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}function a(e){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=c(e);if(r){var i=c(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return function(e,r){if(r&&("object"===t(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}(this,n)}}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function s(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */s=function(){return r};var e,r={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},u=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(e){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof g?e:g,a=Object.create(o.prototype),u=new F(n||[]);return i(a,"_invoke",{value:D(t,r,u)}),a}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}r.wrap=h;var p="suspendedStart",v="suspendedYield",m="executing",y="completed",b={};function g(){}function w(){}function E(){}var x={};f(x,u,(function(){return this}));var O=Object.getPrototypeOf,j=O&&O(O(T([])));j&&j!==n&&o.call(j,u)&&(x=j);var I=E.prototype=g.prototype=Object.create(x);function k(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function C(e,r){function n(i,a,u,c){var s=d(e[i],e,a);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==t(f)&&o.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,u,c)}),(function(t){n("throw",t,u,c)})):r.resolve(f).then((function(t){l.value=t,u(l)}),(function(t){return n("throw",t,u,c)}))}c(s.arg)}var a;i(this,"_invoke",{value:function(t,e){function o(){return new r((function(r,o){n(t,e,r,o)}))}return a=a?a.then(o,o):o()}})}function D(t,r,n){var o=p;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=P(u,n);if(c){if(c===b)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var s=d(t,r,n);if("normal"===s.type){if(o=n.done?y:v,s.arg===b)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function P(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,P(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var i=d(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,b;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function F(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function T(r){if(r||""===r){var n=r[u];if(n)return n.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var i=-1,a=function t(){for(;++i<r.length;)if(o.call(r,i))return t.value=r[i],t.done=!1,t;return t.value=e,t.done=!0,t};return a.next=a}}throw new TypeError(t(r)+" is not iterable")}return w.prototype=E,i(I,"constructor",{value:E,configurable:!0}),i(E,"constructor",{value:w,configurable:!0}),w.displayName=f(E,l,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,f(t,l,"GeneratorFunction")),t.prototype=Object.create(I),t},r.awrap=function(t){return{__await:t}},k(C.prototype),f(C.prototype,c,(function(){return this})),r.AsyncIterator=C,r.async=function(t,e,n,o,i){void 0===i&&(i=Promise);var a=new C(h(t,e,n,o),i);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(I),f(I,l,"Generator"),f(I,u,(function(){return this})),f(I,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=T,F.prototype={constructor:F,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return u.type="throw",u.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),s=o.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),L(r),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:T(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),b}},r}function l(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(s){return void r(s)}u.done?e(c):Promise.resolve(c).then(n,o)}function f(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){l(i,n,o,a,u,"next",t)}function u(t){l(i,n,o,a,u,"throw",t)}a(void 0)}))}}function h(t,e,r){return(e=d(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function d(e){var r=function(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,r||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===t(r)?r:String(r)}System.register(["@ibiz-template/vue3-util","@ibiz-template/runtime","vue","ramda","@ibiz-template/core","lodash-es"],(function(t,r){"use strict";var l,d,p,v,m,y,b,g,w,E,x,O,j,I,k,C,D,P,N,L,F;return{setters:[function(t){l=t.getDataPickerProps,d=t.getEditorEmits,p=t.useNamespace,v=t.renderString,m=t.withInstall},function(t){y=t.EditorController,b=t.getDeACMode,g=t.ScriptFactory,w=t.registerEditorProvider},function(t){E=t.defineComponent,x=t.ref,O=t.computed,j=t.watch,I=t.onBeforeMount,k=t.createVNode,C=t.resolveComponent},function(t){D=t.isNil,P=t.clone,N=t.mergeDeepLeft},function(t){L=t.RuntimeModelError},function(t){F=t.cloneDeep}],execute:function(){var r=E({name:"DynamicTreeSelect",props:l(),emits:d(),setup:function(t,e){var r=e.emit,n=p("picker-dropdown"),o=t.controller,i=x(""),a=x([]),u=x(!1),c=x(""),l=x(!1),d=x(),m=O((function(){return!(!t.controlParams||"hover"!==t.controlParams.editmode)}));j((function(){return t.value}),(function(e){if(e||null===e){"OBJECT"===o.model.valueType?i.value=e?e[o.objectNameField]:null:i.value=e,null===e&&(i.value=""),c.value=i.value;var r=t.data[o.valueItem];if(-1!==o.copyData.findIndex((function(t){return Object.is(t[o.keyName],r)})))return;a.value=[],D(e)||D(r)||a.value.push(h(h({},o.textName,e),o.keyName,r))}}),{immediate:!0}),j((function(){return t.data[o.valueItem]}),(function(t,e){t!==e&&(c.value=t,null===t&&r("change",null))}),{immediate:!0,deep:!0});var y=function(t){t?l.value=t:setTimeout((function(){l.value=t}),100)},b=x(!1),g=function(){var t=f(s().mark((function t(e){var n,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.calcFillDataItems(e);case 2:(n=t.sent).length&&n.forEach((function(t){r("change",t.value,t.id)})),i=P(e),Object.assign(i,h(h({},o.keyName,i[o.keyName]?i[o.keyName]:i.srfkey),o.textName,i[o.textName]?i[o.textName]:i.srfmajortext)),o.valueItem&&r("change",i[o.keyName],o.valueItem),"OBJECT"===o.model.valueType?r("change",o.handleObjectParams(i)):r("change",e[o.textName]),y(!1);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),w=null,E=function(){var e=f(s().mark((function e(r){var n,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.value){e.next=2;break}return e.abrupt("return");case 2:if(!o.model.appDataEntityId||!1!==b.value){e.next=21;break}return b.value=!0,e.prev=4,n="",r!==t.value&&(n=r.trim()),e.next=9,o.getServiceData(n,t.data);case 9:(i=e.sent)&&(a.value=i.data);case 11:if(e.prev=11,b.value=!1,null==w){e.next=18;break}return c=w,w=null,e.next=18,E(c);case 18:return e.finish(11);case 19:e.next=22;break;case 21:w=r;case 22:case"end":return e.stop()}}),e,null,[[4,,11,19]])})));return function(t){return e.apply(this,arguments)}}(),k=O((function(){return v(i.value)}));j(k,(function(t,e){t!==e&&r("infoTextChange",t)}),{immediate:!0});return I((function(){t.data&&o.valueItem&&t.data[o.valueItem]&&!t.value&&(u.value=!0,a.value=[],E(""))})),{ns:n,c:o,refValue:c,curValue:i,valueText:k,loading:b,items:a,onOpenChange:function(t){t&&(u.value=!0,a.value=[],E(""))},onClear:function(){var t=o.dataItems;null!=t&&t.length&&t.forEach((function(t){r("change",null,t.id)})),o.valueItem&&r("change",null,o.valueItem),r("change",null)},onSelect:function(t){var e=o.copyData.findIndex((function(e){return Object.is(e[o.keyName],t)}));e>=0&&g(o.copyData[e]),u.value=!1},onSearch:E,onFocus:function(t){u.value=!0,r("focus",t),y(!0)},onBlur:function(t){u.value=!1,r("blur",t),y(!1)},onClick:function(){u.value=!0},handleKeyUp:function(t){t&&"Enter"===t.code&&r("enter",t)},editorRef:d,isEditable:l,setEditable:y,showFormDefaultContent:m,customNodeClass:function(t,e){var r;return null!==(r=t.children)&&void 0!==r&&r.length?n.e("branch-node"):null}}},render:function(){var t=this,e=this.readonly?this.value:k(C("el-tree-select"),{ref:"editorRef",modelValue:this.curValue,"onUpdate:modelValue":function(e){return t.curValue=e},clearable:!0,class:[this.ns.b("select")],popperClass:this.ns.b("select-pop"),filterable:!0,teleported:!this.showFormDefaultContent,data:this.items,"check-strictly":!0,multiple:this.c.multiple,placeholder:this.c.placeHolder?this.c.placeHolder:" ",disabled:this.disabled,onBlur:this.onBlur,onVisibleChange:this.onOpenChange,onFocus:this.onFocus,onKeyup:this.handleKeyUp,onChange:this.onSelect,props:{class:this.customNodeClass}},null),r=k("div",{class:(this.ns.b(),this.ns.m("readonly"))},[this.valueText]),n=k("div",{class:this.ns.b("form-default-content")},[this.curValue?this.valueText:"-"]);return k("div",{class:[this.ns.b(),this.disabled?this.ns.m("disabled"):"",this.readonly?this.ns.m("readonly"):"",this.ns.is("editable",this.isEditable),this.ns.is("show-default",this.showFormDefaultContent)]},[this.showFormDefaultContent&&n,this.readonly?r:e])}}),T=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e)}(v,t);var r,l,d,p=a(v);function v(){var t;e(this,v);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return h(u(t=p.call.apply(p,[this].concat(n))),"multiple",!1),h(u(t),"pickupView",null),h(u(t),"linkView",null),h(u(t),"valueItem",""),h(u(t),"keyName","srfkey"),h(u(t),"textName","srfmajortext"),h(u(t),"interfaceName",""),h(u(t),"sort",""),h(u(t),"noAC",!1),h(u(t),"noButton",!1),h(u(t),"deACMode",void 0),h(u(t),"dataItems",[]),h(u(t),"objectIdField",""),h(u(t),"objectNameField",""),h(u(t),"objectValueField",""),h(u(t),"filterMap",{label:"name",value:"id"}),h(u(t),"copyData",[]),h(u(t),"url",""),h(u(t),"method","post"),h(u(t),"pvalue","pid"),t}return n(v,[{key:"onInit",value:(d=f(s().mark((function t(){var e,r,n,i,a,u,l,f,h=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o(c(v.prototype),"onInit",this).call(this),this.initParams(),this.valueItem=(null===(e=this.model.valueItemName)||void 0===e?void 0:e.toLowerCase())||"",!this.model.appDataEntityId){t.next=10;break}if(this.model.appDEDataSetId&&(this.interfaceName=this.model.appDEDataSetId),!this.model.appDEACModeId){t.next=10;break}return t.next=8,b(this.model.appDEACModeId,this.model.appDataEntityId,this.context.srfappid);case 8:this.deACMode=t.sent,this.deACMode&&(a=this.deACMode,u=a.minorSortAppDEFieldId,l=a.minorSortDir,u&&l&&(this.sort="".concat(u.toLowerCase(),",").concat(l.toLowerCase())),this.deACMode.textAppDEFieldId&&(this.textName=this.deACMode.textAppDEFieldId),this.deACMode.valueAppDEFieldId&&(this.keyName=this.deACMode.valueAppDEFieldId),this.deACMode.deacmodeDataItems&&(this.dataItems=[],this.deACMode.deacmodeDataItems.forEach((function(t){"value"!==t.id&&"text"!==t.id&&h.dataItems.push(t)}))));case 10:if(this.objectIdField=null===(r=this.model.objectIdField)||void 0===r?void 0:r.toLowerCase(),this.objectNameField=null===(n=this.model.objectNameField)||void 0===n?void 0:n.toLowerCase(),this.objectValueField=null===(i=this.model.objectValueField)||void 0===i?void 0:i.toLowerCase(),this.pvalue=this.editorParams.PVALUE,this.url=this.editorParams.URL,this.method=this.editorParams.METHOD||"post",this.editorParams&&Object.prototype.hasOwnProperty.call(this.editorParams,"FILTERMAP"))try{f=JSON.parse(this.editorParams.FILTERMAP),Object.assign(this.filterMap,f)}catch(s){this.filterMap={label:"name",value:"id"}}case 17:case"end":return t.stop()}}),t,this)}))),function(){return d.apply(this,arguments)})},{key:"initParams",value:function(){switch(this.model.editorType){case"PICKEREX_NOAC":case"PICKEREX_NOAC_LINK":this.noAC=!0;break;case"PICKEREX_NOBUTTON":this.noButton=!0;break;default:this.noButton=!1,this.noAC=!1}}},{key:"getServiceData",value:(l=f(s().mark((function t(e,r){var n,o,i,a,u,c,l,f;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.handlePublicParams(r,this.context,this.params),o=n.context,i=n.params,a={},this.sort&&!Object.is(this.sort,"")&&Object.assign(a,{sort:this.sort}),e&&Object.assign(a,{query:e}),Object.assign(a,{size:1e3}),u=N(i,a),c={},Object.assign(c,{method:this.method,data:u}),!(l=g.execScriptFn({data:r,context:o,params:i},this.url,{singleRowReturn:!0,isAsync:!1}))){t.next=15;break}return t.next=12,ibiz.net.request(l,c);case 12:return(f=t.sent).data=this.handleTreeData(f),t.abrupt("return",f);case 15:throw new L(this.model,"请配置实体和实体数据集");case 16:case"end":return t.stop()}}),t,this)}))),function(t,e){return l.apply(this,arguments)})},{key:"calcFillDataItems",value:(r=f(s().mark((function t(e){var r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.deACMode){t.next=7;break}if(0!==this.dataItems.length){t.next=3;break}return t.abrupt("return",[]);case 3:return t.next=5,Promise.all(this.dataItems.map((function(t){var r=e[t.appDEFieldId];return t.format||t.convertToCodeItemText&&t.codeListId||t.customCode,{id:t.id,value:r}})));case 5:return r=t.sent,t.abrupt("return",r);case 7:return t.abrupt("return",[]);case 8:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"handleObjectParams",value:function(t){var e={};return this.objectIdField&&Object.assign(e,h({},this.objectIdField,t[this.keyName])),this.objectNameField&&Object.assign(e,h({},this.objectNameField,t[this.textName])),this.objectValueField&&Object.assign(e,h({},this.objectValueField,P(t))),e}},{key:"handleTreeData",value:function(t){var e=this;return t.data?(t.data.forEach((function(t){Object.keys(e.filterMap).forEach((function(r){t[r]=t[e.filterMap[r]]}))})),this.copyData=F(t.data),this.pvalue?this.prepareTreeData(t.data):t.data):[]}},{key:"prepareTreeData",value:function(t){var e=this.filterMap.value,r=this.pvalue,n={},o=[];return t.forEach((function(t){n[t[e]]=t})),t.forEach((function(t){var i=n[t[r]];i?(i.children=i.children||[],i.children.push(n[t[e]])):o.push(n[t[e]])})),o}}]),v}(y),S=function(){function t(){e(this,t),h(this,"component","DynamicTreeSelect"),h(this,"formEditor","DynamicTreeSelect"),h(this,"gridEditor","DynamicTreeSelect")}var r;return n(t,[{key:"createController",value:(r=f(s().mark((function t(e,r){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new T(e,r),t.next=3,n.init();case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)}))),function(t,e){return r.apply(this,arguments)})}]),t}(),A=t("IBizDynamicTreeSelect",m(r,(function(t){t.component(r.name,r),w("EDITOR_CUSTOMSTYLE_MODEL_SELECT",(function(){return new S}))})));t("default",{install:function(t){t.use(A)}})}}}))}();
