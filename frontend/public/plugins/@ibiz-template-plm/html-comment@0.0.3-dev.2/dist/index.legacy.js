!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){return t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},t.apply(this,arguments)}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function r(t){var n=s();return function(){var r,a=l(t);if(n){var o=l(this).constructor;r=Reflect.construct(a,arguments,o)}else r=a.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return i(t)}(this,r)}}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e){var t="function"==typeof Map?new Map:void 0;return a=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return o(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),u(n,e)},a(e)}function o(e,t,n){return o=s()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&u(i,n.prototype),i},o.apply(null,arguments)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function c(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,g(r.key),r)}}function f(e,t,n){return t&&v(e.prototype,t),n&&v(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t,n){return(t=g(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,n||"default");if("object"!==e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"===e(n)?n:String(n)}function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}(e,t)||b(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=b(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function b(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function x(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */x=function(){return n};var t,n={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(t){c=function(e,t,n){return e[t]=n}}function d(e,t,n,r){var i=t&&t.prototype instanceof y?t:y,o=Object.create(i.prototype),s=new I(r||[]);return a(o,"_invoke",{value:O(e,n,s)}),o}function v(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=d;var f="suspendedStart",h="suspendedYield",p="executing",m="completed",g={};function y(){}function w(){}function b(){}var k={};c(k,s,(function(){return this}));var C=Object.getPrototypeOf,E=C&&C(C(A([])));E&&E!==r&&i.call(E,s)&&(k=E);var S=b.prototype=y.prototype=Object.create(k);function P(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function L(t,n){function r(a,o,s,u){var l=v(t[a],t,o);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==e(d)&&i.call(d,"__await")?n.resolve(d.__await).then((function(e){r("next",e,s,u)}),(function(e){r("throw",e,s,u)})):n.resolve(d).then((function(e){c.value=e,s(c)}),(function(e){return r("throw",e,s,u)}))}u(l.arg)}var o;a(this,"_invoke",{value:function(e,t){function i(){return new n((function(n,i){r(e,t,n,i)}))}return o=o?o.then(i,i):i()}})}function O(e,n,r){var i=f;return function(a,o){if(i===p)throw new Error("Generator is already running");if(i===m){if("throw"===a)throw o;return{value:t,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var u=M(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===f)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var l=v(e,n,r);if("normal"===l.type){if(i=r.done?m:h,l.arg===g)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=m,r.method="throw",r.arg=l.arg)}}}function M(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,M(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var a=v(i,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var o=a.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function F(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(F,this),this.reset(!0)}function A(n){if(n||""===n){var r=n[s];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var a=-1,o=function e(){for(;++a<n.length;)if(i.call(n,a))return e.value=n[a],e.done=!1,e;return e.value=t,e.done=!0,e};return o.next=o}}throw new TypeError(e(n)+" is not iterable")}return w.prototype=b,a(S,"constructor",{value:b,configurable:!0}),a(b,"constructor",{value:w,configurable:!0}),w.displayName=c(b,l,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},n.awrap=function(e){return{__await:e}},P(L.prototype),c(L.prototype,u,(function(){return this})),n.AsyncIterator=L,n.async=function(e,t,r,i,a){void 0===a&&(a=Promise);var o=new L(d(e,t,r,i),a);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},P(S),c(S,l,"Generator"),c(S,s,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=A,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),N(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},n}function C(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(r,i)}function E(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){C(a,r,i,o,s,"next",e)}function s(e){C(a,r,i,o,s,"throw",e)}o(void 0)}))}}System.register(["vue","@ibiz-template/runtime","@ibiz-template/vue3-util","@wangeditor/editor-for-vue","@wangeditor/editor","qx-util","ramda","@ibiz-template/core","element-plus","lodash-es"],(function(e,o){"use strict";var s,u,v,h,g,b,k,C,S,P,L,O,M,F,N,I,A,R,T,H,D,U,j,z,B,q,V,_,J,Z,$,G,Q,K,Y,W,X,ee,te,ne,re,ie;return{setters:[function(e){s=e.defineComponent,u=e.ref,v=e.shallowRef,h=e.watch,g=e.onBeforeUnmount,b=e.onMounted,k=e.createVNode,C=e.resolveComponent,S=e.createTextVNode,P=e.nextTick,L=e.onUnmounted,O=e.computed,M=e.withDirectives,F=e.resolveDirective,N=e.h,I=e.defineAsyncComponent},function(e){A=e.ScriptFactory,R=e.convertNavData,T=e.EditorController,H=e.ControllerEvent,D=e.registerEditorProvider},function(e){U=e.getHtmlProps,j=e.getEditorEmits,z=e.useNamespace,B=e.withInstall},function(e){q=e.Editor,V=e.Toolbar},function(e){_=e.SlateEditor,J=e.SlateElement,Z=e.Boot,$=e.DomEditor},function(e){G=e.getCookie,Q=e.createUUID},function(e){K=e.isNil},function(e){Y=e.CoreConst,W=e.awaitTimeout,X=e.RuntimeError,ee=e.listenJSEvent,te=e.NOOP,ne=e.downloadFileFromBlob},function(e){re=e.ElMessageBox},function(e){ie=e.debounce}],execute:function(){var o=s({name:"IBizHtmlContent",props:U(),emits:j(),setup:function(e,t){var n=t.emit,r=z("html"),i=e.controller,a=u(),o=u({}),s=0,l=u(),c=u(),d=v(),f=u(),p=u(""),L=u({Authorization:"Bearer ".concat(G(Y.TOKEN))}),O=u(""),M=u(""),F=u(!0),N=u(!1),I=u(!1),R=u(!1),T=u(!1),H=u(""),D=u([]),U=i.model;U.editorParams&&(U.editorParams.enableEdit&&(N.value=!0,I.value=!0,F.value=i.toBoolean(U.editorParams.enableEdit)&&!e.readonly&&!e.disabled),U.editorParams.enableFullScreen&&(R.value=i.toBoolean(U.editorParams.enableFullScreen)));var j=function(e){if(d.value){var t=e.eventArg;t&&(d.value.setHtml(t),n("focus"))}},B=function(){d.value&&(d.value.blur(),d.value.setHtml(""))},Z=function(){d.value&&n("focus")};i.evt.on("setHtml",j),i.evt.on("clear",B),i.evt.on("onSetReply",Z),h((function(){return e.data}),(function(e){if(e){var t=ibiz.util.file.calcFileUpDownUrl(i.context,i.params,e);O.value=t.uploadUrl,M.value=t.downloadUrl}}),{immediate:!0,deep:!0});var $=function(e,t){if(t)return!0},Q=function(e){return e},W={toolbarKeys:[{key:"group-add-style",title:"添加",iconSvg:'<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fit="" height="1em" width="1em" preserveAspectRatio="xMidYMid meet" focusable="false"><g id="arvaction/plus-circle-fill" stroke-width="1" fill-rule="evenodd"><path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16zm-.6-8.6H4v1.2h3.4V12h1.2V8.6H12V7.4H8.6V4H7.4v3.4z" id="arv形状结合"></path></g></svg>',menuKeys:["attachments","codesnippet","page"]},"|",{key:"group-inline-style",title:"文本格式",iconSvg:'<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fit="" height="1em" width="1em" preserveAspectRatio="xMidYMid meet" focusable="false"><g id="ahdeditor/color-tt" stroke-width="1" fill-rule="evenodd"><path id="ahdsecondary-color" d="M1.999 15.011h11.998V13.81H1.999z"></path><path d="M6.034 7.59h4.104L8.086 2.297 6.034 7.59zm-.465 1.2l-1.437 3.707H2.845L7.301 1h1.287l-.001.004h.286l4.454 11.492h-1.288L10.603 8.79H5.569z" id="ahd合并形状"></path></g></svg>',menuKeys:["bold","italic","underline","through","code","numberedList","bulletedList","insertLink"]},"codeBlock","mention","marker","emotion"]},X={placeholder:i.placeHolder,readOnly:N.value?I.value:e.readonly,MENU_CONF:{uploadImage:{server:O.value,fieldName:"file",maxFileSize:10485760,maxNumberOfFiles:10,allowedFileTypes:[],headers:L.value,withCredentials:!0,onBeforeUpload:function(e){return e},onProgress:function(e){console.log("progress",e)},onSuccess:function(e,t){console.log("".concat(e.name," 上传成功"),t)},onFailed:function(e,t){console.log("".concat(e.name," 上传失败"),t)},onError:function(e,t,n){console.log("".concat(e.name," 上传出错"),t,n)},customInsert:function(e,t){return E(x().mark((function n(){var r,i;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=M.value.replace("%fileId%",e.id),i=e.filename,t(r,i,"");case 3:case"end":return n.stop()}}),n)})))()}},insertLink:{checkLink:$,parseLinkUrl:Q},editLink:{checkLink:$,parseLinkUrl:Q}}},ee=function(){var e=E(x().mark((function e(t){var n,r,i,a,o,s,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.src,I.value)te(n);else if(r=_.nodes(d.value,{match:function(e){return!(!J.isElement(e)||"image"!==e.type)},universal:!0}),r){i=w(r);try{for(i.s();!(a=i.n()).done;)o=a.value,s=y(o,1),"image"===(u=s[0]).type&&n.endsWith(u.src)&&te(u.src)}catch(l){i.e(l)}finally{i.f()}}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=E(x().mark((function e(t){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.value=t,D.value=[t],e.next=4,P();case 4:f.value&&(n=f.value.$refs.container)&&n.children[0].click();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ne=function(e){if(f.value){var t=f.value.$refs.container;if(t){var n=t.querySelector(".el-image-viewer__wrapper");null==n||n[e]("keydown",ie)}}},ie=function(){var e=E(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Escape"!==t.key&&27!==t.keyCode){e.next=7;break}return t.stopPropagation(),t.preventDefault(),e.next=5,P();case 5:ne("removeEventListener"),D.value=[];case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=E(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P();case 2:ne("addEventListener");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();g((function(){var e=d.value;null!=e&&e.destroy()}));var oe=function(t){d.value=t,t.setHtml(p.value),i.onCreated(d.value,e.data,W)},se=function(t){var r=t.getHtml();!function(e){var t=e.getEditableContainer();t&&t.querySelectorAll("img").forEach((function(e){e.onclick=function(e){var t=e.target;t&&ee(t)}}))}(t);var a="<p><br></p>"===r?"":r;a===e.value||""===a&&K(e.value)||N.value||(n("change",a),i.evt.emit("onChange",{eventArg:a}))},ue=function(e){i.onDestroyed(),i.evt.off("setHtml",j),i.evt.off("clear",B),i.evt.off("onSetReply",Z)},le=function(){n("focus"),i.evt.emit("onFocus",{eventArg:e.value})},ce=function(){n("blur"),i.evt.emit("onBlur",{eventArg:e.value})},de=function(e,t){alert("【自定义提示】".concat(t," - ").concat(e))},ve=function(e,t,n){n(!0)},fe=function(){var e=d.value;null!=e&&e.disable()},he=function(){var e=d.value;null!=e&&e.enable()},pe=function(){I.value=!I.value,I.value?fe():(he(),d.value.focus(),function(){if(e.value){var t=e.value.indexOf("</p>");if(t>=0){var n,r,i=null===(n=d.value.selection.anchor)||void 0===n?void 0:n.offset,a=null===(r=d.value.selection.anchor)||void 0===r?void 0:r.path;0===i&&a.length>0&&0===a[0]&&d.value.move(t-3)}}}())},me=function(){T.value=!T.value,P((function(){I.value?fe():(he(),d.value.focus())}))},ge=function(){if(i.reply.value){var e=A.execScriptFn({value:i.reply.value},i.replyScript,{singleRowReturn:!0,isAsync:!1});return k("div",{class:r.b("reply")},[k("div",{class:r.be("reply","content"),innerHTML:e},null),k(C("ion-icon"),{name:"close-outline",onClick:function(){return i.removeReply()}},null)])}};return b((function(){!function(){if(a.value&&l.value){var e=a.value.offsetHeight;new ResizeObserver((function(t){var n=t[0].contentRect.height;if(n!==s){var i={height:"".concat(e-t[0].contentRect.height,"px")};o.value=r.cssVarBlock(i),s=n}})).observe(l.value.selector)}}(),h((function(){return e.value}),(function(t,n){t===n||"string"!=typeof e.value&&null!=t||(p.value=null==t?"":t)}),{immediate:!0}),h((function(){return e.disabled}),(function(e,t){e!==t&&(!0===e?fe():he())}),{immediate:!0})})),{ns:r,editorRef:d,previewRef:f,mode:"default",valueHtml:p,toolbarConfig:W,editorConfig:X,handleCreated:oe,handleChange:se,handleDestroyed:ue,handleFocus:le,handleBlur:ce,customAlert:de,customPaste:ve,insertText:function(e){var t=d.value;null!=t&&t.insertText(e)},printHtml:function(){var e=d.value;null!=e&&console.log(e.getHtml())},disable:fe,enable:he,renderHeaserToolbar:function(){return N.value||R.value?k("div",{class:r.b("custom-toolbar")},[N.value&&F.value&&I.value?k("i",{class:"fa fa-edit","aria-hidden":"true",onClick:function(){return pe()}},null):null,R.value?T.value?k("i",{class:"fa fa-compress","aria-hidden":"true",onClick:function(){return me()}},null):k("i",{class:"fa fa-expand","aria-hidden":"true",onClick:function(){return me()}},null):null]):null},renderEditorContent:function(){return i.hidden.value?null:k("div",{class:r.b("content"),ref:"htmlContent",style:o.value},[k(q,{ref:"htmlRef",class:r.b("editor"),modelValue:p.value,"onUpdate:modelValue":function(e){return p.value=e},"default-config":X,mode:"default",onOnCreated:oe,onOnChange:se,onOnDestroyed:ue,onOnFocus:le,onOnBlur:ce,oncustomAlert:de,oncustomPaste:ve},null),ge(),k(V,{ref:"toolbarRef",editor:d.value,"default-config":W,mode:"default",class:r.b("toolbar")},null)])},renderFooter:function(){return N.value?k("div",{class:[r.b("footer"),m({},r.b("footer-dialog"),T.value)]},[k("div",{class:r.be("footer","cancel"),onClick:function(){e.value!==p.value?re({title:"确认取消",type:"warning",customClass:r.b("message"),message:k("div",{class:r.be("message","message-content")},[k("p",null,[S("确定要取消编辑吗？")]),k("p",{class:r.bem("message","message-content","message-tip")},[S("取消编辑将无法保存修改的内容，且不能找回。")])]),showCancelButton:!0,cancelButtonClass:r.be("message","message-cancel"),confirmButtonClass:r.be("message","message-comfire")}).then((function(){if(e.value){var t=i.parseNode(e.value);p.value=t}else p.value="";pe()})).catch((function(){d.value.focus()})):pe()}},[S("取消")]),k("div",{class:r.be("footer","save"),onClick:function(){return I.value=!0,d.value.disable(),n("change",p.value),void(T.value&&(T.value=!1))}},[S("保存")])]):null},htmlContent:a,hasEnableEdit:N,cssVars:o,toolbarRef:l,htmlRef:c,isFullScreen:T,readonlyState:I,changeFullScreenState:me,renderPreview:function(){return k(C("el-image"),{class:r.e("preview"),ref:"previewRef","zoom-rate":1.1,src:H.value,"preview-src-list":D.value,"hide-on-click-modal":!0,onShow:ae,fit:"cover"},null)}}},render:function(){var e=this;return this.isFullScreen?k(C("el-dialog"),{modelValue:this.isFullScreen,"onUpdate:modelValue":function(t){return e.isFullScreen=t},width:"80%",top:"10vh",class:this.ns.b("dialog-full-screen"),onClose:function(){return e.changeFullScreenState()}},{default:function(){return[k("div",{class:[e.ns.b(),m({},e.ns.b("editor-readonly"),e.readonlyState)]},[e.renderHeaserToolbar(),e.renderEditorContent(),e.hasEnableEdit&&!e.readonlyState?e.renderFooter():null])]}}):k("div",{class:[this.ns.b(),m({},this.ns.b("editor-readonly"),this.readonlyState)]},[this.renderHeaserToolbar(),this.renderEditorContent(),this.renderPreview(),this.hasEnableEdit&&!this.readonlyState?this.renderFooter():null])}}),ae=Object.freeze(Object.defineProperty({__proto__:null,default:o},Symbol.toStringTag,{value:"Module"})),oe=s({name:"IBizHtmlCollapse",props:U(),emits:j(),setup:function(e,t){var n=t.emit,r=z("html"),i=e.controller,a=u(),o=u({}),s=null,l=0,c=u(),d=v(),f=u(),O=u(),M=u(""),F=u({Authorization:"Bearer ".concat(G(Y.TOKEN))}),N=u(""),I=u(""),A=u(!0),R=u(!1),T=u(!1),H=u(!1),D=u(!1),U=u(!0),j=u(!1),B=u(""),Z=u([]),$=i.model;$.editorParams&&($.editorParams.enableEdit&&(R.value=!0,T.value=!0,A.value=i.toBoolean($.editorParams.enableEdit)&&!e.readonly&&!e.disabled),$.editorParams.enableFullScreen&&(H.value=i.toBoolean($.editorParams.enableFullScreen))),h((function(){return e.data}),(function(e){if(e){var t=ibiz.util.file.calcFileUpDownUrl(i.context,i.params,e,i.editorParams);N.value=t.uploadUrl,I.value=t.downloadUrl}}),{immediate:!0,deep:!0});var Q=function(e,t){if(t)return!0},X=function(e){return e},ee={excludeKeys:["group-video"],insertKeys:{index:66,keys:["marker"]}},te={placeholder:i.placeHolder,readOnly:R.value?T.value:e.readonly,MENU_CONF:{uploadImage:{server:N.value,fieldName:"file",maxFileSize:10485760,maxNumberOfFiles:10,allowedFileTypes:[],headers:F.value,withCredentials:!0,onBeforeUpload:function(e){return e},onProgress:function(e){console.log("progress",e)},onSuccess:function(e,t){console.log("".concat(e.name," 上传成功"),t)},onFailed:function(e,t){console.log("".concat(e.name," 上传失败"),t)},onError:function(e,t,n){console.log("".concat(e.name," 上传出错"),t,n)},customInsert:function(e,t){return E(x().mark((function n(){var r,i;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=I.value.replace("%fileId%",e.id),i=e.filename,t(r,i,"");case 3:case"end":return n.stop()}}),n)})))()}},insertLink:{checkLink:Q,parseLinkUrl:X},editLink:{checkLink:Q,parseLinkUrl:X}}};g((function(){var e=d.value;null!=e&&e.destroy()}));var ne=function(){var e=E(x().mark((function e(t){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.maxHeight&&(n=t.getEditableContainer(),j.value=n.offsetHeight>i.maxHeight);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=E(x().mark((function e(t){var n,r,i,a,o,s,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.src,T.value)ae(n);else if(r=_.nodes(d.value,{match:function(e){return!(!J.isElement(e)||"image"!==e.type)},universal:!0}),r){i=w(r);try{for(i.s();!(a=i.n()).done;)o=a.value,s=y(o,1),"image"===(u=s[0]).type&&n.endsWith(u.src)&&ae(u.src)}catch(l){i.e(l)}finally{i.f()}}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=E(x().mark((function e(t){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B.value=t,Z.value=[t],e.next=4,P();case 4:O.value&&(n=O.value.$refs.container)&&n.children[0].click();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oe=function(e){if(O.value){var t=O.value.$refs.container;if(t){var n=t.querySelector(".el-image-viewer__wrapper");null==n||n[e]("keydown",se)}}},se=function(){var e=E(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Escape"!==t.key&&27!==t.keyCode){e.next=7;break}return t.stopPropagation(),t.preventDefault(),e.next=5,P();case 5:oe("removeEventListener"),Z.value=[];case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=E(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P();case 2:oe("addEventListener");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),le=function(t){d.value=t,i.onCreated(d.value,e.data,ee);var n=i.parseNode(M.value);t.setHtml(n)},ce=function(t){var r=t.getHtml();ne(t),function(e){var t=e.getEditableContainer();t&&t.querySelectorAll("img").forEach((function(t){t.onload=function(){ne(e)},t.onclick=function(e){var t=e.target;t&&ie(t)}}))}(t);var a="<p><br></p>"===r?"":r;a===e.value||""===a&&K(e.value)||(!R.value&&t.isFocused()&&n("change",a),i.evt.emit("onChange",{eventArg:a}))},de=function(e){i.onDestroyed()},ve=function(t){n("focus"),i.evt.emit("onFocus",{eventArg:e.value})},fe=function(t){n("blur"),i.evt.emit("onBlur",{eventArg:e.value})},he=function(e,t){alert("【自定义提示】".concat(t," - ").concat(e))},pe=function(e,t,n){n(!0)},me=function(){var e=d.value;null!=e&&e.disable()},ge=function(){var e=d.value;null!=e&&e.enable()};b((function(){h((function(){return e.value}),(function(t,n){t===n||"string"!=typeof e.value&&null!=t||(M.value=null==t?"":t)}),{immediate:!0}),h((function(){return e.disabled}),(function(e,t){e!==t&&(!0===e?me():ge())}),{immediate:!0})}));var ye=function(){if(T.value=!T.value,T.value){if(f.value)f.value.$refs.box.scroll(0,0);me()}else ge(),d.value.focus(),function(){if(e.value){var t=e.value.indexOf("</p>");if(t>=0){var n,r,i=null===(n=d.value.selection.anchor)||void 0===n?void 0:n.offset,a=null===(r=d.value.selection.anchor)||void 0===r?void 0:r.path;0===i&&a.length>0&&0===a[0]&&d.value.move(t-3)}}}(),U.value=!0},we=function(){D.value=!D.value,U.value=!D.value,P((function(){T.value?me():(ge(),d.value.focus())}))};return b((function(){W(0,(function(){if(a.value&&c.value){var e=a.value.offsetHeight;(s=new ResizeObserver((function(t){var n=t[0].contentRect.height;if(n!==l){var i={height:"".concat(e-t[0].contentRect.height,"px")};o.value=r.cssVarBlock(i),l=n}}))).observe(c.value.selector)}}))})),L((function(){s&&s.disconnect()})),{ns:r,editorRef:d,previewRef:O,htmlRef:f,mode:"default",valueHtml:M,toolbarConfig:ee,editorConfig:te,handleCreated:le,handleChange:ce,handleDestroyed:de,handleFocus:ve,handleBlur:fe,customAlert:he,customPaste:pe,insertText:function(e){var t=d.value;null!=t&&t.insertText(e)},printHtml:function(){var e=d.value;null!=e&&console.log(e.getHtml())},disable:me,enable:ge,renderHeaserToolbar:function(){return R.value||H.value?k("div",{class:r.b("custom-toolbar")},[R.value&&A.value&&T.value?k("i",{class:"fa fa-edit","aria-hidden":"true",onClick:function(){return ye()}},null):null,H.value?D.value?k("i",{class:"fa fa-compress","aria-hidden":"true",onClick:function(){return we()}},null):k("i",{class:"fa fa-expand","aria-hidden":"true",onClick:function(){return we()}},null):null]):null},renderEditorContent:function(){var e=p({},o.value);return U.value&&i.maxHeight&&Object.assign(e,{maxHeight:"".concat(i.maxHeight,"px")}),k("div",{class:r.b("content"),ref:"htmlContent",style:e},[k(V,{ref:"toolbarRef",editor:d.value,"default-config":ee,mode:"default",class:r.b("toolbar")},null),k(q,{ref:"htmlRef",class:r.b("editor"),modelValue:M.value,"onUpdate:modelValue":function(e){return M.value=e},"default-config":te,mode:"default",onOnCreated:le,onOnChange:ce,onOnDestroyed:de,onOnFocus:ve,onOnBlur:fe,oncustomAlert:he,oncustomPaste:pe},null)])},renderToggle:function(){return j.value?U.value?k("div",{class:r.e("toggle"),onClick:function(){U.value=!U.value}},[S("展开更多 "),k(C("ion-icon"),{name:"arrow-down-outline"},null)]):k("div",{class:r.e("toggle"),onClick:function(){U.value=!U.value}},[S("收起更多 "),k(C("ion-icon"),{name:"arrow-up-outline"},null)]):null},renderFooter:function(){return R.value?k("div",{class:[r.b("footer"),m({},r.b("footer-dialog"),D.value)]},[k("div",{class:r.be("footer","cancel"),onClick:function(){e.value!==M.value?re({title:"确认取消",type:"warning",customClass:r.b("message"),message:k("div",{class:r.be("message","message-content")},[k("p",null,[S("确定要取消编辑吗？")]),k("p",{class:r.bem("message","message-content","message-tip")},[S("取消编辑将无法保存修改的内容，且不能找回。")])]),showCancelButton:!0,cancelButtonClass:r.be("message","message-cancel"),confirmButtonClass:r.be("message","message-comfire")}).then((function(){if(e.value){var t=i.parseNode(e.value);M.value=t}else M.value="";ye()})).catch((function(){d.value.focus()})):ye()}},[S("取消")]),k("div",{class:r.be("footer","save"),onClick:function(){return T.value=!0,d.value.disable(),n("change",M.value),void(D.value&&(D.value=!1))}},[S("保存")])]):null},htmlContent:a,hasEnableEdit:R,cssVars:o,toolbarRef:c,isFullScreen:D,readonlyState:T,collapse:U,changeFullScreenState:we,renderPreview:function(){return k(C("el-image"),{class:r.e("preview"),ref:"previewRef","zoom-rate":1.1,src:B.value,"preview-src-list":Z.value,"hide-on-click-modal":!0,onShow:ue,fit:"cover"},null)}}},render:function(){var e=this;return this.isFullScreen?k(C("el-dialog"),{modelValue:this.isFullScreen,"onUpdate:modelValue":function(t){return e.isFullScreen=t},width:"80%",top:"10vh",class:this.ns.b("dialog-full-screen"),onClose:function(){return e.changeFullScreenState()}},{default:function(){return[k("div",{class:[e.ns.b(),e.ns.b("collapse"),m({},e.ns.b("editor-readonly"),e.readonlyState)]},[e.renderHeaserToolbar(),e.renderEditorContent(),e.hasEnableEdit&&!e.readonlyState?e.renderFooter():null])]}}):k("div",{class:[this.ns.b(),this.ns.is("allow-collapse",!0),m({},this.ns.b("editor-readonly"),this.readonlyState)]},[this.renderHeaserToolbar(),this.renderEditorContent(),this.readonlyState?this.renderToggle():null,this.hasEnableEdit&&!this.readonlyState?this.renderFooter():null,this.renderPreview()])}}),se=s({name:"HtmlComment",props:U(),emits:j(),setup:function(e,t){var n=t.emit,r=z("html-comment"),i=e.controller,a=u(),o=u();return{ns:r,c:i,comment:a,editorRef:o,onChange:function(e){n("change",e),e&&i.collapsed.value&&(i.collapsed.value=!1)},onFocus:function(){i.collapsed.value=!1,n("focus")},onBlur:function(){if(n("blur"),e.value)return null;i.collapsed.value=!0},renderAvatar:function(){var e=i.stringToHexColor(i.context.srfusername),t=i.avatarName(i.context.srfusername);return i.context.srfusername?k("div",{class:r.e("avatar-name"),style:"background: ".concat(e,";")},[t]):k(C("el-avatar"),{class:r.e("avatar"),src:"./assets/images/user-avatar.png"},null)}}},render:function(){return"default"===this.c.mode?k(oe,{controller:this.c,data:this.data,value:this.value,onChange:this.onChange,onFocus:this.onFocus,onBlur:this.onBlur},null):k("div",{ref:"comment",class:[this.ns.b(),this.ns.is("collapse",this.c.collapsed.value)],style:{height:"".concat(this.c.collapsed.value?this.c.minHeight:this.c.maxHeight,"px")}},[this.renderAvatar(),k(o,{controller:this.c,data:this.data,value:this.value,onChange:this.onChange,onFocus:this.onFocus,onBlur:this.onBlur},null)])}});function ue(e,t,n,r,i){return{sel:e,data:t,children:n,text:r,elm:i,key:void 0===t?void 0:t.key}}var le=Array.isArray;function ce(e){return"string"==typeof e||"number"==typeof e||e instanceof String||e instanceof Number}function de(e,t,n){if(e.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==t)for(var r=0;r<t.length;++r){var i=t[r];if("string"!=typeof i){var a=i.data;void 0!==a&&de(a,i.children,i.sel)}}}function ve(e,t,n){var r,i,a,o={};if(void 0!==n?(null!==t&&(o=t),le(n)?r=n:ce(n)?i=n.toString():n&&n.sel&&(r=[n])):null!=t&&(le(t)?r=t:ce(t)?i=t.toString():t&&t.sel?r=[t]:o=t),void 0!==r)for(a=0;a<r.length;++a)ce(r[a])&&(r[a]=ue(void 0,void 0,void 0,r[a],void 0));return"s"!==e[0]||"v"!==e[1]||"g"!==e[2]||3!==e.length&&"."!==e[3]&&"#"!==e[3]||de(o,r,e),ue(e,o,r,i,void 0)}var fe={type:"attachments",elemToHtml:function(e){var t=e.script,n=void 0===t?"":t,r=e.data,i=void 0===r?{}:r,a=A.execScriptFn({data:i},n,{singleRowReturn:!0,isAsync:!1});return"".concat(a)}};var he={selector:'span[data-w-e-type="attachments"]',parseElemHtml:function(e){var t=decodeURIComponent(e.getAttribute("data-value")||""),n=JSON.parse(t);return{type:"attachments",script:n.script,data:n,children:[{text:""}]}}};var pe={type:"attachments",renderElem:function(e){var t=e.data,n=void 0===t?{}:t,r={name:"".concat(n.name),id:n.id};return ve("mention-elem",{dataset:{value:JSON.stringify(r)},props:{contentEditable:!1}},[])}},me=function(){function e(){d(this,e),m(this,"title","本地文件"),m(this,"tag","button"),m(this,"iconSvg",'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36px" height="36px" viewBox="0 0 36 36" version="1.1">\n    <title>附件</title>\n    <g id="附件" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="icon">\n            <rect id="矩形" stroke="#EEEEEE" fill="#FFFFFF" x="0.5" y="0.5" width="35" height="35" rx="4"/>\n            <g id="编组-28" transform="translate(2.997929, 8.001508)">\n                <path d="M13.9611058,12.6330155 C13.9611058,14.5460163 12.4108408,16.0968098 10.498492,16.0968098 C8.58614322,16.0968098 7.03587822,14.5460163 7.03590808,12.6393438 L7.03590808,12.6393438 L6.98338468,7.07669061 C6.97992133,6.70644889 7.27712693,6.40347538 7.64724246,6.39998034 C8.017358,6.39648531 8.32022824,6.69379224 8.32372209,7.06403396 L8.32372209,7.06403396 L8.37624485,12.6330155 C8.37624485,13.8054998 9.32640727,14.7559862 10.498492,14.7559862 C11.6705768,14.7559862 12.6207392,13.8054998 12.6207392,12.6330155 L12.6207392,12.6330155 L12.6207392,6.46506253 C12.6207392,4.69957562 11.0562006,3.24725012 9.10227678,3.24725012 C7.148353,3.24725012 5.58381437,4.69957562 5.58381437,6.46506253 L5.58381437,6.46506253 L5.58381437,12.8655397 C5.58381437,15.5621365 7.78332719,17.7497339 10.498492,17.7497339 C13.2136568,17.7497339 15.4131697,15.5621365 15.4131697,12.8655397 L15.4131697,12.8655397 L15.4131697,7.10001026 C15.4131697,6.72975204 15.713221,6.42959845 16.083353,6.42959845 C16.453485,6.42959845 16.7535363,6.72975204 16.7535363,7.10001026 L16.7535363,7.10001026 L16.7535363,12.8655397 C16.7535363,16.3043913 13.9521943,19.0905575 10.498492,19.0905575 C7.04478976,19.0905575 4.24344774,16.3043913 4.24344774,12.8655397 L4.24344774,12.8655397 L4.24344774,6.46506253 C4.24344774,3.93573556 6.42955024,1.90642651 9.10227678,1.90642651 C11.7750033,1.90642651 13.9611058,3.93573556 13.9611058,6.46506253 L13.9611058,6.46506253 Z" id="形状结合" fill="#DDDDDD" transform="translate(10.498492, 10.498492) rotate(-315.000000) translate(-10.498492, -10.498492) "/>\n                <path d="M21.6662931,9.87797441 L24.6096402,9.87797441 C24.9410111,9.87797441 25.2096402,10.1466036 25.2096402,10.4779744 C25.2096402,10.8093453 24.9410111,11.0779744 24.6096402,11.0779744 L21.6662931,11.0779744 C21.3349223,11.0779744 21.0662931,10.8093453 21.0662931,10.4779744 C21.0662931,10.1466036 21.3349223,9.87797441 21.6662931,9.87797441 Z" id="矩形备份-74" fill="#73D897"/>\n                <path d="M21.6662931,4.29120933 L27.4020707,4.29120933 C27.7334415,4.29120933 28.0020707,4.55983848 28.0020707,4.89120933 C28.0020707,5.22258018 27.7334415,5.49120933 27.4020707,5.49120933 L21.6662931,5.49120933 C21.3349223,5.49120933 21.0662931,5.22258018 21.0662931,4.89120933 C21.0662931,4.55983848 21.3349223,4.29120933 21.6662931,4.29120933 Z" id="矩形备份-75" fill="#6698FF"/>\n                <path d="M21.6662931,15.4647395 L27.4020707,15.4647395 C27.7334415,15.4647395 28.0020707,15.7333686 28.0020707,16.0647395 C28.0020707,16.3961103 27.7334415,16.6647395 27.4020707,16.6647395 L21.6662931,16.6647395 C21.3349223,16.6647395 21.0662931,16.3961103 21.0662931,16.0647395 C21.0662931,15.7333686 21.3349223,15.4647395 21.6662931,15.4647395 Z" id="矩形备份-77" fill="#FF7575"/>\n            </g>\n        </g>\n    </g>\n</svg>')}return f(e,[{key:"isActive",value:function(e){return!1}},{key:"getValue",value:function(e){return""}},{key:"isDisabled",value:function(e){return!1}},{key:"exec",value:function(e,t){throw new X("暂未支持上传本地文件！")}}]),e}(),ge={renderElems:[pe],elemsToHtml:[fe],parseElemsHtml:[he],menus:[{key:"attachments",factory:function(){return new me}}]},ye=function(){function e(){d(this,e),m(this,"model",void 0),m(this,"context",void 0),m(this,"params",void 0),m(this,"data",{}),m(this,"editor",void 0),m(this,"editorParams",void 0),m(this,"items",[]),m(this,"evt",void 0),m(this,"execting",!1),this.registerNode()}var t;return f(e,[{key:"registerNode",value:function(){window.attachmentsIsRegiter||(Z.registerModule(ge),window.attachmentsIsRegiter=!0)}},{key:"init",value:(t=E(x().mark((function e(t,n){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.model=n.model,this.context=n.context,this.params=n.params,this.evt=n.evt,this.data=n.data,this.editor=t,this.editorParams=this.model.editorParams;case 7:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"onDestroyed",value:function(){}},{key:"insertNode",value:function(e){}},{key:"parseNode",value:function(e){return e}}]),e}();var we={type:"codesnippet",elemToHtml:function(e){var t=e.script,n=void 0===t?"":t,r=e.data,i=void 0===r?{}:r,a=A.execScriptFn({data:i},n,{singleRowReturn:!0,isAsync:!1});return"".concat(a)}};var be={selector:'span[data-w-e-type="codesnippet"]',parseElemHtml:function(e){var t=decodeURIComponent(e.getAttribute("data-value")||""),n=JSON.parse(t);return{type:"codesnippet",script:n.script,data:n,children:[{text:""}]}}};var ke={type:"CodeSnippet",renderElem:function(e){var t=e.data,n=void 0===t?{}:t,r={name:"".concat(n.name),id:n.id};return ve("mention-elem",{dataset:{value:JSON.stringify(r)},props:{contentEditable:!1}},[])}},xe=function(){function e(){d(this,e),m(this,"title","代码段"),m(this,"tag","button"),m(this,"iconSvg",'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36px" height="36px" viewBox="0 0 36 36" version="1.1">\n  <title>代码段</title>\n  <g id="代码段" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n      <g id="icon备份">\n          <rect id="矩形" stroke="#EEEEEE" fill="#FFFFFF" x="0.5" y="0.5" width="35" height="35" rx="4"/>\n          <path d="M24.6642225,18.8794824 L27.6075695,18.8794824 C27.9389404,18.8794824 28.2075695,19.1481115 28.2075695,19.4794824 C28.2075695,19.8108532 27.9389404,20.0794824 27.6075695,20.0794824 L24.6642225,20.0794824 C24.3328516,20.0794824 24.0642225,19.8108532 24.0642225,19.4794824 C24.0642225,19.1481115 24.3328516,18.8794824 24.6642225,18.8794824 Z" id="矩形备份-74" fill="#73D897"/>\n          <path d="M24.6642225,13.2927173 L30.4,13.2927173 C30.7313708,13.2927173 31,13.5613465 31,13.8927173 C31,14.2240882 30.7313708,14.4927173 30.4,14.4927173 L24.6642225,14.4927173 C24.3328516,14.4927173 24.0642225,14.2240882 24.0642225,13.8927173 C24.0642225,13.5613465 24.3328516,13.2927173 24.6642225,13.2927173 Z" id="矩形备份-75" fill="#6698FF"/>\n          <path d="M24.6642225,24.4662475 L30.4,24.4662475 C30.7313708,24.4662475 31,24.7348766 31,25.0662475 C31,25.3976183 30.7313708,25.6662475 30.4,25.6662475 L24.6642225,25.6662475 C24.3328516,25.6662475 24.0642225,25.3976183 24.0642225,25.0662475 C24.0642225,24.7348766 24.3328516,24.4662475 24.6642225,24.4662475 Z" id="矩形备份-77" fill="#FF7575"/>\n          <g id="1.Base基础/1.icon图标/11.editor/header-1" transform="translate(5.000000, 11.000000)" fill="#DDDDDD">\n              <path d="M4.68266589,2.39258039 L1.51032474,7.44797324 L5.01586095,12.7216272 L4.05994646,13.3212428 L0.126424153,7.40475416 L3.68603474,1.72997946 L4.68266589,2.39258039 Z M11.3173341,12.6697762 L14.4896753,7.61438339 L10.984139,2.34072939 L11.9400535,1.7411138 L15.8735758,7.65760247 L12.3139653,13.3323772 L11.3173341,12.6697762 Z M8.86596086,1.31248434 L10.0376294,1.55020137 L7.19605832,13.6243456 L6.0243898,13.3866286 L8.86596086,1.31248434 Z" id="形状结合"/>\n          </g>\n      </g>\n  </g>\n</svg>')}return f(e,[{key:"isActive",value:function(e){return!1}},{key:"getValue",value:function(e){return""}},{key:"isDisabled",value:function(e){return!1}},{key:"exec",value:function(e,t){throw new X("暂未支持上传代码段！")}}]),e}(),Ce={renderElems:[ke],elemsToHtml:[we],parseElemsHtml:[be],menus:[{key:"codesnippet",factory:function(){return new xe}}]},Ee=function(){function e(){d(this,e),m(this,"model",void 0),m(this,"context",void 0),m(this,"params",void 0),m(this,"data",{}),m(this,"editor",void 0),m(this,"editorParams",void 0),m(this,"items",[]),m(this,"evt",void 0),m(this,"execting",!1),this.registerNode()}var t;return f(e,[{key:"registerNode",value:function(){window.codesnippetIsRegiter||(Z.registerModule(Ce),window.codesnippetIsRegiter=!0)}},{key:"init",value:(t=E(x().mark((function e(t,n){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.model=n.model,this.context=n.context,this.params=n.params,this.evt=n.evt,this.data=n.data,this.editor=t,this.editorParams=this.model.editorParams;case 7:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"onDestroyed",value:function(){}},{key:"insertNode",value:function(e){}},{key:"parseNode",value:function(e){return e}}]),e}();var Se={type:"marker",elemToHtml:function(e){var t=e.script,n=void 0===t?"":t,r=e.data,i=void 0===r?{}:r,a=A.execScriptFn({data:i},n,{singleRowReturn:!0,isAsync:!1});return"".concat(a)}};var Pe={selector:'span[data-w-e-type="marker"]',parseElemHtml:function(e){var t=decodeURIComponent(e.getAttribute("data-value")||""),n=JSON.parse(t);return{type:"marker",script:n.script,data:n,children:[{text:""}]}}};var Le={type:"marker",renderElem:function(e){var t=e.data,n=void 0===t?{}:t;return ve("mention-elem",{dataset:{value:JSON.stringify(n)},props:{contentEditable:!1}},[])}},Oe=function(){function e(){d(this,e),m(this,"title","提及工作项"),m(this,"tag","button"),m(this,"iconSvg",'<svg t="1706259772097" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6854" width="200" height="200"><path d="M929.28 625.664l-234.496 0.512 24.064-229.888 210.432-0.512c20.992 0 38.4-17.408 38.4-38.4s-17.408-38.4-38.4-38.4H727.04l29.184-275.456c2.048-20.992-13.312-39.936-34.304-41.984-20.992-2.048-39.936 13.312-41.984 34.304L650.24 318.976l-232.448 0.512 29.184-275.456c2.048-20.992-13.312-39.936-34.304-41.984-20.992-2.048-39.936 13.312-41.984 34.304l-29.696 283.648-246.272 0.512c-20.992 0-38.4 17.408-38.4 38.4s17.408 38.4 38.4 38.4l238.08-0.512-24.064 229.888-214.016 0.512c-20.992 0-38.4 17.408-38.4 38.4s17.408 38.4 38.4 38.4l205.824-0.512-29.184 276.992c-2.048 20.992 13.312 39.936 34.304 41.984h4.096c19.456 0 35.84-14.848 37.888-34.304l30.208-285.184 232.448-0.512-29.184 277.504c-2.048 20.992 13.312 39.936 34.304 41.984h4.096c19.456 0 35.84-14.848 38.4-34.304l30.208-285.184 242.688-0.512c20.992 0 38.4-17.408 38.4-38.4-1.536-20.992-18.944-37.888-39.936-37.888z m-544.256 0.512l24.064-229.888 232.448-0.512-24.064 229.888-232.448 0.512z" fill="#979797" p-id="6855"></path></svg>')}return f(e,[{key:"isActive",value:function(e){return!1}},{key:"getValue",value:function(e){return""}},{key:"isDisabled",value:function(e){return!1}},{key:"exec",value:function(e,t){e.insertText("#")}}]),e}(),Me={renderElems:[Le],elemsToHtml:[Se],parseElemsHtml:[Pe],menus:[{key:"marker",factory:function(){return new Oe}}]},Fe=s({name:"MenTion",props:{controller:{type:Object,required:!0},modal:{type:Object}},setup:function(e){var t=z("mention"),n=e.controller,r=u(!1),i=u([]),a=te,o=u({}),s=u(0),l=function(e){var t=e.eventArg;if(t){!t.includes("@")&&n.overlay&&n.execting&&n.overlay.dismiss();var r=t.match(/(?<=\@)([^\@&^{]*?)(?=\<)/g)||[];n.execting&&(0===r.length&&n.overlay.dismiss(),n.query=r.pop()||"",n.query&&/\s$/.test(n.query)?n.overlay.dismiss():n.query&&f({isInitialLoad:!0}))}else n.overlay&&n.execting&&n.overlay.dismiss()},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.value=!0,n.getUsers(e).then((function(t){var a;(200===t.status&&t.data||(r.value=!1),t.headers["x-total"]&&(s.value=Number(t.headers["x-total"])),!0===e.isLoadMore)?(a=i.value).push.apply(a,c(n.toUIData(t.data))):(i.value=n.toUIData(t.data),i.value.length>0&&(o.value=i.value[0]));r.value=!1})).catch((function(){r.value=!1}))},v=O((function(){return i.value.length>=s.value||r.value||s.value<=n.size})),f=ie(d,300,{leading:!0});n.evt&&n.evt.on("onChange",l),d({isInitialLoad:!0});var h=function(e){var t=i.value.findIndex((function(e){return e.id===o.value.id}));switch(e){case"up":-1!==--t&&-2!==t||(t=i.value.length-1),o.value=i.value[t];break;case"down":++t===i.value.length&&(t=0),o.value=i.value[t];break;case"enter":p(o.value)}},p=function(t){if(e.modal){var n,r={ok:!0,data:[t]};null===(n=e.modal)||void 0===n||n.dismiss(r)}};return b((function(){a=ee(window,"keyup",(function(e){40===e.keyCode?h("down"):38===e.keyCode?h("up"):13===e.keyCode&&h("enter")}))})),g((function(){a!==te&&a(),n.evt.off("onChange",l)})),{ns:t,items:i,loading:r,isLodeMoreDisabled:v,renderItem:function(e){var r=e.name,i=n.stringToHexColor(r),a=n.avatarName(r);return k("div",{class:[t.e("item"),t.is("active",e.id===o.value.id)],onClick:function(){return p(e)}},[k("div",{class:t.e("avatar"),style:"background: ".concat(i,";")},[a]),k("div",{class:t.e("name"),title:r},[r])])},loadMore:function(){d({isLoadMore:!0})}}},render:function(){var e=this;return M(k("div",{"infinite-scroll-distance":10,"infinite-scroll-disabled":this.isLodeMoreDisabled,"infinite-scroll-immediate":!1,class:this.ns.b()},[this.items.map((function(t){return e.renderItem(t)})),0===this.items.length&&k(C("iBizNoData"),{text:"暂未用户数据"},null)]),[[F("infinite-scroll"),function(){return e.loadMore()}],[F("loading"),this.loading]])}}),Ne=s({name:"Marker",props:{controller:{type:Object,required:!0},modal:{type:Object}},setup:function(e){var t=z("marker"),n=e.controller,r=u(!1),i=u([]),a=te,o=u({}),s=u(0),l=function(e){var t=e.eventArg;if(t){!t.includes("#")&&n.overlay&&n.execting&&n.overlay.dismiss();var r=t.replace(/<svg((.|[\t\r\f\n\s])+?)<\/svg>/g,"").match(/(?<=\#)([^\#&^{]*?)(?=\<)/g)||[];n.execting&&(0===r.length&&n.overlay.dismiss(),n.query=r.pop()||"",n.query&&/\s$/.test(n.query)?n.overlay.dismiss():n.query&&f({isInitialLoad:!0}))}else n.overlay&&n.execting&&n.overlay.dismiss()},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.value=!0,n.load(e).then((function(t){var a;(200===t.status&&t.data||(r.value=!1),t.headers["x-total"]&&(s.value=Number(t.headers["x-total"])),!0===e.isLoadMore)?(a=i.value).push.apply(a,c(n.toUIData(t.data))):(i.value=n.toUIData(t.data),i.value.length>0&&(o.value=i.value[0]));r.value=!1})).catch((function(){r.value=!1}))},v=O((function(){return i.value.length>=s.value||r.value||s.value<=n.size})),f=ie(d,300,{leading:!0});n.evt&&n.evt.on("onChange",l),d({isInitialLoad:!0});var h=function(e){var t=i.value.findIndex((function(e){return e.id===o.value.id}));switch(e){case"up":-1!==--t&&-2!==t||(t=i.value.length-1),o.value=i.value[t];break;case"down":++t===i.value.length&&(t=0),o.value=i.value[t];break;case"enter":p(o.value)}},p=function(t){if(e.modal){var n,r={ok:!0,data:[t]};null===(n=e.modal)||void 0===n||n.dismiss(r)}},m=function(e,t){if(n.quoteCodelistMap.has(e)){var r=n.quoteCodelistMap.get(e);return k(C("iBizCodeList"),{codeListItems:r.codeListItems,codeList:r.codeList,value:t},null)}return t};return b((function(){a=ee(window,"keyup",(function(e){40===e.keyCode?h("down"):38===e.keyCode?h("up"):13===e.keyCode&&h("enter")}))})),g((function(){a!==te&&a(),n.evt.off("onChange",l)})),{ns:t,items:i,loading:r,isLodeMoreDisabled:v,renderItem:function(e){return k("div",{class:[t.e("item"),t.is("active",e.id===o.value.id)],onClick:function(){return p(e)}},[k("div",{class:t.e("type")},[m("type",e.type)]),k("div",{class:t.e("identifier")},[m("identifier",e.identifier)]),k("div",{class:t.e("name"),title:e.name},[m("name",e.name)])])},loadMore:function(){d({isLoadMore:!0})}}},render:function(){var e=this;return M(k("div",{"infinite-scroll-distance":10,"infinite-scroll-disabled":this.isLodeMoreDisabled,"infinite-scroll-immediate":!1,class:this.ns.b()},[this.items.map((function(t){return e.renderItem(t)})),0===this.items.length&&k(C("iBizNoData"),{text:"暂未用户数据"},null)]),[[F("infinite-scroll"),function(){return e.loadMore()}],[F("loading"),this.loading]])}}),Ie=function(){function e(){d(this,e),m(this,"model",void 0),m(this,"context",void 0),m(this,"params",void 0),m(this,"data",{}),m(this,"editor",void 0),m(this,"quoteUrl",""),m(this,"quoteFieldMap",{id:"id",name:"name"}),m(this,"quoteCodelistMap",new Map),m(this,"quoteMethod","post"),m(this,"quoteParams",{}),m(this,"quoteScript","`#{id=${data.id},name=${data.name},identifier=${data.identifier},icon=${data.icon}}`"),m(this,"quoteInScript","value.replaceAll(/#{id=(.+?),name=(.+?),identifier=(.+?),icon=((.|[\\t\\r\\f\\n\\s])+?)}/g,(x, id, name, identifier, icon) => {return controller.getNodeInfo({ id, name, identifier, icon })})"),m(this,"editorParams",void 0),m(this,"items",[]),m(this,"overlay",null),m(this,"evt",void 0),m(this,"execting",!1),m(this,"query",""),m(this,"curPage",0),m(this,"size",20),m(this,"presetPreventEvents",[13,38,40]),m(this,"presetPreventPropEvents",[27]),m(this,"cleanup",te),this.registerNode()}var t,n,r,i;return f(e,[{key:"markerPlugin",value:function(e){var t=this,n=e.insertText,r=e.isInline,i=e.isVoid;return e.insertText=function(r){t.editor?t.editor.isFocused()?($.getSelectedElems(e).some((function(t){return e.isVoid(t)}))||"#"!==r||t.execting||(t.query="",t.showModal()),n(r)):n(r):n(r)},e.isInline=function(e){return"marker"===$.getNodeType(e)||r(e)},e.isVoid=function(e){return"marker"===$.getNodeType(e)||i(e)},e}},{key:"registerNode",value:function(){window.markerIsRegiter||(Z.registerModule(Me),window.markerIsRegiter=!0),Z.registerPlugin(this.markerPlugin.bind(this))}},{key:"init",value:(i=E(x().mark((function e(t,n){var r,i,a,o,s,u,l,c,d,v,f=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.model=n.model,this.context=n.context,this.params=n.params,this.evt=n.evt,this.data=n.data,this.editor=t,this.editorParams=this.model.editorParams,this.editorParams&&(r=this.editorParams,i=r.QUOTEURL,a=r.QUOTEFIELDMAP,o=r.QUOTEMETHOD,s=r.QUOTESCRIPT,u=r.QUOTEINSCRIPT,l=r.QUOTEPARAMS,c=r.QUOTECODELISTMAP,i&&(this.quoteUrl=i),a&&(this.quoteFieldMap=JSON.parse(a)),o&&(this.quoteMethod=o.toLowerCase()),l&&(this.quoteParams=JSON.parse(l)),s&&(this.quoteScript=s),u&&(this.quoteInScript=u),c&&(d=JSON.parse(c),this.setCodeListMap(d))),(v=this.editor.getEditableContainer())&&(this.cleanup=ee(v,"keydown",(function(e){var t;f.execting&&f.presetPreventEvents.includes(e.keyCode)&&e.preventDefault(),f.execting&&f.presetPreventPropEvents.includes(e.keyCode)&&(e.stopPropagation(),null===(t=f.overlay)||void 0===t||t.dismiss())})));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"onDestroyed",value:function(){this.cleanup!==te&&this.cleanup(),this.overlay&&this.overlay.dismiss()}},{key:"setCodeListMap",value:(r=E(x().mark((function e(t){var n,r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=x().keys(t);case 1:if((e.t1=e.t0()).done){e.next=9;break}return n=e.t1.value,e.next=5,this.loadCodeList(t[n]);case 5:(r=e.sent)&&this.quoteCodelistMap.set(n,r),e.next=1;break;case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"showModal",value:function(){var e=this;if(!this.quoteUrl)throw new X("未配置提及工作项QUOTEURL编辑器参数！");var t=document.getSelection();if(t){var n=t.focusNode;n&&this.openPopover(n.parentNode).then((function(t){t.length>0&&e.insertNode(t[0])}))}}},{key:"findCodeListItem",value:function(e,t){if(e){var n=e.find((function(e){return e.value==t}));if(n)return n;for(var r=0;r<e.length;r++){var i=this.findCodeListItem(e[r].children,t);if(i)return i}}}},{key:"insertNode",value:function(e){if(this.quoteCodelistMap.has("type")&&e.type){var t=this.quoteCodelistMap.get("type"),n=this.findCodeListItem(t.codeListItems,e.type);n&&n.sysImage&&Object.assign(e,{icon:n.sysImage.rawContent})}var r={type:"marker",script:this.quoteScript,data:e,children:[{text:""}]};this.editor.restoreSelection(),this.editor.deleteBackward("character");for(var i=0;i<this.query.length;i++)this.editor.deleteBackward("character");this.editor.insertNode(r),this.editor.move(1)}},{key:"getNodeInfo",value:function(e){return Object.assign(e,{script:this.quoteScript}),'<span data-w-e-type="marker" data-w-e-is-void data-w-e-is-inline data-value="'.concat(encodeURIComponent(JSON.stringify(e)),'"></span>')}},{key:"parseNode",value:function(e){return A.execScriptFn({value:e,controller:this},this.quoteInScript,{singleRowReturn:!0,isAsync:!1})}},{key:"handlePublicParams",value:function(e,t,n){var r=this.model,i=r.navigateContexts,a=r.navigateParams,o={};i&&e&&(o=R(i,e,n,t));var s=Object.assign(t.clone(),o),u={};return a&&e&&(u=R(a,e,n,t)),{context:s,params:u}}},{key:"load",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.handlePublicParams(this.data,this.context,this.params),n=t.context,r=t.params,i=!0===e.isInitialLoad,a=!0===e.isLoadMore;i?this.curPage=0:a&&(this.curPage+=1);var o=A.execScriptFn({data:this.data,context:n,params:r},this.quoteUrl,{singleRowReturn:!0,isAsync:!1}),s=p(p({},r),{},{query:this.query,size:this.size,page:this.curPage},this.quoteParams);return ibiz.net[this.quoteMethod](o,s)}},{key:"toUIData",value:function(e){var t=this;return e.map((function(e){var n={};return Object.keys(t.quoteFieldMap).forEach((function(r){n[r]=e[t.quoteFieldMap[r]]})),n}))}},{key:"openPopover",value:(n=E(x().mark((function e(t){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.overlay=ibiz.overlay.createPopover(this.createOverlayView(),void 0,{placement:"bottom-start",autoClose:!0,width:"300px",noArrow:!0}),e.next=3,this.overlay.present(t);case 3:return this.execting=!0,e.next=6,this.overlay.onWillDismiss();case 6:return n=e.sent,this.execting=!1,e.abrupt("return",n.data||[]);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"createOverlayView",value:function(){var e=this;return function(t){return N(Ne,{controller:e,modal:t})}}},{key:"loadCodeList",value:(t=E(x().mark((function e(t){var n,r,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ibiz.hub.getApp(this.context.srfappid),r=n.codeList.getCodeList(t),e.next=4,n.codeList.get(t,this.context,this.params);case 4:return i=e.sent,e.abrupt("return",{codeList:r,codeListItems:i});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();var Ae={type:"mention",elemToHtml:function(e){var t=e.script,n=void 0===t?"":t,r=e.data,i=void 0===r?{}:r,a=A.execScriptFn({data:i},n,{singleRowReturn:!0,isAsync:!1});return"".concat(a)}};var Re={selector:'span[data-w-e-type="mention"]',parseElemHtml:function(e){var t=decodeURIComponent(e.getAttribute("data-value")||""),n=JSON.parse(t);return{type:"mention",script:n.script,data:n,children:[{text:""}]}}};var Te={type:"mention",renderElem:function(e){var t=e.data,n=void 0===t?{}:t,r={name:"@".concat(n.name),id:n.id};return ve("mention-elem",{dataset:{value:JSON.stringify(r)},props:{contentEditable:!1}},[])}},He=function(){function e(){d(this,e),m(this,"title","提及成员"),m(this,"tag","button"),m(this,"iconSvg",'<svg t="1705979200437" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4218" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M23.7 555c0-339.3 247-550 533.8-550 295.6 0 442.8 165.9 442.8 401.6 0 210.8-93.5 361.7-237 361.7-63.6 0-108.5-26.2-137.2-78.6-48.6 51.1-96 79.8-174.6 79.8-116 0-178.4-77.3-178.4-193.3 0-209.5 131-323 251.9-323 64.9 0 102.3 24.9 122.2 68.6l11.2-58.6 114.7 1.2L727 510.1c-7.5 36.2-11.2 63.6-11.2 81.1 0 44.9 22.5 71.1 56.1 71.1 63.6 0 106-89.8 106-243.2 0-205.8-114.7-300.6-323-300.6-220.8 0-405.4 163.4-405.4 436.5 0 238.2 132.2 350.5 390.4 350.5 94.8 0 174.6-12.5 255.7-36.2v109.8c-88.6 26.2-177.1 39.9-263.2 39.9-329.1 0-508.7-168.4-508.7-464z m585-44.9c3.7-20 6.2-39.9 6.2-53.6 0-56.1-15-96-83.6-96-83.6 0-133.5 108.5-133.5 212 0 44.9 13.7 88.6 77.3 88.6 73.7-0.1 114.9-57.4 133.6-151z" fill="#333333" p-id="4219"></path></svg>')}return f(e,[{key:"isActive",value:function(e){return!1}},{key:"getValue",value:function(e){return""}},{key:"isDisabled",value:function(e){return!1}},{key:"exec",value:function(e,t){e.insertText("@")}}]),e}(),De={renderElems:[Te],elemsToHtml:[Ae],parseElemsHtml:[Re],menus:[{key:"mention",factory:function(){return new He}}]},Ue=function(){function e(){d(this,e),m(this,"model",void 0),m(this,"context",void 0),m(this,"params",void 0),m(this,"data",{}),m(this,"editor",void 0),m(this,"userUrl",""),m(this,"userFieldMap",{id:"id",name:"name"}),m(this,"userMethod","post"),m(this,"userScript","`@{userid=${data.id},name=${data.name}}`"),m(this,"userInScript","value.replaceAll(/@{userid=(.+?),name=(.+?)}/g,(x, id, name) => {return controller.getNodeInfo({ id, name })})"),m(this,"editorParams",void 0),m(this,"items",[]),m(this,"overlay",null),m(this,"evt",void 0),m(this,"execting",!1),m(this,"query",""),m(this,"curPage",0),m(this,"size",20),m(this,"presetPreventEvents",[13,38,40]),m(this,"presetPreventPropEvents",[27]),m(this,"cleanup",te),this.registerNode()}var t,n;return f(e,[{key:"mentionPlugin",value:function(e){var t=this,n=e.insertText,r=e.isInline,i=e.isVoid;return e.insertText=function(r){t.editor?t.editor.isFocused()?($.getSelectedElems(e).some((function(t){return e.isVoid(t)}))||"@"!==r||t.execting||(t.query="",t.showModal()),n(r)):n(r):n(r)},e.isInline=function(e){return"mention"===$.getNodeType(e)||r(e)},e.isVoid=function(e){return"mention"===$.getNodeType(e)||i(e)},e}},{key:"registerNode",value:function(){window.mentionIsRegiter||(Z.registerModule(De),window.mentionIsRegiter=!0),Z.registerPlugin(this.mentionPlugin.bind(this))}},{key:"init",value:(n=E(x().mark((function e(t,n){var r,i,a,o,s,u,l,c=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.model=n.model,this.context=n.context,this.params=n.params,this.evt=n.evt,this.data=n.data,this.editor=t,this.editorParams=this.model.editorParams,this.editorParams&&(r=this.editorParams,i=r.USERURL,a=r.USERFIELDMAP,o=r.USERMETHOD,s=r.USERSCRIPT,u=r.USERINSCRIPT,i&&(this.userUrl=i),a&&(this.userFieldMap=JSON.parse(a)),o&&(this.userMethod=o.toLowerCase()),s&&(this.userScript=s),u&&(this.userInScript=u)),(l=this.editor.getEditableContainer())&&(this.cleanup=ee(l,"keydown",(function(e){var t;c.execting&&c.presetPreventEvents.includes(e.keyCode)&&e.preventDefault(),c.execting&&c.presetPreventPropEvents.includes(e.keyCode)&&(e.stopPropagation(),null===(t=c.overlay)||void 0===t||t.dismiss())})));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"onDestroyed",value:function(){this.cleanup!==te&&this.cleanup(),this.overlay&&this.overlay.dismiss()}},{key:"showModal",value:function(){var e=this;if(!this.userUrl)throw new X("未配置提及用户USERURL编辑器参数！");var t=document.getSelection();if(t){var n=t.focusNode;n&&this.openUserPopover(n.parentNode).then((function(t){t.length>0&&e.insertNode(t[0])}))}}},{key:"insertNode",value:function(e){var t={type:"mention",script:this.userScript,data:e,children:[{text:""}]};this.editor.restoreSelection(),this.editor.deleteBackward("character");for(var n=0;n<this.query.length;n++)this.editor.deleteBackward("character");this.editor.insertNode(t),this.editor.move(1)}},{key:"getNodeInfo",value:function(e){return Object.assign(e,{script:this.userScript}),'<span data-w-e-type="mention" data-w-e-is-void data-w-e-is-inline data-value="'.concat(encodeURIComponent(JSON.stringify(e)),'"></span>')}},{key:"parseNode",value:function(e){return A.execScriptFn({value:e,controller:this},this.userInScript,{singleRowReturn:!0,isAsync:!1})}},{key:"getThemeVar",value:function(){var e=document.documentElement;return e?getComputedStyle(e).getPropertyValue("--ibiz-color-primary"):null}},{key:"isChineseCharacter",value:function(e){return/[\u4e00-\u9fa5]/.test(e)}},{key:"hasChineseAndEnglish",value:function(e){return/[\u4e00-\u9fa5]+.*[a-zA-Z]+|[a-zA-Z]+.*[\u4e00-\u9fa5]+/.test(e)}},{key:"stringToHexColor",value:function(e){if(!e)return"";for(var t=0,n=0;n<e.length;n++){if(this.isChineseCharacter(e))t=e.charCodeAt(n)+((t<<5)-t),t&=t;else t+=e.charCodeAt(n).toString(16)}var r=String(t).substring(0,6),i=parseInt(r.substring(0,2),16),a=parseInt(r.substring(2,4),16),o=parseInt(r.substring(4,6),16),s="#".concat(i.toString(16).padStart(2,"0")).concat(a.toString(16).padStart(2,"0")).concat(o.toString(16).padStart(2,"0"));return"#FFFFFF"===s&&this.getThemeVar()||s}},{key:"avatarName",value:function(e){if(e&&e.toString().length<2)return e;if(e&&e.toString().length>=2){if(this.hasChineseAndEnglish(e)){var t=e.split("").find((function(e){return/[a-zA-Z]/.test(e)}))||"",n=e.split("").find((function(e){return/[\u4E00-\u9FA5]/.test(e)}))||"";return"".concat(t).concat(n).toLowerCase()}return/[a-zA-Z]/.test(e)?e.split("").filter((function(e){return/[a-zA-Z]/.test(e)})).slice(0,2).join("").toUpperCase():/[\u4E00-\u9FA5]/.test(e)?e.split("").filter((function(e){return/[\u4E00-\u9FA5]/.test(e)})).slice(-2).join(""):e.replaceAll(" ","").substring(0,2)}}},{key:"handlePublicParams",value:function(e,t,n){var r=this.model,i=r.navigateContexts,a=r.navigateParams,o={};i&&e&&(o=R(i,e,n,t));var s=Object.assign(t.clone(),o),u={};return a&&e&&(u=R(a,e,n,t)),{context:s,params:u}}},{key:"getUsers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.handlePublicParams(this.data,this.context,this.params),n=t.context,r=t.params,i=!0===e.isInitialLoad,a=!0===e.isLoadMore;i?this.curPage=0:a&&(this.curPage+=1);var o=A.execScriptFn({data:this.data,context:n,params:r},this.userUrl,{singleRowReturn:!0,isAsync:!1}),s=p(p({},r),{},{query:this.query,size:this.size,page:this.curPage});return ibiz.net[this.userMethod](o,s)}},{key:"toUIData",value:function(e){var t=this;return e.map((function(e){var n={};return Object.keys(t.userFieldMap).forEach((function(r){n[r]=e[t.userFieldMap[r]]})),n}))}},{key:"openUserPopover",value:(t=E(x().mark((function e(t){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.overlay=ibiz.overlay.createPopover(this.createOverlayView(),void 0,{placement:"bottom-start",autoClose:!0,width:"300px",noArrow:!0}),e.next=3,this.overlay.present(t);case 3:return this.execting=!0,e.next=6,this.overlay.onWillDismiss();case 6:return n=e.sent,this.execting=!1,e.abrupt("return",n.data||[]);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"createOverlayView",value:function(){var e=this;return function(t){return N(Fe,{controller:e,modal:t})}}}]),e}();var je={type:"page",elemToHtml:function(e){var t=e.script,n=void 0===t?"":t,r=e.data,i=void 0===r?{}:r,a=A.execScriptFn({data:i},n,{singleRowReturn:!0,isAsync:!1});return"".concat(a)}};var ze={selector:'span[data-w-e-type="page"]',parseElemHtml:function(e){var t=decodeURIComponent(e.getAttribute("data-value")||""),n=JSON.parse(t);return{type:"page",script:n.script,data:n,children:[{text:""}]}}};var Be={type:"Page",renderElem:function(e){var t=e.data,n=void 0===t?{}:t,r={name:"".concat(n.name),id:n.id};return ve("mention-elem",{dataset:{value:JSON.stringify(r)},props:{contentEditable:!1}},[])}},qe=function(){function e(){d(this,e),m(this,"title","页面"),m(this,"tag","button"),m(this,"iconSvg",'<svg t="1707293566679" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6103" width="200" height="200"><path d="M288 512l256 0C561.92 512 576 497.92 576 480 576 462.08 561.92 448 544 448l-256 0C270.08 448 256 462.08 256 480 256 497.92 270.08 512 288 512zM768 64 192 64C121.6 64 64 121.6 64 192l0 576c0 70.4 57.6 128 128 128l576 0c70.4 0 128-57.6 128-128L896 192C896 121.6 838.4 64 768 64zM832 768c0 35.2-28.8 64-64 64L192 832c-35.2 0-64-28.8-64-64L128 192c0-35.2 28.8-64 64-64l576 0c35.2 0 64 28.8 64 64L832 768zM672 256l-384 0C270.08 256 256 270.08 256 288 256 305.92 270.08 320 288 320l384 0C689.92 320 704 305.92 704 288 704 270.08 689.92 256 672 256zM608 640l-320 0C270.08 640 256 654.08 256 672l0 0C256 689.92 270.08 704 288 704l320 0c17.92 0 32-14.08 32-32l0 0C640 654.08 625.92 640 608 640z" p-id="6104"></path></svg>')}return f(e,[{key:"isActive",value:function(e){return!1}},{key:"getValue",value:function(e){return""}},{key:"isDisabled",value:function(e){return!1}},{key:"exec",value:function(e,t){throw new X("暂未支持上传页面！")}}]),e}(),Ve={renderElems:[Be],elemsToHtml:[je],parseElemsHtml:[ze],menus:[{key:"page",factory:function(){return new qe}}]},_e=function(){function e(){d(this,e),m(this,"model",void 0),m(this,"context",void 0),m(this,"params",void 0),m(this,"data",{}),m(this,"editor",void 0),m(this,"editorParams",void 0),m(this,"items",[]),m(this,"evt",void 0),m(this,"execting",!1),this.registerNode()}var t;return f(e,[{key:"registerNode",value:function(){window.pageIsRegiter||(Z.registerModule(Ve),window.pageIsRegiter=!0)}},{key:"init",value:(t=E(x().mark((function e(t,n){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.model=n.model,this.context=n.context,this.params=n.params,this.evt=n.evt,this.data=n.data,this.editor=t,this.editorParams=this.model.editorParams;case 7:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"onDestroyed",value:function(){}},{key:"insertNode",value:function(e){}},{key:"parseNode",value:function(e){return e}}]),e}(),Je=function(){function e(){d(this,e)}return f(e,null,[{key:"init",value:function(e){var t=this;this.registerMap.set("mention",Ue),this.registerMap.set("marker",Ie),this.registerMap.set("attachments",ye),this.registerMap.set("codesnippet",Ee),this.registerMap.set("page",_e),this.presetNodes.forEach((function(n){t.registerPlugin({type:n,id:"".concat(n).concat(e)})}))}},{key:"registerPlugin",value:function(e){var t=e.type,n=e.id;if(this.customNodeMap.has(n))return this.customNodeMap.get(n);var r=this.registerMap.get(t);if(r){var i=new r;return this.customNodeMap.set(n,i),i}}},{key:"getPluginsById",value:function(e){var t=this,n=[];return this.presetNodes.forEach((function(r){t.customNodeMap.has("".concat(r).concat(e))&&n.push(t.customNodeMap.get("".concat(r).concat(e)))})),n}},{key:"unregisterPlugin",value:function(e){var t=e.id;this.customNodeMap.has(t)&&this.customNodeMap.delete(t)}},{key:"destroy",value:function(e){var t=this;this.presetNodes.forEach((function(n){t.unregisterPlugin({id:"".concat(n).concat(e)})})),this.registerMap.delete("mention"),this.registerMap.delete("marker"),this.registerMap.delete("attachments"),this.registerMap.delete("codesnippet"),this.registerMap.delete("page")}}]),e}();m(Je,"customNodeMap",new Map),m(Je,"registerMap",new Map),m(Je,"presetNodes",["mention","marker","attachments","codesnippet","page"]);var Ze=function(e){n(i,e);var t=r(i);function i(){return d(this,i),t.apply(this,arguments)}return f(i,[{key:"attributeChangedCallback",value:function(e,t,n){if("data-value"===e){if(n&&t===n)return;var r=JSON.parse(n),i=this.attachShadow({mode:"open"}),a=i.ownerDocument;if(r.icon){var o=a.createElement("span");o.part.add("svg"),o.innerHTML=r.icon,i.appendChild(o)}if(r.identifier){var s=a.createElement("span");s.part.add("identifier"),s.innerHTML=r.identifier,i.appendChild(s)}if(r.name){var u=a.createElement("span");u.part.add("name"),u.innerHTML=r.name,i.appendChild(u)}var l=a.createElement("style");l.innerHTML="\n      svg {\n        height: 1em;\n        width: 1em;\n      }\n    ",i.appendChild(l)}}}],[{key:"observedAttributes",get:function(){return["data-value"]}}]),i}(a(HTMLElement)),$e=function(e){n(c,e);var a,o,s=r(c);function c(){var e;d(this,c);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return m(i(e=s.call.apply(s,[this].concat(n))),"uploadParams",void 0),m(i(e),"exportParams",void 0),m(i(e),"minHeight",48),m(i(e),"maxHeight",315),m(i(e),"collapsed",u(!0)),m(i(e),"hidden",u(!1)),m(i(e),"reply",u("")),m(i(e),"replyScript",""),m(i(e),"mode","comment"),m(i(e),"uuid",Q()),m(i(e),"evt",new H(e.getEventArgs.bind(i(e)))),e}return f(c,[{key:"getEventArgs",value:function(){return{context:this.context,params:this.params,data:[],eventArg:"",targetName:this.model.name,view:this.parent.view}}},{key:"onInit",value:(o=E(x().mark((function e(){var n,r,i,a,o,s,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(l(c.prototype),"onInit",this).call(this);case 2:if(this.registerCustomElem(),this.editorParams){if(n=this.editorParams,r=n.uploadParams,i=n.exportParams,a=n.MINHEIGHT,o=n.MAXHEIGHT,s=n.REPLYSCRIPT,u=n.MODE,r)try{this.uploadParams=JSON.parse(r)}catch(d){ibiz.log.error("编辑器[".concat(ibiz.log.error(d),"]编辑器参数 uploadParams 非 json 格式"))}if(i)try{this.exportParams=JSON.parse(i)}catch(d){ibiz.log.error("编辑器[".concat(ibiz.log.error(d),"]编辑器参数 exportParams 非 json 格式"))}a&&(this.minHeight=Number(a)),o&&(this.maxHeight=Number(o)),s&&(this.replyScript=s),u&&(this.mode=u.toLowerCase())}Je.init(this.uuid);case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"registerCustomElem",value:function(){window.customElements.get("mention-elem")||window.customElements.define("mention-elem",Ze)}},{key:"onCreated",value:function(e,t,n){var r=this;Je.getPluginsById(this.uuid).forEach((function(i){i.init(e,{model:r.model,data:t,toolbarConfig:n,context:r.context,params:r.params,evt:r.evt})}))}},{key:"onDestroyed",value:function(){Je.getPluginsById(this.uuid).forEach((function(e){e.onDestroyed()})),Je.destroy(this.uuid)}},{key:"parseNode",value:function(e){var t=e;return Je.getPluginsById(this.uuid).forEach((function(e){t=e.parseNode(t)})),t}},{key:"setValue",value:(a=E(x().mark((function e(t){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.collapsed.value=!1,this.hidden.value=!0,e.next=4,P();case 4:return this.hidden.value=!1,e.next=7,P();case 7:n=this.parseNode(t),this.evt.emit("setHtml",{eventArg:n});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"setReply",value:function(e){this.reply.value="".concat(e.name,": ").concat(e.content),this.evt.emit("onSetReply",{eventArg:this.reply.value})}},{key:"removeReply",value:function(){this.reply.value="",this.evt.emit("onRemoveReply",{eventArg:this.reply.value})}},{key:"clear",value:function(){this.reply.value="",this.evt.emit("onRemoveReply",{eventArg:this.reply.value}),this.evt.emit("clear",{eventArg:""}),this.collapsed.value=!0}},{key:"fileDownload",value:function(e){ibiz.net.request(e.url,{method:"get",responseType:"blob",baseURL:""}).then((function(t){if(200!==t.status)throw new X("下载文件失败");if(!t.data)throw new X("文件流数据不存在");var n=e.name;ne(t.data,n)}))}},{key:"toggleCollapse",value:function(e){this.collapsed.value=!e&&!this.collapsed.value}},{key:"getThemeVar",value:function(){var e=document.documentElement;return e?getComputedStyle(e).getPropertyValue("--ibiz-color-primary"):null}},{key:"isChineseCharacter",value:function(e){return/[\u4e00-\u9fa5]/.test(e)}},{key:"hasChineseAndEnglish",value:function(e){return/[\u4e00-\u9fa5]+.*[a-zA-Z]+|[a-zA-Z]+.*[\u4e00-\u9fa5]+/.test(e)}},{key:"stringToHexColor",value:function(e){if(!e)return"";for(var t=0,n=0;n<e.length;n++){if(this.isChineseCharacter(e))t=e.charCodeAt(n)+((t<<5)-t),t&=t;else t+=e.charCodeAt(n).toString(16)}var r=String(t).substring(0,6),i=parseInt(r.substring(0,2),16),a=parseInt(r.substring(2,4),16),o=parseInt(r.substring(4,6),16),s="#".concat(i.toString(16).padStart(2,"0")).concat(a.toString(16).padStart(2,"0")).concat(o.toString(16).padStart(2,"0"));return"#FFFFFF"===s&&this.getThemeVar()||s}},{key:"avatarName",value:function(e){if(e&&e.toString().length<2)return e;if(e&&e.toString().length>=2){if(this.hasChineseAndEnglish(e)){var t=e.split("").find((function(e){return/[a-zA-Z]/.test(e)}))||"",n=e.split("").find((function(e){return/[\u4E00-\u9FA5]/.test(e)}))||"";return"".concat(t).concat(n).toLowerCase()}return/[a-zA-Z]/.test(e)?e.split("").filter((function(e){return/[a-zA-Z]/.test(e)})).slice(0,2).join("").toUpperCase():/[\u4E00-\u9FA5]/.test(e)?e.split("").filter((function(e){return/[\u4E00-\u9FA5]/.test(e)})).slice(-2).join(""):e.replaceAll(" ","").substring(0,2)}}}]),c}(T),Ge=function(){function e(){d(this,e),m(this,"formEditor","HtmlComment"),m(this,"gridEditor","HtmlComment")}var t;return f(e,[{key:"createController",value:(t=E(x().mark((function e(t,n){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new $e(t,n),e.next=3,r.init();case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),Qe=e("IBizHtmlComment",B(se,(function(e){e.component(se.name,se),D("EDITOR_CUSTOMSTYLE_COMMENT",(function(){return new Ge}))})));e("default",{install:function(e){e.use(Qe),e.component("IBizHtmlContent",I((function(){return Promise.resolve().then((function(){return ae}))})))}})}}}))}();
