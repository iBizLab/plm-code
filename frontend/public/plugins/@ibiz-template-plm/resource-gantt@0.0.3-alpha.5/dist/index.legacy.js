!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,n,r){return e=h()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&d(a,n.prototype),a},e.apply(null,arguments)}function n(){return n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=v(t)););return t}(t,e);if(r){var a=Object.getOwnPropertyDescriptor(r,e);return a.get?a.get.call(arguments.length<3?t:n):a.value}},n.apply(this,arguments)}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e,n){return(e=s(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,s(r.key),r)}}function u(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(e){var n=function(e,n){if("object"!==t(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,n||"default");if("object"!==t(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"===t(n)?n:String(n)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&d(t,e)}function d(t,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},d(t,e)}function f(e){var n=h();return function(){var r,a=v(e);if(n){var o=v(this).constructor;r=Reflect.construct(a,arguments,o)}else r=a.apply(this,arguments);return function(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}(this,r)}}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}function m(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */m=function(){return n};var e,n={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},l=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(e){c=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var a=e&&e.prototype instanceof b?e:b,i=Object.create(a.prototype),l=new N(r||[]);return o(i,"_invoke",{value:S(t,n,l)}),i}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}n.wrap=d;var p="suspendedStart",h="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function x(){}var D={};c(D,l,(function(){return this}));var C=Object.getPrototypeOf,_=C&&C(C(R([])));_&&_!==r&&a.call(_,l)&&(D=_);var k=x.prototype=b.prototype=Object.create(D);function I(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function O(e,n){function r(o,i,l,u){var s=f(e[o],e,i);if("throw"!==s.type){var c=s.arg,d=c.value;return d&&"object"==t(d)&&a.call(d,"__await")?n.resolve(d.__await).then((function(t){r("next",t,l,u)}),(function(t){r("throw",t,l,u)})):n.resolve(d).then((function(t){c.value=t,l(c)}),(function(t){return r("throw",t,l,u)}))}u(s.arg)}var i;o(this,"_invoke",{value:function(t,e){function a(){return new n((function(n,a){r(t,e,n,a)}))}return i=i?i.then(a,a):a()}})}function S(t,n,r){var a=p;return function(o,i){if(a===v)throw new Error("Generator is already running");if(a===y){if("throw"===o)throw i;return{value:e,done:!0}}for(r.method=o,r.arg=i;;){var l=r.delegate;if(l){var u=E(l,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===p)throw a=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=v;var s=f(t,n,r);if("normal"===s.type){if(a=r.done?y:h,s.arg===g)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(a=y,r.method="throw",r.arg=s.arg)}}}function E(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=f(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function R(n){if(n||""===n){var r=n[l];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var o=-1,i=function t(){for(;++o<n.length;)if(a.call(n,o))return t.value=n[o],t.done=!1,t;return t.value=e,t.done=!0,t};return i.next=i}}throw new TypeError(t(n)+" is not iterable")}return w.prototype=x,o(k,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=c(x,s,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,c(t,s,"GeneratorFunction")),t.prototype=Object.create(k),t},n.awrap=function(t){return{__await:t}},I(O.prototype),c(O.prototype,u,(function(){return this})),n.AsyncIterator=O,n.async=function(t,e,r,a,o){void 0===o&&(o=Promise);var i=new O(d(t,e,r,a),o);return n.isGeneratorFunction(e)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},I(k),c(k,s,"Generator"),c(k,l,(function(){return this})),c(k,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},n.values=R,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,a){return l.type="throw",l.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],l=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),s=a.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),L(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;L(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},n}function y(t,e,n,r,a,o,i){try{var l=t[o](i),u=l.value}catch(s){return void n(s)}l.done?e(u):Promise.resolve(u).then(r,a)}function g(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(t){y(o,r,a,i,l,"next",t)}function l(t){y(o,r,a,i,l,"throw",t)}i(void 0)}))}}function b(t){return function(t){if(Array.isArray(t))return D(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||x(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,o,i,l=[],u=!0,s=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(l.push(r.value),l.length!==e);u=!0);}catch(t){s=!0,a=t}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw a}}return l}}(t,e)||x(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(t,e){if(t){if("string"==typeof t)return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(t,e):void 0}}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}System.register(["@ibiz-template/runtime","@ibiz-template/vue3-util","vue","qx-util","dayjs","lodash-es","ramda","@ibiz-template/core"],(function(t,r){"use strict";var l,s,d,h,y,x,D,C,_,k,I,O,S,E,T,L,N,R,M,A,j,V,P,z,B,F,G,Y,q,W,H,$,U,K,Q,J,Z,X,tt;return{setters:[function(t){l=t.TreeGridExRowState,s=t.TreeGridExFieldColumnController,d=t.GanttService,h=t.getChildNodeRSs,y=t.getRootNode,x=t.handleAllSettled,D=t.getTreeNode,C=t.GanttDataSetNodeData,_=t.GanttController,k=t.calcDeCodeNameById,I=t.Srfuf,O=t.TreeGridExNotifyState,S=t.isValueChange,E=t.registerPanelItemProvider,T=t.registerControlProvider},function(t){L=t.useNamespace,N=t.PanelRawItemController,R=t.withInstall,M=t.useControlController},function(t){A=t.defineComponent,j=t.createVNode,V=t.ref,P=t.computed,z=t.watch,B=t.createTextVNode,F=t.resolveComponent,G=t.isVNode,Y=t.onMounted,q=t.getCurrentInstance,W=t.withDirectives,H=t.resolveDirective,$=t.h},function(t){U=t.createUUID},function(t){K=t.default},function(t){Q=t.isObject},function(t){J=t.isNotNil},function(t){Z=t.ModelError,X=t.RuntimeError,tt=t.awaitTimeout}],execute:function(){var et=function(t){var e=new Date(t),n=K(e),r=K();return n.isSame(r,"day")},nt=function(t,e){return t.replace(/\${(.*?)}/g,(function(t,n){var r=w(n.split("."),2),a=r[0],o=r[1],i=e[a]||"";return Q(i)?i[o]?i[o]:"":i}))},rt=function(t,e){var n=K(t).day();return e.includes(n)},at=function(t,e){var n=[],r=0,a=nt(e,t.data&&t.data._deData?t.data._deData:{}),o={};try{o=JSON.parse(a)}catch(i){o={}}return o.weekdays&&(n=o.weekdays.split(",").map((function(t){return Number(t)}))),o.dayCapacityVal&&(r=Number(o.dayCapacityVal)),Object.assign(o,{weekdays:n,dayCapacity:r}),o},ot=function(t,e,n){return(t.isAfter(e)||t.isSame(e))&&(t.isBefore(n)||t.isSame(n))},it=function(t,e){for(var n=Math.floor(t/e*10)/10,r=Math.round(10*(t-n*e))/10,a=new Array(e).fill(n),o=0,i=0;o<r;i++)a[i]=Math.round(10*(a[i]+.1))/10,o=Math.round(10*(o+.1))/10;return a};function lt(t){return t.getBoundingClientRect().top}function ut(t){var e=t.getBoundingClientRect();return(window.innerHeight||document.documentElement.clientHeight)-(e.top+e.height)}var st=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=K(t).startOf("day");return e.filter((function(t){var e=t._beginDataItemValue?K(t._beginDataItemValue).startOf("day"):null,r=t._endDataItemValue?K(t._endDataItemValue).startOf("day"):null;return!(e&&r&&e.isAfter(r))&&(!e&&r&&n.isSame(r,"day")||e&&!r&&n.isSame(e,"day")||e&&r&&function(t,e,n){var r=K(t),a=K(e),o=K(n);if(!(r instanceof K&&a instanceof K&&o instanceof K))throw new Error("All arguments must be dayjs objects");return r.isAfter(a)&&r.isBefore(o)||r.isSame(a)||r.isSame(o)}(n,e,r))})).length},ct=function(t,e,n){for(var r=new Date(t),a=new Date(e),o=[],i=new Date(r);i<=a;i.setDate(i.getDate()+1))rt(i,n)&&o.push(new Date(i));return o},dt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=0,o=K(e).startOf("day");return n.filter((function(t){return ot(o,K(t._beginDataItemValue).startOf("day"),K(t._endDataItemValue).startOf("day"))})).forEach((function(e){var n=K(e._beginDataItemValue).startOf("day"),i=K(e._endDataItemValue).startOf("day"),l=ct(new Date(n.format("YYYY-MM-DD")),new Date(i.format("YYYY-MM-DD")),t),u=l.length,s=e._deData[r]?Number(e._deData[r]):0;if(u>0&&s>0){var c=it(s,u),d=l.findIndex((function(t){return K(t).startOf("day").isSame(o)})),f=-1!==d?c[d]:0;a=Math.round(10*(a+f))/10}})),a},ft=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=0,o=K(e).startOf("day"),i=K(new Date).startOf("day");return o.isBefore(i)?0:(n.filter((function(t){return ot(o,K(t._beginDataItemValue).startOf("day"),K(t._endDataItemValue).startOf("day"))})).forEach((function(e){var n=K(e._beginDataItemValue).startOf("day"),l=K(e._endDataItemValue).startOf("day");n.isBefore(i)&&(n=i);var u=ct(new Date(n.format("YYYY-MM-DD")),new Date(l.format("YYYY-MM-DD")),t),s=u.length,c=e._deData[r]?Number(e._deData[r]):0;if(s>0&&c>0){var d=it(c,s),f=u.findIndex((function(t){return K(t).startOf("day").isSame(o)})),p=-1!==f?d[f]:0;a=Math.round(10*(a+p))/10}})),a)},pt=A({name:"TopLevelCell",props:{cellData:{type:Object,required:!0,default:function(){}},showText:{type:Boolean,required:!0,default:!0},capacityConfig:{type:Object,default:function(){}}},emits:["cellClick"],setup:function(t,e){var n=e.emit,r=L("top-level-cell"),a=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=n-t/e*n;return"polygon(0px ".concat(r,"%, 100% ").concat(r,"%, 100% ").concat(n,"%, 0px ").concat(n,"%)")};return{ns:r,renderContent:function(){if(!t.cellData.column)return"";var e=function(){var e=t.cellData,n=e.column,r=e.row;switch(t.capacityConfig.calcType){case"WORKITEMCOUNT":return st(n.date,r.data._children);case"ESTIMATEDWORKLOAD":return dt(t.capacityConfig.weekdays,n.date,r.data._children,t.capacityConfig.fieldName);case"REMAININGWORKLOAD":return ft(t.capacityConfig.weekdays,n.date,r.data._children,t.capacityConfig.fieldName)}}()||0,o=function(t,e){var n={};return t<e&&Object.assign(n,{"clip-path":a(t,e)}),n}(e,t.capacityConfig.dayCapacity),i=function(t,e){var n=[];return 0===t?[]:(t>e&&(n=[r.em("caption","exceed")]),t===e&&(n=[r.em("caption","saturation")]),t<e&&(n=[r.em("caption","standard")]),n)}(e,t.capacityConfig.dayCapacity);return j("div",{class:[r.e("caption")].concat(b(i)),onClick:function(e){return function(e){e.stopPropagation(),n("cellClick",t.cellData)}(e)}},[t.showText?j("span",{class:[r.em("caption","text")]},[String(e)]):"",j("div",{class:[r.em("caption","bkg")],style:o},null)])}}},render:function(){return j("div",{class:this.ns.b()},[this.renderContent()])}}),ht=A({name:"TotalProgress",props:{row:{type:l,required:!0},capacityConfig:{type:Object,required:!0,default:function(){}},dateRange:{type:Object,required:!0,default:function(){}}},setup:function(t){var e=L("total-progress"),n=V(0),r=V(0),a=P((function(){return n.value/r.value*100})),o=function(t,e,n){switch(t.calcType){case"WORKITEMCOUNT":return st(e,n);case"ESTIMATEDWORKLOAD":return dt(t.weekdays,e,n,t.fieldName);case"REMAININGWORKLOAD":return ft(t.weekdays,e,n,t.fieldName);default:return 0}};return z([function(){return t.row},function(){return t.capacityConfig}],(function(){var e=function(e,n,r){var a=r.start,i=r.end,l=0,u=0,s=0;if(n.length>0){for(var c=new Date(a);c<=new Date(i);){if(rt(c,t.capacityConfig.weekdays)){l+=1;var d=o(e,c,n);u=Math.round(10*(u+d))/10}c.setDate(c.getDate()+1)}s=l*e.dayCapacity}return{numerator:u,denominator:s}}(t.capacityConfig,t.row.data._children||[],t.dateRange);n.value=e.numerator,r.value=e.denominator}),{immediate:!0,deep:!0}),{ns:e,numerator:n,denominator:r,percentage:a}},render:function(){return j("div",{class:this.ns.b()},[j("span",{class:this.ns.e("caption")},[this.numerator,B(" / "),this.denominator]),j(F("el-progress"),{percentage:this.percentage},null)])}}),vt=A({name:"IBizResourceGanttExFieldColumn",props:{controller:{type:s,required:!0},row:{type:l,required:!0},parentRow:{type:Object},column:{type:Object},capacityConfig:{type:Object,required:!0,default:function(){}},groupConfig:{type:Object,required:!0,default:function(){}},ganttPosition:{type:Object,required:!0,default:function(){}},virtualTableVal:{type:Array,default:function(){return[]}},dateRange:{type:Object,required:!0,default:function(){}},level:{type:Number,default:0},isTopFirstIndex:{type:Boolean,default:!1}},setup:function(t){var e=L("tree-grid-ex-field-column"),n=L("resource-gantt-ex-field-column"),r=V(),a=V({}),o=P((function(){return t.controller.nodeColumnControllerMap.get(t.row.data._nodeId)})),i=P((function(){return"DE"!==t.row.data._nodeType&&t.controller.isFirstShowColumn?t.row.data._text:t.row.data[t.controller.name]})),l=V(""),u=P((function(){var t=o.value;if(t){if(t.nodeEditItem)return;return t.codeList?l.value:t.formatValue(i.value)+(t.unitName||"")}return i.value})),s=P((function(){if("ellipsis"===t.controller.treeGrid.overflowMode&&J(i.value)&&""!==i.value)return u.value})),c=P((function(){return i.value&&o.value&&(o.value.isLinkColumn||o.value.hasClickAction)})),d=function(){var e=g(m().mark((function e(n,r){var a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(a=o.value)||void 0===a?void 0:a.onActionClick(n,t.row,r);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),f=function(e,n,r){var a,o=e.data;if(o&&o._children&&o._children.length>1){var i=o._children.find((function(t){return n.data&&t._deData&&n.data._deData&&t._deData[r.groupField]===n.data._deData[r.groupField]}));if(i&&(a=i._id,!t.virtualTableVal.find((function(t){return t.data._id===a})))){var l=t.virtualTableVal.find((function(t){return n.data&&t.data._deData&&n.data._deData&&t.data._deData[r.groupField]===n.data._deData[r.groupField]}));return l&&n.data._id===l.data._id}return i&&n.data._id===i._id}return!1};var p=P((function(){var e="",n=t.parentRow,r=t.row;return t.level>1&&n&&function(t,e,n){var r=t.data;return r&&r._children&&r._children.length>1?r._children.reduce((function(t,r){return e.data&&r._deData&&e.data._deData&&r._deData[n.groupField]===e.data._deData[n.groupField]?t+1:t}),0):0}(n,r,t.groupConfig)>1&&(e=f(n,r,t.groupConfig)?"first-index":"no-first-index"),e})),h=P((function(){var e={},n=t.level,o=t.parentRow,i=t.row;if(n&&n>1&&o&&o.data._children&&o.data._children.length>1){var l=function(e,n,r){var a=e.data;if(a&&a._children&&a._children.length>1){var o=a._children.findIndex((function(t){return n.data&&t._deData&&n.data._deData&&t._deData[r.groupField]===n.data._deData[r.groupField]&&n.data._id===t._id}));if(-1!==o&&f(e,n,t.groupConfig))return a._children.slice(o).reduce((function(t,e){return n.data&&e._deData&&n.data._deData&&e._deData[r.groupField]===n.data._deData[r.groupField]?t+1:t}),0)}return 0}(o,i,t.groupConfig);if(l>1){var u=46*l-20;Object.assign(e,{height:"".concat(u,"px")}),function(){if(a.value={},r.value){var e=function(t,e){for(var n=t;n&&1===n.nodeType;){if(n.classList.contains(e))return n;n=n.parentNode}return null}(r.value,"xg-table-row");if(e){var n=t.ganttPosition,o=lt(e),i=ut(e);o<n.top+46&&(o=n.top+46),i<n.bottom&&(i=n.bottom);var l=((window.innerHeight||document.documentElement.clientHeight)-o-i)/2+o-23;l>o&&(a.value={position:"fixed",top:"".concat(l,"px")})}}}()}}return e}));return{ns:e,ns2:n,nodeColumn:o,fieldValue:i,showText:u,clickable:c,tooltip:s,calcMergeClass:p,calcMergeStyle:h,columnRef:r,contentStyle:a,onInfoTextChange:function(t){l.value=t},onTextClick:function(e){var n;null===(n=o.value)||void 0===n||n.onTextClick(t.row,e)},onActionClick:d}},render:function(){var t,e,n,r,a,o,i=null;if(i=null!==(t=this.nodeColumn)&&void 0!==t&&t.nodeEditItem?j(F("iBizTreeGridExEditColumn"),{controller:this.nodeColumn,row:this.row},null):null!==(e=this.nodeColumn)&&void 0!==e&&e.codeList?j(F("iBizCodeList"),{class:this.ns.e("text"),codeListItems:this.nodeColumn.codeListItems,codeList:this.nodeColumn.codeList,value:this.fieldValue,onClick:this.onTextClick,onInfoTextChange:this.onInfoTextChange,title:this.tooltip},null):j("span",{class:[this.ns.e("text"),this.ns2.e("text")],title:this.tooltip,onClick:this.onTextClick,style:this.contentStyle},[this.showText]),this.$slots.actions)o=this.$slots.actions();else if(this.row.columnActionsStates[this.controller.name]){var l;o=j(It,{class:this.ns.e("toolbar"),actionDetails:null===(l=this.nodeColumn)||void 0===l?void 0:l.nodeColumn.deuiactionGroup.uiactionGroupDetails,actionsState:this.row.columnActionsStates[this.controller.name],mode:"dropdown",popperClass:this.ns2.b("popper"),groupLevelKeys:[],onActionClick:this.onActionClick},null)}var u=null;return 1===this.level&&(u=j(ht,{row:this.row,capacityConfig:this.capacityConfig,dateRange:this.dateRange},null)),j("div",{ref:"columnRef",class:[this.ns.b(),this.ns2.b(),this.clickable&&this.ns.m("clickable"),this.ns.m(this.controller.treeGrid.overflowMode),null===(n=this.controller.model.cellSysCss)||void 0===n?void 0:n.cssName,this.ns.is("has-action",!!o),null!==(r=this.row)&&void 0!==r&&r.data._children&&0===(null===(a=this.row)||void 0===a||null===(a=a.data._children)||void 0===a?void 0:a.length)?"no-children":"",this.isTopFirstIndex?"top-first-index":"",this.calcMergeClass],style:this.calcMergeStyle},[j("div",{class:[this.ns.b("text-container"),this.ns2.b("text-container")]},[i]),o,u])}}),mt=function(){return j("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",focusable:"false"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("path",{d:"M6.751 12.303A5.557 5.557 0 0 1 1.2 6.751C1.2 3.691 3.69 1.2 6.751 1.2a5.558 5.558 0 0 1 5.551 5.551 5.557 5.557 0 0 1-5.551 5.552M6.751 0a6.751 6.751 0 1 0 4.309 11.949l3.855 3.855a.6.6 0 1 0 .849-.849l-3.854-3.853A6.751 6.751 0 0 0 6.751 0"},null)])])},yt=function(){return j("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",focusable:"false"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("g",{transform:"translate(3.347 1.67)"},[j("path",{d:"M8.31 4.544l-3.858-3.01L.757 4.537 0 3.606 4.435 0l4.613 3.598-.738.946zM.778 7.934l3.805 3.077L8.33 8.074l.74.944-4.497 3.528-4.55-3.679.755-.933z"},null)])])])},gt=function(){return j("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",focusable:"false"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("g",{transform:"translate(3.347 1.67)"},[j("path",{d:"M.738 0l3.858 3.01L8.291.008l.757.93-4.435 3.606L0 .946.738 0zM8.31 12.544l-3.858-3.01-3.695 3.003L0 11.606 4.435 8l4.613 3.598-.738.946z"},null)])])])},bt=function(){return j("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",height:"1em",width:"1em","data-v-6fbb019e":""},[j("path",{fill:"currentColor",d:"M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"},null)])},wt=function(){return j("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("path",{d:"M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16zm0-1.2A6.8 6.8 0 1 0 8 1.2a6.8 6.8 0 0 0 0 13.6zm.017-10V8.42H11.7v1.2H6.817V4.8h1.2z"},null)])])},xt=function(){return j("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("path",{d:"M13.9940802,1 L13.9940802,2.2 L13.2624694,2.20103326 C12.93604,4.83947485 11.5126604,7.09238002 9.63519201,7.94035881 C11.5358297,8.8013205 12.9480925,11.1932677 13.2658805,13.8999459 L13.9940802,13.9 L13.9940802,15.1 L2.00217741,15.1 L2.00217741,13.9 L2.73926874,13.9002831 C3.07603558,11.2316386 4.55055745,8.86884631 6.45182913,7.97728733 C4.5311544,7.16123279 3.06895466,4.87984542 2.73753056,2.20103326 L2.00217741,2.2 L2.00217741,1 L13.9940802,1 Z M8.09238129,8.79975967 C6.27968763,8.79975967 4.50087608,10.8991568 4.003456,13.5719701 L3.95733333,13.85 L12.0513333,13.85 L12.0453334,13.8079643 C11.6544503,11.0697148 10.0166737,8.92538307 8.2486894,8.80508513 L8.09238129,8.79975967 Z M12.0446667,2.25 L3.95366667,2.25 L3.96063026,2.29291849 C4.36564997,4.94375371 6.02387547,6.97732036 7.834965,7.09464882 L8,7.1 C9.81589788,7.1 11.5127277,5.15179966 11.9963879,2.54700205 L12.0446667,2.25 Z"},null)])])},Dt=function(){return j("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("path",{d:"M12.777 13.107V3.88a.621.621 0 0 0-.621-.62h-.76v.216a.977.977 0 0 1-.975.978h-4.9a.978.978 0 0 1-.977-.978v-.216H3.82a.62.62 0 0 0-.62.62v9.226c0 .341.278.62.62.62h8.336a.621.621 0 0 0 .62-.62zM5.744 3.255h4.453V2.2H5.744v1.054zm6.412-1.194c1.004 0 1.82.817 1.82 1.82v9.226a1.821 1.821 0 0 1-1.82 1.819H3.82A1.822 1.822 0 0 1 2 13.105V3.88c0-1.002.817-1.82 1.82-1.82h.724v-.084c0-.538.438-.976.977-.976h4.9c.538 0 .975.438.975.976v.085h.76zm-1.77 4.782a.6.6 0 0 1 .833.863l-3.688 3.562c-.002.003-.002.006-.005.009a.601.601 0 0 1-.849-.004L4.748 9.326a.599.599 0 1 1 .852-.844l1.511 1.524 3.274-3.163z"},null)])])},Ct=function(t){c(d,t);var e,n,r,l,s=f(d);function d(){return i(this,d),s.apply(this,arguments)}return u(d,[{key:"fetchNodeDatasByType",value:(l=g(m().mark((function t(e,n,r,o){var i,l,u,s,c,d,f,p,v,y,b,w=this;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l=0===h(this.model,{parentId:e.id,hasQuery:o.hasQuery}).length,u=a(a({},o),{},{leaf:l}),s=[],r||this.model.rootVisible){t.next=10;break}return t.next=6,this.getStaticGanttNodeData(e,n,r,u);case 6:c=t.sent,s=[c],t.next=27;break;case 10:t.t0=e.treeNodeType,t.next="STATIC"===t.t0?13:"DE"===t.t0?18:"CODELIST"===t.t0?22:26;break;case 13:return t.next=15,this.getStaticGanttNodeData(e,n,r,u);case 15:return d=t.sent,s=[d],t.abrupt("break",27);case 18:return t.next=20,this.getDEGanttNodeDatas(e,n,r,u);case 20:case 24:return s=t.sent,t.abrupt("break",27);case 22:return t.next=24,this.getCodeListGanttNodeDatas(e,n,r,u);case 26:throw new Z(e,ibiz.i18n.t("runtime.controller.control.gantt.noSupport",{treeNodeType:e.treeNodeType}));case 27:if(f=e.expandFirstOnly,p=e.expanded,v=e.rootNode,y=v&&!this.model.rootVisible,l){t.next=42;break}if(!r||r._parent){t.next=40;break}return t.next=33,Promise.all(s);case 33:return s=t.sent,t.next=36,this.fetchAllChildNodes(s,o);case 36:b=t.sent,s.forEach(function(){var t=g(m().mark((function t(e){var n;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.fetchCustomChildNodes(e,o,b||[]);case 2:n=t.sent,e._children=n;case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=42;break;case 40:return t.next=42,Promise.all(s.map(function(){var t=g(m().mark((function t(e,n){var r;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(p&&(!f||f&&0===n)||y)){t.next=5;break}return t.next=3,w.fetchChildNodes(e,o);case 3:r=t.sent,e._children=r;case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()));case 42:return null===(i=s)||void 0===i||i.forEach((function(t){t._beginDataItemValue||(t._beginDataItemValue=t._endDataItemValue),t._endDataItemValue||(t._endDataItemValue=t._beginDataItemValue),t._endDataItemValue&&(t._endDataItemValue="".concat(t._endDataItemValue," 23:59:59"))})),s=this.groupSort(s||[],o.groupField),t.abrupt("return",s);case 45:case"end":return t.stop()}}),t,this)}))),function(t,e,n,r){return l.apply(this,arguments)})},{key:"fetchCustomChildNodes",value:function(t,e,n){var r,a=[];if(t&&n.length>0){var o=e.hasQuery,i=(h(this.model,{parentId:t._nodeId,hasQuery:o})[0]||{}).parentFilter;n.forEach((function(e){i&&e._deData&&t._value===e._deData[i]&&(e._parent=t,a.push(e))}))}return null===(r=a)||void 0===r||r.forEach((function(t){t._beginDataItemValue||(t._beginDataItemValue=t._endDataItemValue),t._endDataItemValue||(t._endDataItemValue=t._beginDataItemValue),t._endDataItemValue&&(t._endDataItemValue="".concat(t._endDataItemValue," 23:59:59"))})),a=this.groupSort(a||[],e.groupField)}},{key:"fetchChildNodes",value:(r=g(m().mark((function t(e,n){var r,a,o,i,l=this;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.hasQuery,a=[],e){t.next=9;break}return o=y(this.model),t.next=6,this.fetchNodeDatasByType(o,void 0,void 0,n);case 6:a=t.sent,t.next=16;break;case 9:if(0!==(i=h(this.model,{parentId:e._nodeId,hasQuery:r})).length){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,x(i.map(function(){var t=g(m().mark((function t(r){var a;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=D(l.model,r.childDETreeNodeId),t.abrupt("return",l.fetchNodeDatasByType(a,r,e,n));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),!1);case 14:t.sent.forEach((function(t){var e;(e=a).push.apply(e,b(t))}));case 16:return t.abrupt("return",a);case 17:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"groupSort",value:function(t,e){var n={},r=0;return t.forEach((function(t){var a=t._deData&&t._deData[e]?t._deData[e]:"";a in n||(n[a]=r,r+=1)})),t.sort((function(t,r){return(t._deData&&t._deData[e]?n[t._deData[e]]:-1)-(r._deData&&r._deData[e]?n[r._deData[e]]:-1)})),t}},{key:"getFilterNodes",value:function(t){var e=[];return t.forEach((function(t){t._value&&e.push(t._value)})),e.join(",")}},{key:"fetchAllChildNodes",value:(n=g(m().mark((function t(e,n){var r,o,i,l,u=this;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.hasQuery,o=[],i=a({},e[0]),0!==(l=h(this.model,{parentId:i._nodeId,hasQuery:r})).length){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,x(l.map(function(){var t=g(m().mark((function t(r){var o,l,s;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=D(u.model,r.childDETreeNodeId),r.parentFilter&&Object.assign(i,{_value:u.getFilterNodes(e)}),l=0===h(u.model,{parentId:o.id,hasQuery:n.hasQuery}).length,s=a(a({},n),{},{leaf:l}),t.abrupt("return",u.getCustomDEGanttNodeDatas(o,r,i,s));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),!1);case 8:return t.sent.forEach((function(t){o.push.apply(o,b(t))})),t.abrupt("return",o);case 11:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"getCustomDEGanttNodeDatas",value:(e=g(m().mark((function t(e,n,r,a){var i,l,u,s,c,d,f,p,h,v,y=this;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.appDEDataSetId,l=e.appDataEntityId,u=n?this.getNodeRSFilterParams(n,r,a):{context:a.context,params:a.params,navContext:{},navParams:{}},s=u.context,c=u.params,d=u.navContext,f=u.navParams,c.size=e.maxSize||1e3,e.sortAppDEFieldId&&Object.assign(c,{sort:"".concat(e.sortAppDEFieldId.toLowerCase(),",").concat(e.sortDir?e.sortDir.toLowerCase():"asc")}),(p=n?n.parentFilter:"")&&c["n_".concat(p.toLowerCase(),"_eq")]&&(Object.assign(c,o({},"n_".concat(p.toLowerCase(),"_in"),c["n_".concat(p.toLowerCase(),"_eq")])),delete c["n_".concat(p.toLowerCase(),"_eq")]),t.next=8,this.app.deService.exec(l,i,s,c);case 8:if(!(h=t.sent).data.length){t.next=12;break}return v=h.data.map((function(t,n){var o=y.calcExpand(e,n);return new C(y.model,e,r,{data:t,leaf:!!a.leaf,navContext:d,navParams:f,defaultExpand:o})})),t.abrupt("return",v);case 12:return t.abrupt("return",[]);case 13:case"end":return t.stop()}}),t,this)}))),function(t,n,r,a){return e.apply(this,arguments)})}]),d}(d),_t=function(t){c(w,t);var e,r,l,s,d,h,y,b=f(w);function w(){var t;i(this,w);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return o(p(t=b.call.apply(b,[this].concat(n))),"isInitialLoad",!0),t}return u(w,[{key:"_evt",get:function(){return this.evt}},{key:"initService",value:(y=g(m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.service=new Ct(this.model),t.next=3,this.service.init(this.context);case 3:case"end":return t.stop()}}),t,this)}))),function(){return y.apply(this,arguments)})},{key:"initState",value:function(){n(v(w.prototype),"initState",this).call(this),this.state.showCapacity=!0,this.state.onlyTopNodes=!1,this.state.showWeekdays=[],this.state.capacityConfig=JSON.stringify({calcType:"WORKITEMCOUNT",fieldName:"",weekdays:"${weekday}",dayCapacityVal:"${day_capacity.work_item_count}"}),this.state.sliderDraggable=!0,this.state.sliderShowContent='"${show_identifier}  ${title}"',this.state.groupConfig={groupField:"project_id"},this.state.contextMap=JSON.stringify({project:"${project_id}"}),this.state.sliderLimit=!0,this.state.expandAll=!1,this.calcDataRange()}},{key:"handleControlParams",value:function(){if(n(v(w.prototype),"handleControlParams",this).call(this),this.controlParams.sliderdraggable&&(this.state.sliderDraggable="true"===this.controlParams.sliderdraggable),this.controlParams.slidershowcontent&&(this.state.sliderShowContent=this.controlParams.slidershowcontent),this.controlParams.groupconfig)try{this.state.groupConfig=JSON.parse(this.controlParams.groupconfig)}catch(t){this.state.groupConfig={}}this.controlParams.sliderlimit&&(this.state.sliderLimit="true"===this.controlParams.sliderlimit),this.controlParams.expandall&&(this.state.expandAll="true"===this.controlParams.expandall),this.controlParams.contextmap&&(this.state.contextMap=this.controlParams.contextmap)}},{key:"setDateRange",value:function(t){this.state.dateRange=t}},{key:"showCapacityChange",value:function(t){this.state.showCapacity=t}},{key:"fullscreenChange",value:function(){this._evt.emit("onFullscreenChange",{})}},{key:"noWeekendDays",value:function(t){this.state.showWeekdays=t?[1,2,3,4,5]:[0,1,2,3,4,5,6]}},{key:"capacityCalcChange",value:function(t){this.state.capacityConfig=JSON.stringify(t)}},{key:"onlyTopNodesChange",value:function(t){this.state.onlyTopNodes=t}},{key:"calcDataRange",value:function(){var t=this.view.getController("searchform");if(t){var e=t.state.data;this.state.dateRange={start:e.n_date_scope_gtandeq,end:e.n_date_scope_ltandeq}}else{var n=new Date;this.state.dateRange={start:K(n.getTime()-6048e5).format("YYYY-MM-DD"),end:K(n).format("YYYY-MM-DD")}}}},{key:"getNodeDataByNodeId",value:function(t){return this.state.items.filter((function(e){return e._nodeId===t})).map((function(t){var e={};return t._deData&&(e=a(a({},t._deData),{},{srfkey:t._deData.srfkey})),e}))}},{key:"load",value:(h=g(m().mark((function t(){var e,r=arguments;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:{},this.calcDataRange(),this.isInitialLoad=!0===e.isInitialLoad,t.abrupt("return",n(v(w.prototype),"load",this).call(this,e));case 4:case"end":return t.stop()}}),t,this)}))),function(){return h.apply(this,arguments)})},{key:"loadNodes",value:(d=g(m().mark((function t(e){var n,r,a;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getFetchParams();case 2:return n=t.sent,r=!!n.query,this.state.isLoading=!this.isInitialLoad,t.prev=5,t.next=8,this.service.fetchChildNodes(e,{context:this.context.clone(),params:n,hasQuery:r,groupField:this.state.groupConfig.groupField,defaultExpandedKeys:this.state.expandedKeys});case 8:if(t.t0=t.sent,t.t0){t.next=11;break}t.t0=[];case 11:a=t.t0;case 12:return t.prev=12,this.state.isLoading=!1,t.finish(12);case 15:return e?e._children=a:this.state.rootNodes=a,t.next=18,this.afterLoadNodes(a);case 18:return t.abrupt("return",a);case 19:case"end":return t.stop()}}),t,this,[[5,,12,15]])}))),function(t){return d.apply(this,arguments)})},{key:"startLoading",value:(s=g(m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.ctx.startLoading();case 1:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"openData",value:(l=g(m().mark((function t(e){var n,r,a,o,i,l,u,s,c,d;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.data,o=e.context,i=e.params,l=a[0],u=this.getNodeModel(l._nodeId),s=u.appDataEntityId,c=k(s),o[c.toLowerCase()]=null===(n=l._deData)||void 0===n?void 0:n.srfkey,t.next=8,null===(r=this.viewScheduler)||void 0===r?void 0:r.triggerCustom("".concat(u.id.toLowerCase(),"_opendata"),{context:o,params:i,data:a,event:void 0,view:this.view,ctrl:this});case 8:if(-1!==(d=t.sent)){t.next=13;break}throw new Error(ibiz.i18n.t("runtime.controller.control.calendar.missingViewLogic",{itemType:u.id.toLowerCase()}));case 13:return t.abrupt("return",{cancel:!d.ok});case 14:case"end":return t.stop()}}),t,this)}))),function(t){return l.apply(this,arguments)})},{key:"save",value:(r=g(m().mark((function t(e){var n,r,a,o,i,l,u,s,c;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.state.isSimple){t.next=3;break}return ibiz.log.debug(ibiz.i18n.t("runtime.controller.common.md.simpleMode")),t.abrupt("return");case 3:if("DE"===e._nodeType){t.next=5;break}throw new X(ibiz.i18n.t("runtime.controller.control.gantt.nonentity"));case 5:if(n=this.state.rows[e._uuid]){t.next=8;break}throw new X(ibiz.i18n.t("runtime.controller.common.md.rowData"));case 8:if(n.modified){t.next=11;break}return ibiz.log.debug(ibiz.i18n.t("runtime.controller.common.md.noChange")),t.abrupt("return");case 11:if(!n.processing){t.next=15;break}return t.next=14,tt(500,this.save.bind(this),[e]);case 14:return t.abrupt("return");case 15:return r=this.getNodeModel(e._nodeId),a=r.appDataEntityId,o=e._deData.srfuf===I.CREATE,i=k(a),(l=this.context.clone())[i]=e._deData.srfkey,u=nt(this.state.contextMap,e._deData||{})||"{}",Object.assign(l,JSON.parse(u)),s=ibiz.hub.getApp(this.context.srfappid),t.prev=24,t.next=27,s.deService.exec(a,o?"create":"update",l,e._deData);case 27:c=t.sent,t.next=36;break;case 30:return t.prev=30,t.t0=t.catch(24),t.next=34,this.evt.emit("onSaveError",void 0);case 34:throw this.actionNotification("".concat(o?"CREATE":"UPDATE","ERROR"),{error:t.t0,data:n.data}),t.t0;case 36:return n.data._deData=c.data,n.modified=!1,this.gridStateNotify(n,O.SAVE),t.next=41,this.evt.emit("onSaveSuccess",void 0);case 41:case"end":return t.stop()}}),t,this,[[24,30]])}))),function(t){return r.apply(this,arguments)})},{key:"setRowValue",value:(e=g(m().mark((function t(e,n,r){var a,o,i;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=this.model,o=a.beginDataItemName,i=a.endDataItemName,!Object.prototype.hasOwnProperty.call(e.data,n)||S(e.data[n],r)){t.next=3;break}return t.abrupt("return");case 3:if(n!==o&&n!==i||(l=e.data[n],u=r,s="day",!K(l).isSame(K(u),s))){t.next=5;break}return t.abrupt("return");case 5:return e.data[n]=r,n===o?e.data._beginDataItemValue=r:n===i&&(e.data._endDataItemValue=r),e.modified=!0,e.processing=!0,t.prev=9,t.next=12,this.dataChangeNotify(e,[n]);case 12:return t.prev=12,e.processing=!1,t.finish(12);case 15:case"end":return t.stop()}var l,u,s}),t,this,[[9,,12,15]])}))),function(t,n,r){return e.apply(this,arguments)})}]),w}(_),kt=A({name:"ResourceGanttColumnHead",props:{controller:{type:_t,required:!0,default:function(){}},model:{type:Object,required:!0,default:function(){}},expandAll:{type:Boolean,required:!0,default:!1},titleData:{type:Object,required:!0,default:function(){}}},emits:["expandAllChange","headSearch"],setup:function(t,e){var n=e.emit,r=t.controller,a=L("resource-gantt-column-head"),o=V(!1),i=V(!1),l=V(""),u=P((function(){return t.titleData.label}));z((function(){return t.expandAll}),(function(t){o.value=t}),{immediate:!0});var s=function(){o.value=!o.value,n("expandAllChange",o.value)},c=function(){n("headSearch",l.value)},d=function(t){t.preventDefault(),t.stopPropagation(),i.value=!1,n("headSearch","")},f=function(){var e=g(m().mark((function e(n,r){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.controller.doUIAction(n.uiactionId,{},r,n.appId);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),p=function(){return j(F("el-input"),{modelValue:l.value,"onUpdate:modelValue":function(t){return l.value=t},class:a.b("search"),onInput:c,placeholder:"搜索成员"},{prefix:function(){return j(mt,null,null)},suffix:function(){return j(F("el-button"),{class:a.be("search","suffix"),onClick:d},{default:function(){return[j(bt,null,null)]}})}})},h=function(){var t,e=r.getNodeModel("root"),n=r.state.selectedData;if(null!=e&&null!==(t=e.decontextMenu)&&void 0!==t&&null!==(t=t.detoolbarItems)&&void 0!==t&&t.length){var a=r.contextMenuInfos[e.id];return a.clickTBUIActionItem&&a.onlyOneActionItem?null:j(F("iBizContextMenuControl"),{modelData:e.decontextMenu,groupLevelKeys:[50],nodeModel:e,nodeData:n,context:r.context,onActionClick:function(t,e){return f(t,e)}},null)}};return{c:r,ns:a,label:u,isHeadSearch:i,expand:o,renderHeadSearch:p,onColumnHeadClick:function(t){t.preventDefault(),t.stopPropagation()},onExpandAllChange:s,renderContent:function(){return i.value?p():j("div",{class:a.b("box")},[j("div",{class:a.be("box","left")},[j(F("el-button"),{class:a.bem("box","left","icon"),title:o.value?"全部收起":"全部展开",onClick:s},{default:function(){return[o.value?j(gt,null,null):j(yt,null,null)]}}),j("div",{class:a.bem("box","left","caption")},[u.value])]),j("div",{class:a.be("box","right")},[j(F("el-button"),{size:"small",title:"搜索成员",class:[a.e("item")],onClick:function(t){return function(t,e){e.stopPropagation(),i.value=!0}(0,t)}},{icon:function(){return j("div",{class:a.e("icon")},[j(mt,null,null)])}}),h()])])}}},render:function(){return j("div",{class:this.ns.b()},[this.renderContent()])}});var It=A({name:"IBizResourceActionToolbar",props:{actionDetails:{type:Array,required:!0},actionsState:{type:Object,required:!0},caption:String,mode:{type:String,default:"buttons"},groupLevelKeys:{type:Object,default:[50]},zIndex:{type:Number},popperClass:String},emits:["actionClick"],setup:function(t,e){var n,r=e.emit,a=L("action-toolbar"),o=L("resource-action-toolbar"),i=V(),l=V(!1),u=V(!1);null===(n=t.actionDetails)||void 0===n||n.forEach((function(t){t.capLanguageRes&&t.capLanguageRes.lanResTag&&(t.caption=ibiz.i18n.t(t.capLanguageRes.lanResTag,t.caption)),t.tooltipLanguageRes&&t.tooltipLanguageRes.lanResTag&&(t.tooltip=ibiz.i18n.t(t.tooltipLanguageRes.lanResTag,t.tooltip))}));var s=function(){var e=g(m().mark((function e(n,a){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.stopPropagation(),"buttons"===t.mode?l.value=!1:i.value&&i.value.handleClose(),r("actionClick",n,a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),c=V([]),d=V([]);t.actionDetails&&t.actionDetails.forEach((function(e){-1!==t.groupLevelKeys.findIndex((function(t){return t===e.actionLevel}))?d.value.push(e):c.value.push(e)}));var f=V(),p=t.zIndex;return{ns:a,ns2:o,dropdownRef:i,popoverIndex:p,expandDetails:c,groupDetails:d,groupButtonRef:f,popoverVisible:l,dropdownVisible:u,handleClick:s,calcActionItemClass:function(t){var e=t.actionLevel;return[a.e("item"),a.is("disabled",!1),a.em("item","level-".concat(e))]},onVisibleChange:function(t){u.value=t}}},render:function(){var t,e=this,n=this.actionDetails||[],r=function(t){return j(F("el-divider"),{class:e.ns.e("separator"),"border-style":"double",direction:t?"vertical":"horizontal"},null)},a=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t.map((function(t){return e.actionsState[t.id].visible?[t.addSeparator&&r(n),j(F("el-button"),{text:!0,size:"small",onClick:function(n){return e.handleClick(t,n)},title:t.tooltip,disabled:e.actionsState[t.id].disabled,class:e.calcActionItemClass(t)},{default:function(){return[j("div",{class:e.ns.em("item","icon")},[t.showIcon&&t.sysImage&&j(F("iBizIcon"),{icon:t.sysImage},null)]),j("div",{class:e.ns.em("item","label")},[t.showCaption?t.caption:""])]}})]:null}))};if(null!==(t=this.actionsState)&&void 0!==t&&t.visible)return"buttons"===this.mode?j("div",{class:[this.ns.b(),this.ns.m("buttons")],onClick:function(t){return t.stopPropagation()}},[a(this.expandDetails),function(){var t;if(0===e.groupDetails.length)return null;if(-1===e.groupDetails.findIndex((function(t){return!0===e.actionsState[t.id].visible})))return null;var n,r=-1===e.groupDetails.findIndex((function(t){return!1===e.actionsState[t.id].disabled}));return[j(F("el-button"),{size:"small",text:!0,disabled:r,ref:"groupButtonRef",class:[e.ns.e("item"),e.ns.is("expand",e.popoverVisible)]},{icon:function(){return j(F("ion-icon"),{class:e.ns.e("icon"),name:"ellipsis-vertical-outline",title:ibiz.i18n.t("component.actionToolbar.more")},null)}}),j(F("el-popover"),{placement:"bottom-start","virtual-ref":e.groupButtonRef,trigger:"click",visible:e.popoverVisible,"onUpdate:visible":function(t){return e.popoverVisible=t},"popper-class":e.ns.e("popover"),"virtual-triggering":!0,"popper-style":"z-index:".concat(e.popoverIndex)},(n=t=a(e.groupDetails,!1),"function"==typeof n||"[object Object]"===Object.prototype.toString.call(n)&&!G(n)?t:{default:function(){return[t]}}))]}()]):j(F("el-dropdown"),{ref:"dropdownRef",onCommand:function(t){return e.handleClick(t,new MouseEvent("click"))},trigger:"click",class:[this.ns.b(),this.ns.m("dropdown"),this.dropdownVisible?this.ns2.e("open"):""],placement:"bottom-start","popper-class":this.popperClass,onVisibleChange:this.onVisibleChange},{default:function(){return j("span",{class:e.ns.e("caption")},[e.caption,j(F("ion-icon"),{class:e.ns.e("caption-icon"),name:"ellipsis-vertical-outline"},null)])},dropdown:function(){return j(F("el-dropdown-menu"),null,{default:function(){return[n.length>0&&n.map((function(t){return e.actionsState[t.id].visible?j(F("el-dropdown-item"),{class:[e.ns.e("item"),e.ns.is("disabled",!1)],title:t.tooltip,disabled:e.actionsState[t.id].disabled,command:t},{default:function(){return[t.showIcon&&t.sysImage&&j(F("iBizIcon"),{icon:t.sysImage},null),t.showCaption?t.caption:""]}}):null}))]}})}})}}),Ot=function(t){c(n,t);var e=f(n);function n(){return i(this,n),e.apply(this,arguments)}return u(n)}(N),St=A({name:"IBizPanelResourceState",props:{modelData:{type:Object,required:!0},controller:{type:Ot,required:!0}},setup:function(t){var e=L("panel-rawitem"),n=L("panel-resource-state"),r=V(""),a=[{tag:"standard",name:"标准"},{tag:"saturation",name:"饱和"},{tag:"exceed",name:"超出"}],o=t.modelData.rawItem;o&&o.cssStyle&&(r.value=o.cssStyle);var i=P((function(){var r=t.modelData.id,a=[e.b(),n.b(),e.m(r)];return a.push.apply(a,b(t.controller.containerClass)),a}));return{ns:e,classArr:i,tempStyle:r,renderContent:function(){return a.map((function(t){return j("div",{class:[n.e("content"),n.e(t.tag)]},[j("div",{class:[n.em("content","star")]},null),j("div",{class:n.em("content","caption")},[t.name])])}))}}},render:function(){var t=this;if(this.controller.state.visible)return j("div",{class:this.classArr,style:this.tempStyle,onClick:function(){t.controller.onClick()}},[this.renderContent()])}}),Et=function(){function t(){i(this,t),o(this,"component","IBizPanelResourceState")}var e;return u(t,[{key:"createController",value:(e=g(m().mark((function t(e,n,r){var a;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new Ot(e,n,r),t.next=3,a.init();case 3:return t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)}))),function(t,n,r){return e.apply(this,arguments)})}]),t}(),Tt=R(St,(function(t){t.component(St.name,St),E("CUSTOM_RESOURCE_STATE",(function(){return new Et}))})),Lt=function(t){c(n,t);var e=f(n);function n(){return i(this,n),e.apply(this,arguments)}return u(n)}(N),Nt=A({name:"IBizResourceDropdownList",props:{modelData:{type:Object,required:!0},controller:{type:Lt,required:!0}},setup:function(t){var e=L("dropdown"),n=L("resource-dropdown-list"),r=t.controller,a=V(""),o=V({}),i=V([]),l=[{label:"容量计算"},{calcType:"WORKITEMCOUNT",weekdays:"${weekday}",dayCapacityVal:"${day_capacity.work_item_count}",label:"工作项数量",icon:Dt},{calcType:"ESTIMATEDWORKLOAD",weekdays:"${weekday}",dayCapacityVal:"${day_capacity.estimated_workload}",fieldName:"estimated_workload",label:"预估工时",icon:wt},{calcType:"REMAININGWORKLOAD",weekdays:"${weekday}",dayCapacityVal:"${day_capacity.remaining_workload}",fieldName:"remaining_workload",label:"剩余工时",icon:xt}],u=t.modelData.rawItem;u&&u.cssStyle&&(a.value=u.cssStyle);var s=P((function(){var r=t.modelData.id,a=[e.b(),n.b(),e.m(r)];return a.push.apply(a,b(t.controller.containerClass)),a}));Y((function(){i.value=l,o.value=l[1]}));var c=function(e){o.value=e;var n={};(Object.assign(n,e),delete n.icon,t.controller.panel.panelItems&&t.controller.panel.panelItems.gantt)&&t.controller.panel.panelItems.gantt.control.capacityCalcChange(n)};return{ns:e,ns2:n,c:r,curValue:o,items:i,classArr:s,tempStyle:a,handleItemClick:c,renderContent:function(){return j(F("el-dropdown"),{trigger:"click",class:n.b("dropdown"),"popper-class":n.b("dropdown-popper")},{default:function(){return j("span",{class:n.be("dropdown","content")},[o.value.icon&&j("span",{class:n.bem("dropdown","content","icon")},[o.value.icon()]),j("span",{class:n.bem("dropdown","content","text")},[o.value.label])])},dropdown:function(){return j(F("el-dropdown-menu"),null,{default:function(){return i.value.map((function(t){return j(F("el-dropdown-item"),{onClick:function(){return c(t)}},{default:function(){return[j("div",{class:n.be("dropdown-popper","content")},[t.icon&&j("span",{class:n.bem("dropdown-popper","content","icon")},[t.icon()]),j("span",{class:n.bem("dropdown-popper","content","text")},[t.label]),o.value.calcType===t.calcType&&j("span",{class:n.bem("dropdown-popper","content","correct")},[j("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("path",{d:"M6.012 11.201L1.313 6.832l-.817.879 5.54 5.15 9.304-9.163-.842-.855z"},null)])])])])]}})}))}})}})}}},render:function(){return j("div",{class:this.classArr,style:this.tempStyle},[this.renderContent()])}}),Rt=function(){function t(){i(this,t),o(this,"component","IBizResourceDropdownList")}var e;return u(t,[{key:"createController",value:(e=g(m().mark((function t(e,n,r){var a;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new Lt(e,n,r),t.next=3,a.init();case 3:return t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)}))),function(t,n,r){return e.apply(this,arguments)})}]),t}(),Mt=R(Nt,(function(t){t.component(Nt.name,Nt),E("CUSTOM_RESOURCE_DROPDOWN_LIST",(function(){return new Rt}))}));function At(){var t=V(!1),e=function(t,e){return{curDate:K(t),rangeStart:K(e.start).startOf("day"),rangeEnd:K(e.end).startOf("day").add(1,"day").subtract(1,"second")}};return{handleEmitMove:function(e,n){var r,a=e.startDate,o=e.endDate,i=a.clone(),l=o.clone();r=t.value?function(t){var e=t.startDate,n=t.endDate,r=t.dateRange,a=t.sliderLimit,o=K(e.date),i=K(n.date),l=i.diff(o,"hour");if(o.diff(o.startOf("day"),"hour")<12){if(o=o.startOf("day"),i=i.subtract(1,"day").startOf("day"),a&&r){var u=K(r.end).startOf("day").add(1,"day").subtract(1,"second"),s=K(r.start).startOf("day");(K(n.date).isAfter(u)||K(n.date).isSame(u))&&(i=u),(K(e.date).isBefore(s)||K(e.date).isSame(s))&&(o=s)}24===l&&(i=o)}else i=i.startOf("day"),o=o.add(1,"day").startOf("day"),24===l&&(o=i);return{start:o,end:i=i.add(1,"day").startOf("day").subtract(1,"second")}}(e):function(t){var e=t.startDate,n=t.endDate,r=K(e.date),a=K(n.date);return{start:r=r.startOf("day"),end:a=a.startOf("day").add(1,"day").subtract(1,"second")}}(e),t.value=!1,i.setDate(K(r.start)),l.setDate(K(r.end)),n({startDate:i,endDate:l,unit:"hour"})},handleSetStart:function(n,r){var a,o=n.x,i=n.type,l=n.startDate,u=n.endDate,s=n.sliderLimit,c=n.dateRange,d=n.ganttColumnWidth,f=n.currentMillisecond;t.value=!0;var p=l.getOffset(o/d*f).clone();"resize"===i&&(t.value=!1);var h=0;if(s&&c){var v=e(l.date,c),m=v.rangeStart,y=v.rangeEnd,g=u.getOffset(o/d*f),b=K(u.date),w=K(l.date),x=K(p.date),D=K(g.date);if("resize"===i){var C=b.subtract(1,"day").add(1,"second");x.isAfter(C)&&(p.setDate(C.toDate()),x=K(p.date)),x.isAfter(y.startOf("day"))&&(p.setDate(y.startOf("day").toDate()),x=K(p.date))}else{if(w.isBefore(m.add(1,"day"),"day")&&b.isAfter(y.subtract(1,"day"),"day"))return o;D.isAfter(y)&&(g.setDate(y.toDate()),D=K(g.date));var _=b.diff(w,"second"),k=D.diff(x,"second"),I=D.subtract(_,"second");h=D.add(1,"second").valueOf()-I.valueOf(),k>0&&k<=_&&I.isAfter(m)&&(p.setDate(I.toDate()),x=K(p.date))}x.isBefore(m)&&p.setDate(m.toDate())}return("r"===p.compareTo(u.getOffset(-864e5))||h>0)&&"resize"!==i&&(a=p.getOffset(h>0?h:864e5)),r({startDate:p,endDate:a,unit:"hour"}),o},handleSetEnd:function(n,r){var a=n.x,o=n.type,i=n.startDate,l=n.endDate,u=n.sliderLimit,s=n.dateRange,c=n.ganttColumnWidth,d=n.currentMillisecond;t.value=!0;var f,p=0,h=l.getOffset(a/c*d).clone();if("resize"===o&&(t.value=!1),u&&s){var v=e(l.date,s),m=v.rangeStart,y=v.rangeEnd,g=i.getOffset(a/c*d),b=K(i.date),w=K(l.date),x=K(h.date),D=K(g.date);if("resize"===o){var C=b.add(1,"day").subtract(1,"second");x.isBefore(C)&&(h.setDate(C),x=K(h.date)),x.isBefore(m.startOf("day").add(1,"day").subtract(1,"second"))&&(h.setDate(m.startOf("day").add(1,"day").subtract(1,"second").toDate()),x=K(h.date))}else{if(b.isBefore(m.add(1,"day"),"day")&&w.isAfter(y.subtract(1,"day"),"day"))return a;if(D.isBefore(m))return a;var _=w.diff(b,"second"),k=x.diff(D,"second"),I=D.add(_+1,"second");p=I.valueOf()-D.valueOf(),k>0&&k<=_&&I.isBefore(y)&&(h.setDate(I),x=K(h.date))}x.isAfter(y)&&h.setDate(y)}return"l"===h.compareTo(i.getOffset(864e5))&&"resize"!==o&&(f=h.getOffset(p>0?-p:-864e5)),r({startDate:f,endDate:h,unit:"hour"}),a},handleSliderLeft:function(t){var e=t.startDate,n=t.ganttHeader,r=t.currentMillisecond,a=t.ganttColumnWidth;return e.intervalTo(n.start)/r*a},handleSliderWidth:function(t){var e=t.startDate,n=t.endDate,r=t.currentMillisecond,a=t.ganttColumnWidth;return n.intervalTo(e)/r*a}}}var jt=A({name:"IBizResourceGanttControl",props:{modelData:{type:Object,required:!0},context:{type:Object,required:!0},params:{type:Object,default:function(){return{}}},provider:{type:Object},loadDefault:{type:Boolean,default:!0},mdctrlActiveMode:{type:Number,default:void 0},singleSelect:{type:Boolean,default:void 0}},setup:function(t){var n,o=M((function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e(_t,n)})),i=V(),l=V(),u=V(!1),s=L("control-".concat(o.model.controlType.toLowerCase())),c=L("control-resource-gantt"),d=V(),f=V(!0),p=At(),h=p.handleEmitMove,v=p.handleSetStart,y=p.handleSetEnd,w=p.handleSliderLeft,x=p.handleSliderWidth,D=V();D.value=U();var C=F("IBizRawItem"),_=F("IBizIcon"),k=!1,I=V({top:0,bottom:0}),O=V([]),S=function(){var t;if(Object.assign(I.value,{top:0,bottom:0}),l.value&&null!==(t=l.value)&&void 0!==t&&t.$el){var e,n,r=lt(null===(e=l.value)||void 0===e?void 0:e.$el),a=ut(null===(n=l.value)||void 0===n?void 0:n.$el);Object.assign(I.value,{top:r,bottom:a})}},E=[],T=["blue","light-blue","blue-cyan","pink","purple","violet","indigo","cyan","teal","green","light-green","lime","yellow","amber","orange","grey","sky-blue"],N=null===(n=q())||void 0===n?void 0:n.appContext.app;Y((function(){r.import("@ibiz-template-plugin/gantt").then((function(t){var e=t.default;null==N||N.use(e),u.value=!0}))}));var R=function(t){var e=document.documentElement;return getComputedStyle(e).getPropertyValue(t)},A=P((function(){var t,e;return{primaryColor:(null===(t=o.state.ganttStyle)||void 0===t?void 0:t.primaryColor)||R("--ibiz-color-bg-0"),textColor:(null===(e=o.state.ganttStyle)||void 0===e?void 0:e.textColor)||R("--ibiz-color-text-2")}})),z=P((function(){var t,e={};return null===(t=o.model.detreeNodes)||void 0===t||t.forEach((function(t,n){var r=n%T.length;e[t.id]="rgba(".concat(R("--ibiz-".concat(T[r],"-0")),", 1)")})),e})),B=P((function(){return!!o.state.isLoaded&&o.state.isLoading})),G=P((function(){var t,e,n;return o.state.onlyTopNodes?(n=o.state.rootNodes,o.model.rootVisible||(n=(null===(e=o.state.rootNodes[0])||void 0===e?void 0:e._children)||[]),n.map((function(t){var e={};return Object.assign(e,t),e._children&&(e._children=null),e}))):o.model.rootVisible?o.state.rootNodes:null===(t=o.state.rootNodes[0])||void 0===t||null===(t=t._children)||void 0===t?void 0:t.filter((function(t){return!d.value||t.name.includes(d.value)}))})),W=P((function(){var t=[];return o.state.columnStates.forEach((function(e){var n,r=null===(n=o.columns[e.key])||void 0===n?void 0:n.model;!e.hidden&&r&&t.push(r)})),t})),H=P((function(){return ibiz.i18n.getLang().toLowerCase()})),Q=function(t,e){k||f.value?f.value=!1:(o.onTreeNodeClick(t,e),k=!0,setTimeout((function(){k=!1}),200))},J=function(t){o.onDbTreeNodeClick(t)};o.evt.on("onNewRow",(function(t){if(i.value){var e=t.row.data;i.value.setExpand(e)}}));var Z=function(){var t;null===(t=i.value)||void 0===t||t.fullscreenChange()};o._evt.on("onFullscreenChange",(function(t){Z()}));var X,tt=function(t){d.value=t},ot=function(t){o.state.expandAll=t},it=function(t){console.log("抛值内容",t)},st=function t(e,n,r,a){var i=[];return e.forEach((function(e){if("SEPERATOR"!==e.itemType){var l=a[e.id];if(!l||l.visible){var u={};if(e.showCaption&&e.caption&&(u.label=e.caption),e.sysImage&&e.showIcon&&(u.icon=j(_,{icon:e.sysImage},null)),"DEUIACTION"===e.itemType){u.disabled=l.disabled,u.clickClose=!0;var s=e.uiactionId;s&&(u.onClick=function(){o.doUIAction(s,n,r,e.appId)})}else if("RAWITEM"===e.itemType){e.rawItem&&(u.label=j(C,{rawItem:e},null))}else if("ITEMS"===e.itemType){var c;null!==(c=e.detoolbarItems)&&void 0!==c&&c.length&&(u.children=t(e.detoolbarItems,n,r,a))}i.push(u)}}else i.push({divided:"self"})})),i};o.evt.on("onMounted",(function(){if(Object.values(o.contextMenus).length>0){r.import("@imengyu/vue3-context-menu").then((function(t){(X=t.default).default&&!X.showContextMenu&&(X=X.default)}))}}));var ct=function(){var t=g(m().mark((function t(e,n){var r,a,i,l;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.stopPropagation(),n.preventDefault(),null!=(r=o.getNodeModel(e._nodeId))&&r.decontextMenu){t.next=5;break}return t.abrupt("return");case 5:if((a=o.contextMenus[r.decontextMenu.id]).model.detoolbarItems){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,a.calcButtonState(e._deData||(e.srfkey?e:void 0),r.appDataEntityId);case 10:if(i=a.state.buttonsState,(l=st(a.model.detoolbarItems,e,n,i)).length){t.next=14;break}return t.abrupt("return");case 14:X.showContextMenu({x:n.x,y:n.y,customClass:s.b("context-menu"),items:l});case 15:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return{c:o,ns:s,ns2:c,fullscreenChange:Z,ganttRef:i,ganttBoxRef:l,isInited:u,ganttId:D,data:G,locale:H,columns:W,onCheck:function(t,e){if(t)E.push(e);else{var n=E.findIndex((function(t){return t._id===e._id}));n>-1&&E.splice(n,1)}o.setSelection(E)},loading:B,ganttStyle:A,onNodeClick:Q,onNodeDbClick:J,onNodeExpand:function(t){o.onExpandChange(t,!0),t&&!t._children&&o.refreshNodeChildren(t)},onNodeCollapse:function(t){o.onExpandChange(t,!1)},renderContent:function(){var t=W.value.map((function(t,e){return function(t,e){var n=t.caption,r=t.codeName,a=t.width,i=t.headerSysCss,l=t.align,u=o.columns[r];return j(F("x-gantt-column"),{label:n,prop:r,width:a&&a>30?a:30,center:"center"===(null==l?void 0:l.toLowerCase())},{title:function(e){var n=e.label;return"name"===r?j(kt,{key:r,model:t,controller:o,titleData:e,expandAll:o.state.expandAll,class:null==i?void 0:i.cssName,onExpandAllChange:ot,onHeadSearch:tt},null):j("div",{class:null==i?void 0:i.cssName},[n])},default:function(t){var e=t.row,n=t.column,a=t.level,i=o.getRowState(e._id);if(i){if("name"===r){var l,s=at(i,o.state.capacityConfig);e._parent&&(l=o.getRowState(e._parent._id));var c=!(!G.value||!G.value[0])&&G.value[0]._id===i.data._id;return S(),j(vt,{controller:u,capacityConfig:s,dateRange:o.state.dateRange,groupConfig:o.state.groupConfig,row:i,parentRow:l,column:n,level:a,isTopFirstIndex:c,key:i.data._uuid+r,ganttPosition:I.value,virtualTableVal:O.value},null)}var d=F(o.providers[r].component);return $(d,{controller:u,row:i,key:i.data._uuid+r})}return null}})}(t)})),e=j(F("x-gantt-slider"),{"allow-link":!1,move:o.state.sliderDraggable,"resize-left":o.state.sliderDraggable,"resize-right":o.state.sliderDraggable,"move-by-unit":!0,"slider-limit":o.state.sliderLimit,"emit-move":h,"set-start":v,"set-end":y,"slider-left":w,"slider-width":x},{content:function(t){var e=t.row,n=t.level,r=t.left;if(1!==n){var a=nt(o.state.sliderShowContent,e._deData||{}).replace(/^"(.*?)"$/,"$1"),i=r<0?"".concat(-r,"px"):"";return j("div",{class:[s.e("slider"),c.e("slider")],style:{background:z.value[e._nodeId]},onClick:function(t){return Q(e,t)},onDblclick:function(){return J(e)},onContextmenu:function(t){return ct(e,t)}},[a&&j("div",{class:c.em("slider","caption"),style:{marginLeft:i},title:a,innerHTML:a},null)])}}});return[].concat(b(t),[e])},renderGanttCell:function(t){if(1===t.level){var e=o.getRowState(t.row._id)||{},n=at(e,o.state.capacityConfig);if(rt(t.column.date,n.weekdays)){var r={};return Object.assign(r,a(a({},t),{},{row:e})),j(pt,{cellData:r,showText:o.state.showCapacity,capacityConfig:n,onCellClick:it},null)}}},renderGanttTitle:function(t){var e,n,r=t.column,a=function(t){var e=new Date(t);return["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][K(e).day()]}(r.date),o=(e=r.date,n="MM/DD",K(e).format(n));return j("div",{class:[s.b("column-title"),et(r.date)?s.be("column-title","today"):""]},[j("div",{class:s.be("column-title","top")},[a]),j("div",{class:s.be("column-title","bottom")},[o])])},onSliderMove:function(t){var e,n=null===(e=t[0])||void 0===e?void 0:e.row,r={begin:n._beginDataItemValue?K(n._beginDataItemValue).format("YYYY-MM-DD HH:mm:ss"):void 0,end:n._endDataItemValue?K(n._endDataItemValue).format("YYYY-MM-DD HH:mm:ss"):void 0};f.value=!0,o.modifyNodeTime(n,r)},renderNoData:function(){return o.state.isLoaded&&j(F("iBizNoData"),{text:o.model.emptyText,emptyTextLanguageRes:o.model.emptyTextLanguageRes},null)},onVirtualTableChange:function(t){O.value=t,S()}}},render:function(){var t,e=this;return this.isInited?W(j(F("iBizControlBase"),{ref:"ganttBoxRef",controller:this.c,class:[this.ns.b(),this.ns2.b(),null!==(t=this.data)&&void 0!==t&&t.length?"":this.ns.m("empty")]},{default:function(){return[j(F("x-gantt"),{ref:"ganttRef",id:e.ganttId,"data-id":"_id",data:e.data,"row-height":46,"show-expand":!0,"expand-all":e.c.state.expandAll,"start-key":"_beginDataItemValue","end-key":"_endDataItemValue",children:"_children",leaf:"_leaf",dateRange:e.c.state.dateRange,showWeekdays:e.c.state.showWeekdays,locale:e.locale,"header-height":46,preload:23,showCheckbox:!e.c.state.singleSelect,showToday:!1,showWeekend:!1,onNodeExpand:e.onNodeExpand,onNodeCollapse:e.onNodeCollapse,onRowClick:e.onNodeClick,onRowDblClick:e.onNodeDbClick,onRowChecked:e.onCheck,onMoveSlider:e.onSliderMove,onVirtualTableChange:e.onVirtualTableChange,primaryColor:e.ganttStyle.primaryColor,headerStyle:{textColor:e.ganttStyle.textColor}},{default:function(){return e.renderContent()},ganttCell:function(t){return e.renderGanttCell(t)},ganttTitle:function(t){return e.renderGanttTitle(t)},empty:function(){return e.renderNoData()}})]}}),[[H("loading"),this.loading]]):null}}),Vt=u((function t(){i(this,t),o(this,"component","IBizResourceGanttControl")})),Pt=t("IBizResourceGanttControl",R(jt,(function(t){t.component(jt.name,jt),T("TREE_RENDER_RESOURCE_GANTT",(function(){return new Vt}))})));t("default",{install:function(t){t.use(Pt),t.use(Tt),t.use(Mt)}})}}}))}();
