System.register(["@ibiz-template/runtime","@ibiz-template-plugin/design-base","@ibiz-template/core","qx-util","vue","@ibiz-template/vue3-util","lodash-es","vuedraggable","dayjs"],(function(e,t){"use strict";var s,i,a,n,r,o,l,c,d,h,u,m,p,f,g,v,y,b,w,I,D,E,P,C,x,A,O,M,S,T,R,k,L,N,_,F,B,z,j,U,V,G,H,Y,q,X,K,W,J,Z,$,Q,ee,te,se;return{setters:[function(e){s=e.ViewEngineBase,i=e.getControl,a=e.SysUIActionTag,n=e.ViewController,r=e.getPFPlugin,o=e.EditorController,l=e.PluginStaticResource,c=e.PanelItemController,d=e.registerPanelItemProvider,h=e.PanelItemState,u=e.UIActionUtil,m=e.AppDataEntity,p=e.QXEventEx,f=e.ButtonContainerState,g=e.UIActionButtonState,v=e.UIActionProviderBase,y=e.registerUIActionProvider,b=e.DEService,w=e.DEServiceUtil,I=e.registerViewProvider,D=e.registerEditorProvider},function(e){E=e.PreviewViewEngineBase,P=e.PreviewViewControllerBase,C=e.PreviewContentState,x=e.PreviewContentController,A=e.default},function(e){O=e.RuntimeModelError,M=e.recursiveIterate},function(e){S=e.QXEvent,T=e.createUUID,R=e.ascSort,k=e.isNilOrEmpty,L=e.notNilEmpty},function(e){N=e.defineComponent,_=e.computed,F=e.createVNode,B=e.resolveComponent,z=e.ref,j=e.watch,U=e.createTextVNode,V=e.reactive,G=e.provide,H=e.h,Y=e.isVNode,q=e.onMounted,X=e.onUnmounted,K=e.nextTick,W=e.inject},function(e){J=e.useNamespace,Z=e.getInputProps,$=e.getEditorEmits},function(e){Q=e.debounce,ee=e.clone},function(e){te=e.default},function(e){se=e.default}],execute:function(){var ie=Object.defineProperty,ae=(e,t,s)=>(((e,t,s)=>{t in e?ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);const ne=new class{constructor(){ae(this,"dndProviderMap",new Map)}registerItemProvider(e,t){this.dndProviderMap.set(e.toUpperCase(),t)}getItemProvider(e){const t=e.toUpperCase();if(this.dndProviderMap.has(t))return this.dndProviderMap.get(t);throw new Error("未找到".concat(t,"对应的拖拽组件绘制"))}};var re=Object.defineProperty,oe=(e,t,s)=>(((e,t,s)=>{t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class le{constructor(){oe(this,"_data",null),oe(this,"evt",new S)}get data(){return this._data}set(e){this._data=e,this.evt.emit("change",this._data)}get(){return this.data}reset(){this._data=null,this.evt.emit("change",null)}on(e){return this.evt.on("change",e)}off(e){this.evt.off("change",e)}}var ce=Object.defineProperty,de=(e,t,s)=>(((e,t,s)=>{t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);const he=new class{constructor(){de(this,"gridLayoutMode",["lg","md","sm","xs"])}getGridLayoutModeValue(e,t="",s=""){for(let i=0;i<this.gridLayoutMode.length;i++){const a=this.gridLayoutMode[i],n="".concat(t).concat(a).concat(s);if(null!=e[n])return e[n]}return""}getGridCol(e,t){let s=this.getGridLayoutModeValue(e,"col_");if(t&&!s&&(s=this.getGridLayoutModeValue(e,"child_col_")),(!s||s<="0"||s>"24")&&(s="24"),s){const e=parseInt(s,10);if("TABLE_12COL"===(null==t?void 0:t.layoutmode)&&e>0&&e<=12)return 2*e;if(e>0&&e<=24)return e}return null}getGridOffset(e,t){let s=this.getGridLayoutModeValue(e,"col_","_os");if(t&&!s&&(s=this.getGridLayoutModeValue(e,"child_col_","_os")),s){const e=parseInt(s,10);if("TABLE_12COL"===(null==t?void 0:t.layoutmode)&&e>0&&e<=12)return 2*e;if(e>0&&e<=24)return e}return null}calcColClass(e,t){const s={};if(t&&"FLEX"===t.layoutmode)return s;const i=this.getGridCol(e,t);i&&(s["el-col-".concat(i)]=!0);const a=this.getGridOffset(e,t);return a&&(s["el-col-offset-".concat(a)]=!0),s}getFlexLayoutStyle(e){return"FLEX"===e.layoutmode?{display:"flex","flex-direction":e.flexdir,"justify-content":e.flexalign,"align-items":e.flexvalign,"flex-grow":e.flexgrow,"flex-shrink":e.flexshrink,"flex-basis":"".concat(e.flexbasis,"px"),padding:"".concat(e.padding,"px")}:{padding:"".concat(e.padding,"px")}}getDraggableContainerClass(e,t){const s="FLEX"===e.layoutmode;return{[t.b("grid-layout")]:!s,[t.b("flex-layout")]:s,[t.b("flex-row")]:s&&e.flexdir&&-1===e.flexdir.indexOf("column"),[t.b("flex-column")]:s&&e.flexdir&&-1!==e.flexdir.indexOf("column")}}calcStyle(e,t){const s={};if(!e)return s;if(e){"FULL"===e.heightmode?s.height="auto":e.height?s.height=e.height+("PERCENTAGE"===e.heightmode?"%":"px"):t&&"PSSysViewPanel"===t.itemtype?"CONTAINER"!==t.itemtype&&"CTRLPOS"!==t.itemtype||(s["flex-grow"]=1):s.height="auto","FULL"===e.widthmode?s.width="auto":e.width&&(s.width=e.width+("PERCENTAGE"===e.widthmode?"%":"px"));const i="FLEX"===(null==t?void 0:t.layoutmode);i?(null!=e.flexgrow&&(s["flex-grow"]=e.flexgrow),null!=e.flexshrink&&(s["flex-shrink"]=e.flexshrink),null!=e.flexbasis&&(s["flex-basis"]="".concat(e.flexbasis,"px")),!t||t.flexdir&&-1===t.flexdir.indexOf("row")?Object.assign(s,this.getHorizontalAlign(e,t,i)):Object.assign(s,this.getVerticalAlign(e,t,i))):Object.assign(s,this.getHorizontalAlign(e,t,i)),Object.assign(s,this.getSwapMode(e)),Object.assign(s,this.getBorderStyle(e))}return s}getSwapMode(e){const t={};return e.swapmode&&("FLEX"===e.layoutmode?"NOWRAP"===e.swapmode?t["flex-wrap"]="nowrap":t["flex-wrap"]="wrap":"NOWRAP"===e.swapmode?t["white-space"]="nowrap":t["white-space"]="pre-wrap"),t}getBorderStyle(e){const t={};return e.spacingleft&&(-1!==e.spacingleft.indexOf("OUTER")?t["margin-left"]=this.getSpacingStyle(e.spacingleft.replace("OUTER","")):t["padding-left"]=this.getSpacingStyle(e.spacingleft.replace("INNER",""))),e.spacingright&&(-1!==e.spacingright.indexOf("OUTER")?t["margin-right"]=this.getSpacingStyle(e.spacingright.replace("OUTER","")):t["padding-right"]=this.getSpacingStyle(e.spacingright.replace("INNER",""))),e.spacingtop&&(-1!==e.spacingtop.indexOf("OUTER")?t["margin-top"]=this.getSpacingStyle(e.spacingtop.replace("OUTER","")):t["padding-top"]=this.getSpacingStyle(e.spacingtop.replace("INNER",""))),e.spacingbottom&&(-1!==e.spacingbottom.indexOf("OUTER")?t["margin-bottom"]=this.getSpacingStyle(e.spacingbottom.replace("OUTER","")):t["padding-bottom"]=this.getSpacingStyle(e.spacingbottom.replace("INNER",""))),t}getSpacingStyle(e){let t="0px";switch(e){case"NONE":default:t="0px";break;case"SMALL":t="8px";break;case"MEDIUM":t="16px";break;case"LARGE":t="24px"}return t}getHorizontalAlign(e,t,s=!1){const i={};switch(e.halignself||(null==t?void 0:t.height)){case"LEFT":s?i["align-self"]="flex-start":i.float="left";break;case"RIGHT":s?i["align-self"]="flex-end":i.float="right";break;case"CENTER":s?i["align-self"]="center":(i.margin="auto",i.float="none",i.display="table")}return i}getVerticalAlign(e,t,s=!1){const i={};switch(e.valignself||(null==t?void 0:t.valign)){case"TOP":s&&(i["align-self"]="flex-start");break;case"BOTTOM":s&&(i["align-self"]="flex-end");break;case"MIDDLE":s&&(i["align-self"]="center")}return i}};const ue=new class{isEnableUpdate(e){return!e||32768==(32768&e)}isEnableRemove(e){return!e||65536==(65536&e)}isEnableDrag(e){return!e||131072==(131072&e)}isEnableDrop(e){return!e||262144==(262144&e)}isEnablePlaceholder(e){return!!e&&524288==(524288&e)}};var me=Object.defineProperty,pe=(e,t,s)=>(((e,t,s)=>{t in e?me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class fe extends s{constructor(){super(...arguments),pe(this,"form"),pe(this,"navPos"),pe(this,"service")}async onCreated(){await super.onCreated();{const e=i(this.view.model,"form");if(!e)throw new O(this.view,"未找到主数据表单模型");this.form=e;const t=ibiz.hub.getApp(this.view.model.appId);this.service=await t.deService.getService(this.view.context,this.form.appDataEntityId)}this.onSelect=this.onSelect.bind(this),this.view.select.on(this.onSelect),this.view.modal.hooks.shouldDismiss.tapPromise((async e=>{if(!0===ibiz.uiDomainManager.get(this.view.context.srfsessionid).dataModification&&null==e.allowClose){const t=await ibiz.confirm.error({title:"关闭提醒",desc:"数据已经修改，确定要关闭？"});e.allowClose=!!t}})),await this.load();const e=this.view.state.data;e&&e.psdeid&&(this.view.context.psdataentity=e.psdeid)}onSelect(e){this.onActive(e)}async onMounted(){var e;await super.onMounted(),null==(e=this.toolbar)||e.calcButtonState(this.view.state.data,this.form.appDataEntityId),this.navPos=this.view.layoutPanel.panelItems.nav_pos,this.activeRoot(),this.view.evt.emit("onViewInfoChange",{dataInfo:this.view.state.data.srfmajortext||""})}async onDestroyed(){await super.onDestroyed(),this.view.select.off(this.onSelect)}activeRoot(){this.view.select.set(this.view.state.data)}async load(){try{this.view.startLoading();const e=await this.service.get(this.view.context,this.view.params);return this.service.local.add(this.view.context,e.data),this.view.state.data=e.data,e.data}finally{this.view.endLoading()}}async save(){var e;try{this.view.startLoading();const t=this.service.local.get(this.view.context,this.view.state.data.srfkey);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){"object"==typeof t[e]&&(t[e]=void 0)}const s=await this.service.update(this.view.context,t);return this.service.local.add(this.view.context,s.data),this.view.state.data=s.data,await this.view.evt.emit("onSaveSuccess",void 0),this.activeRoot(),this.view.evt.emit("onViewInfoChange",{dataInfo:this.view.state.data.srfmajortext||""}),null==(e=this.toolbar)||e.calcButtonState(this.view.state.data,this.form.appDataEntityId),s.data}finally{this.view.endLoading()}}async call(e,t){if(e===a.SAVE)return this.save();if("onActive"===e&&t)this.onActive(t);else{if("onActiveRoot"!==e)return super.call(e,t);this.activeRoot()}}onActive(e){var t;const s=this.view.model.appViewRefs;if(s){const i=e.srftype?e.srftype.toUpperCase():null,a=s.find((t=>t.name==="EDITDATA:".concat(e.srfdecodename.toUpperCase()).concat(i?":".concat(i):"")));if(!a)throw new O(this.view.model,"未匹配到对应[".concat(e.srftype,"]的属性编辑视图"));{const s=this.view.context.clone();s[e.srfdecodename.toLowerCase()]=e.srfkey,delete s.srfrunmode;const i=null==(t=this.view.layoutPanel)?void 0:t.panelItems.dnd_design_panel_item,n=i?i.getModelState(e):0;ue.isEnableUpdate(n)||(s.srfreadonly=!0),this.navPos.openView({key:e.srfkey,viewId:a.refAppViewId,context:s})}}}}var ge=Object.defineProperty,ve=(e,t,s)=>(((e,t,s)=>{t in e?ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);const ye=class e{constructor(){ve(this,"preViewProviderMap",new Map)}static getInstance(){return e.DndPreViewFactory||(e.DndPreViewFactory=new e),this.DndPreViewFactory}registerProvider(e,t){this.preViewProviderMap.set(e,t)}getProvider(e){return this.preViewProviderMap.get(e)}};ve(ye,"DndPreViewFactory");let be=ye;var we=Object.defineProperty,Ie=(e,t,s)=>(((e,t,s)=>{t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class De extends n{constructor(){super(...arguments),Ie(this,"select",new le),Ie(this,"preViewProvider")}getPreViewProvider(){return this.preViewProvider}async onCreated(){await super.onCreated();const{sysPFPluginId:e,appId:t}=this.model,s=r(e,t);if(s&&s.pluginParams){const e=s.pluginParams;Object.keys(e).forEach((t=>{e[t]&&"appId"!==t&&(this.context[t.toLowerCase()]=e[t])}))}const i=this.context.srfrunmode?this.context.srfrunmode:"RUNTIME";this.preViewProvider=be.getInstance().getProvider(i),await this.preViewProvider.init(this)}initEngines(){this.engines.push(new fe(this))}}var Ee=Object.defineProperty,Pe=(e,t,s)=>(((e,t,s)=>{t in e?Ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class Ce{constructor(){Pe(this,"component","IBizView")}createController(e,t,s,i){return new De(e,t,s,i)}}class xe extends E{}class Ae extends P{async initPreViewProvider(){this.preViewProvider=be.getInstance().getProvider("DESIGN"),await this.preViewProvider.init(this)}initEngines(){this.engines.push(new xe(this))}}var Oe=Object.defineProperty,Me=(e,t,s)=>(((e,t,s)=>{t in e?Oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class Se{constructor(){Me(this,"component","IBizView")}createController(e,t,s,i){return new Ae(e,t,s,i)}}class Te extends o{}var Re=Object.defineProperty,ke=(e,t,s)=>(((e,t,s)=>{t in e?Re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class Le{constructor(){ke(this,"formEditor","IBizEditorParmas"),ke(this,"gridEditor","IBizEditorParmas")}async createController(e,t){const s=new Te(e,t);return await s.init(),s}}var Ne=N({name:"IBizDraggableItem",props:{isSelect:{type:Boolean,default:!1},item:{type:Object,required:!0},actions:{type:Array,required:!1},modelState:{type:Number,required:!0},isShowMask:{type:Boolean}},setup:(e,{emit:t})=>({ns:J("dnd-design-draggable-item"),layoutStyle:_((()=>({width:e.item.width?"".concat(e.item.width,"px"):"",height:e.item.height?"".concat(e.item.height,"px"):""}))),onClick:(e,s)=>{e.stopPropagation(),t("action",s)}}),render(){var e,t;return F("div",{class:[this.ns.b(),this.ns.is("select",this.isSelect)],style:this.layoutStyle},[ue.isEnableDrag(this.modelState)&&F("div",{class:[this.ns.e("handle"),"handle"]},[F("svg",{viewBox:"64 64 896 896","data-icon":"drag",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",focusable:"false",class:""},[F("path",{d:"M909.3 506.3L781.7 405.6a7.23 7.23 0 0 0-11.7 5.7V476H548V254h64.8c6 0 9.4-7 5.7-11.7L517.7 114.7a7.14 7.14 0 0 0-11.3 0L405.6 242.3a7.23 7.23 0 0 0 5.7 11.7H476v222H254v-64.8c0-6-7-9.4-11.7-5.7L114.7 506.3a7.14 7.14 0 0 0 0 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V548h222v222h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V548h222v64.8c0 6 7 9.4 11.7 5.7l127.5-100.8a7.3 7.3 0 0 0 .1-11.4z"},null)])]),this.actions?F("ul",{class:this.ns.b("actions")},[this.actions.map((e=>{if("delete"!==e.command||ue.isEnableRemove(this.modelState))return F("li",{class:this.ns.be("actions","item"),title:e.tooltip,onClick:t=>this.onClick(t,e)},[e.icon])}))]):null,F("div",{class:[this.ns.b("content"),this.isShowMask?this.ns.bm("content","mask"):""]},[this.isShowMask&&F("div",{class:this.ns.be("content","mask")},null),null==(t=(e=this.$slots).default)?void 0:t.call(e)])])}}),_e=N({name:"IBizDraggableTabs",props:{value:{type:String},items:{type:Array,required:!0,default:()=>[]},dragSwitchPage:{type:Boolean,default:!0},select:{type:Object},dndDesignController:{type:Object,required:!0}},emits:["change","drag-change","remove","add"],setup(e,{emit:t}){const s=J("dnd-design-draggable-tabs"),i=J("light-theme-shell"),a=T(),n=s=>{s.srfkey===e.value&&e.select&&e.select.srfkey===e.value||t("change",s)},r=new Map;return{ns:s,shellNS:i,uuid:a,onDragChange:e=>{t("drag-change",e)},onItemClick:n,onConfirm:e=>{t("remove",e)},onAddButtonClick:e=>{e.stopPropagation(),t("add")},onDragenter:(t,s)=>{if(e.dragSwitchPage&&s.srfkey){const e=r.get(s.srfkey)||[],t=window.setTimeout((()=>{n(s),e.pop()}),500);e.push(t),r.set(s.srfkey,e)}},onDragLeave:(t,s)=>{if(e.dragSwitchPage&&s.srfkey){const e=r.get(s.srfkey);if(e){const t=e.pop();t&&clearTimeout(t)}}}}},render(){return F("div",{class:this.ns.b()},[F("div",{class:this.ns.b("header")},[F(B("iBizDraggable"),{class:this.ns.b("nav"),list:this.items,group:{name:this.uuid,pull:!1},filter:".".concat(this.ns.bm("item","forbid")),itemKey:"srfkey",onChange:this.onDragChange},{item:e=>{const{element:t,index:s}=e,i=this.value?this.value===t.srfkey:0===s,a=this.dndDesignController.getModelState(t);return F("div",{class:[this.ns.b("item"),this.ns.is("active",i),!ue.isEnableDrag(a)&&this.ns.bm("item","forbid")],onClick:e=>{e.stopPropagation(),this.onItemClick(t)},onDragenter:e=>this.onDragenter(e,t),onDragleave:e=>this.onDragLeave(e,t)},[F("div",{class:this.ns.be("item","text")},[t.srftext||""]),ue.isEnableRemove(a)&&F("div",{class:this.ns.be("item","remove-button")},[F(B("el-popconfirm"),{title:"确认删除表单分页?子数据将一并删除!","confirm-button-text":"确认","cancel-button-text":"取消",width:"auto",placement:"left","popper-class":[this.ns.be("item","pop-confirm"),this.shellNS.m("popper")],icon:F("ion-icon",{name:"alert-circle"},null),"icon-color":"#faad14",onConfirm:()=>this.onConfirm(t)},{reference:()=>F("ion-icon",{name:"close-outline",onClick:e=>{e.stopPropagation()}},null)})])])},footer:()=>F("div",{class:this.ns.b("item-add-button"),onClick:e=>this.onAddButtonClick(e),title:"新建分页"},[F("ion-icon",{name:"add-outline",class:this.ns.be("item-add-button","icon")},null)])})]),F("div",{class:this.ns.b("content")},[this.items.map(((e,t)=>{var s,i;const a=this.value?e.srfkey!==this.value:0!==t,n=this.dndDesignController.isShowMask(e);return F("div",{class:[this.ns.b("item-content"),this.ns.is("hidden",a),this.ns.is("select",this.select&&e.srfkey===this.select.srfkey),n?this.ns.bm("item-content","mask"):""],onClick:t=>{t.stopPropagation(),this.onItemClick(e)}},[n&&F("div",{class:this.ns.be("item-content","mask")},null),null==(i=(s=this.$slots).default)?void 0:i.call(s,e)])}))])])}}),Fe=N({name:"IBizFormShell",props:{context:{type:Object,required:!0},data:{type:Object,required:!0},items:{type:Object,required:!0}},setup(e){const t=J("form-shell"),s=J("light-theme-shell"),i=z(),a=(e,t,s)=>e.map((e=>{const i=e.psdeformdetails?a(e.psdeformdetails,t,e):[],n=t(e,s);return i.length>0&&(n["TABPANEL"===n.detailType?"deformTabPages":"deformDetails"]=i),n})),n=t=>a(t,((t,s)=>{let i={width:t.width,height:t.height,caption:t.caption,detailType:t.detailtype,id:t.psdeformdetailname,name:t.psdeformdetailname,appId:e.context.srfappid,codeName:t.psdeformdetailname,showCaption:0!==t.showcaption,sysImage:{appId:e.context.srfappid,cssClass:t.pssysimagename},detailStyle:t.detailstyle,layout:{appId:e.context.srfappid,layout:t.playoutmode,dir:t.flexdir,align:t.flexalign,valign:t.flexvalign},layoutPos:{appId:e.context.srfappid,layout:t.playoutmode,colXS:t.col_xs||(null==s?void 0:s.child_col_xs),colXSOffset:t.col_xs_os,colSM:t.col_sm||(null==s?void 0:s.child_col_sm),colSMOffset:t.col_sm_os,colMD:t.col_md||(null==s?void 0:s.child_col_md),colMDOffset:t.col_md_os,colLG:t.col_lg||(null==s?void 0:s.child_col_lg),colLGOffset:t.col_lg_os,basis:t.flexbasis,grow:t.flexgrow,shrink:t.flexshrink}};switch(i.detailType){case"FORMITEM":i={...i,emptyCaption:t.emptycaption,labelPos:t.labelpos||"LEFT",labelWidth:t.labelwidth,allowEmpty:0!==t.allowempty,hidden:"HIDDEN"===t.editortype,valueFormat:t.valueformat,enableCond:t.enablecond,enableItemPriv:t.enableitempriv,resetItemNames:t.resetitemname?t.resetitemname.split(";"):void 0,editor:{appId:e.context.srfappid,editorType:t.editortype||"SPAN",placeHolder:t.placeholder,editorItems:t.valueitemname?t.valueitemname.split(";"):void 0,editorHeight:t.ctrlheight,editorWidth:t.ctrlwidth}};break;case"TABPAGE":case"TABPANEL":case"FORMPAGE":case"GROUPPANEL":i={...i,enableAnchor:t.enableanchor,captionItemName:t.valueitemname,titleBarCloseMode:t.titlebarclosemode};break;case"IFRAME":i={...i,iframeUrl:t.editorparams};break;case"RAWITEM":i={...i,rawItem:{appId:e.context.srfappid,contentType:t.contenttype,caption:t.rawcontent||"",content:t.htmlcontent||"",sysImage:{appId:e.context.srfappid,cssClass:t.pssysimagename}}};break;case"BUTTONLIST":i={...i,uiactionGroup:{appId:e.context.srfappid,uiactionGroupDetails:[]}};break;case"MDCTRL":i={...i,contentType:t.mdctrltype}}return i}));return j((()=>e.items),(()=>{(async()=>{const t=e.data,s={controlType:t.formtype,appId:e.context.srfappid,codeName:t.codename,autoSaveMode:0,navBarPos:t.navbarpos,navBarStyle:t.navbarstyle,navBarWidth:t.navbarwidth||0,navbarHeight:t.navbarheight,navBarSysCss:{appId:e.context.srfappid,cssName:t.navbarpssyscssname},enableAutoSave:!1,enableCustomized:!1,infoFormMode:t.infoformflag,showFormNavBar:t.formnavbar,formFuncMode:t.funcmode,formStyle:t.formstyle,formWidth:t.formwidth,noTabHeader:0===t.showtabheader,tabHeaderPos:t.tabheaderpos,logicName:t.psdeformname,deformPages:n(e.items)};i.value=s})()}),{immediate:!0,deep:!0}),{ns:t,shellNS:s,modelData:i}},render(){return this.modelData?F("div",{class:this.ns.b()},["FORM"===this.modelData.controlType?F(B("iBizEditFormControl"),{data:{},isSimple:!0,class:[this.ns.m("light"),this.shellNS.b()],modelData:this.modelData,context:this.context},null):F(B("iBizSearchFormControl"),{data:{},isSimple:!0,class:[this.ns.m("light"),this.shellNS.b()],modelData:this.modelData,context:this.context},null)]):null}}),Be={install(e){e.component(Ne.name,Ne),e.component(_e.name,_e),e.component(Fe.name,Fe)}};const ze=new l(t.meta.url);var je=N({name:"IBizEditorParmas",props:Z(),emits:$(),setup(e,{emit:t}){var s;const i=e.controller,a=J("editor-params-custom"),n=z(!1);let r=null==(s=e.data)?void 0:s.editortype;const o=z(e.value),l=z({}),c={param:"",srfnavparam:"SRFNAVPARAM.",srfnavctx:"SRFNAVCTX."},d=z([]),h=z([]),u=e=>{if(!e)return;const t=e.split("\n"),s=[];t.forEach((e=>{if(!e)return;const t=e.indexOf("=");if(-1===t)return;const i=e.slice(0,t),a=e.slice(t+1);if(i)if(Object.prototype.hasOwnProperty.call(l.value,i))if(a)try{l.value[i]=JSON.parse(a)}catch(e){l.value[i]=a}else l.value[i]=void 0;else{let e=i,t="param";i.startsWith("SRFNAVPARAM.")?(e=i.slice(i.indexOf(".")+1),t="srfnavparam"):i.startsWith("SRFNAVCTX.")&&(e=i.slice(i.indexOf(".")+1),t="srfnavctx");const n={id:T(),key:e,value:a,type:t};s.push(n)}})),h.value=s},m=()=>{const e=[];h.value.forEach((t=>{t.key&&e.push("".concat(c[t.type]).concat(t.key,"=").concat(t.value))}));const s=[].join("\n"),i=e.join("\n");s?(o.value="".concat(s).concat(i?"\n".concat(i):""),t("change",o.value||null)):(o.value=i,t("change",o.value||null))};o.value&&u(o.value),j((()=>e.value),((e,t)=>{o.value&&u(o.value)})),j((()=>e.data),((t,s)=>{const i=null==t?void 0:t.editortype,a=e.value?e.value.toString():"";a?a===o.value&&i===r||u(a):h.value=[],r=i,o.value=a,m()}),{immediate:!0});return{ns:a,c:i,isCustom:n,changeIscustom:()=>{n.value=!n.value},dynamicItems:h,formItems:d,addDynamicParam:e=>{h.value.push({id:T(),key:"",value:"",type:e}),m()},editorParams:o,typeMap:c,formData:l,onEditorTypeChange:e=>{e?e!==r&&(d.value=[],l.value={}):(d.value=[],l.value={})},transformEditorParams:u,editorType:r,onCustomParamChange:e=>{Q((()=>{t("change",e)}),0)()},onDynamicParamChange:(e,t,s)=>{t[s]=e;Q((()=>{m()}),0)()},deleteDynamicParam:e=>{h.value.splice(e,1),m()}}},render(){return F("div",{class:this.ns.b()},[this.isCustom?F(B("el-input"),{class:[this.ns.e("param-textarea"),this.ns.is("readonly",this.readonly)],type:"textarea",rows:6,modelValue:this.editorParams,"onUpdate:modelValue":e=>this.editorParams=e,readonly:this.readonly,disabled:this.readonly,onInput:e=>this.onCustomParamChange(e)},null):F("div",{class:this.ns.e("param-container")},[F("div",{class:this.ns.e("param-list-from")},null),F("div",{class:this.ns.e("param-list-dynamic")},[this.dynamicItems.map(((e,t)=>F("div",{class:this.ns.e("param-item-dynamic"),key:e.id},[F("ion-icon",{src:ze.dir("./assets/svg/".concat(e.type,".svg")),class:this.ns.em("param-item-dynamic","icon")},null),this.readonly?[F("div",{class:[this.ns.em("param-item-dynamic","key"),this.ns.is("readonly",this.readonly)]},[e.key]),F("div",{class:[this.ns.em("param-item-dynamic","value"),this.ns.is("readonly",this.readonly)]},[e.value])]:[F(B("el-input"),{class:this.ns.em("param-item-dynamic","key"),modelValue:e.key,"onUpdate:modelValue":t=>e.key=t,onChange:t=>this.onDynamicParamChange(t,e,"key")},null),F(B("el-input"),{class:this.ns.em("param-item-dynamic","value"),modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,onChange:t=>this.onDynamicParamChange(t,e,"value")},null),F("ion-icon",{name:"close-outline",class:this.ns.em("param-item-dynamic","delete"),onClick:()=>this.deleteDynamicParam(t)},null)]])))])]),F("div",{class:this.ns.e("param-custom-button")},[F(B("el-button"),{size:"small",onClick:()=>this.changeIscustom()},{default:()=>["".concat(this.isCustom?"关闭":"开启","自定义")]}),this.readonly?null:F(B("el-dropdown"),{trigger:"click",size:"small",onCommand:this.addDynamicParam},{default:()=>F(B("el-button"),{size:"small"},{default:()=>[F("ion-icon",{name:"add-outline"},null)]}),dropdown:()=>F(B("el-dropdown-menu"),null,{default:()=>[F(B("el-dropdown-item"),{command:"param"},{default:()=>[U("参数")]}),F(B("el-dropdown-item"),{command:"srfnavparam"},{default:()=>[U("视图参数")]}),F(B("el-dropdown-item"),{command:"srfnavctx"},{default:()=>[U("视图上下文")]})]})})])])}}),Ue={install(e){e.component(je.name,je)}},Ve=Object.defineProperty,Ge=(e,t,s)=>(((e,t,s)=>{t in e?Ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class He extends c{constructor(){super(...arguments),Ge(this,"service"),Ge(this,"form"),Ge(this,"providers",{}),Ge(this,"controllers",{}),Ge(this,"items",[]),Ge(this,"timer",null),Ge(this,"isDisableMessage",!1),Ge(this,"showMaskType",["MDCTRL","GROUPPANEL","TABPANEL","TABPAGE","FORMPAGE"])}get view(){return this.panel.view}async onInit(){await super.onInit();const e=i(this.panel.view.model,"item");if(!e)throw new O(this.panel.view,"未找到 item 表单模型");this.form=e;const t=await ibiz.hub.getApp(this.model.appId);this.service=await t.deService.getService(this.panel.context,e.appDataEntityId),this.view.evt.on("onSaveSuccess",(async()=>{await this.load(),this.state.uuid=T()})),await this.load(),this.subscribeMessage()}updateHiddenFormItemVisible(e){this.state.hiddenFormItemVisible=e}onDataUpdate(e){if(!this.isDisableMessage&&e.data&&"object"==typeof e.data){const t=e.data;if(t.srfkey){const e=this.items.findIndex((e=>e.srfkey===t.srfkey));-1!==e&&(this.removeController(this.items[e]),this.items.splice(e,1,t),this.initItem(t),this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout((()=>{this.recalculateDeppItems()}),50))}}}sendMessage(e,t,s){this.isDisableMessage=!0,e.forEach((e=>{t?ibiz.mc.command.send(e,t):s&&ibiz.mc.command.next({...s,data:e})})),this.isDisableMessage=!1}subscribeMessage(){this.onDataUpdate=this.onDataUpdate.bind(this),ibiz.mc.command.update.on(this.onDataUpdate)}unsubscribeMessage(){ibiz.mc.command.update.off(this.onDataUpdate)}destroy(){super.destroy(),this.unsubscribeMessage()}async initItem(e){if("FORMPAGE"===e.srftype)return;const t="".concat(e.srfdecodename,"_").concat(e.srftype),s=ne.getItemProvider(t),i=s.createController(this,this.form,e);this.providers[e.srfkey]=s,this.controllers[e.srfkey]=i}async load(){const e=await this.service.fetchDefault(this.panel.context);this.items=e.data,this.items.forEach((e=>{this.initItem(e)})),this.state.items=this.calcDeepItems(this.items)}recalculateDeppItems(){this.state.items=this.calcDeepItems(this.items)}calcDeepItems(e,t){const s=[];return e.filter((e=>null==t?null==e.srfpkey:e.srfpkey===t.srfkey)).forEach((t=>{s.push(t);let i=this.calcDeepItems(e,t);i.length>0?(i=R(i,"srfordervalue"),t.children=V(i)):t.children=V([])})),s}change(e,t,s){if(e){const{added:i,moved:a}=e;if(i&&i.element){const a=i.element;if(!a.srfkey||Object.is(a.srfkey,""))t.splice(i.newIndex,1),this.add(e,t,s);else{a.srfpkey=s?s.srfkey:void 0;const{oldIndex:e,newIndex:n}=i;this.move(t,e,n)}}else if(a&&a.element){const{oldIndex:e,newIndex:s}=a;this.move(t,e,s)}}}async add(e,t,s){const i=e.added.newIndex,a=e.added.element,n=await this.service.getDraft(this.panel.context,a);if(n.ok){const{data:e}=n;a.caption&&"DESIGN"===this.panel.context.srfrunmode&&(a.caption=void 0),Object.assign(e,a),e.srfordervalue=10*(i+1),s&&(e.srfpkey=s.srfkey);const r=await this.service.create(this.panel.context,e);if(r.ok){const e=r.data;e.children=V([]),await this.initItem(e),this.items.push(e),this.sendMessage([e],void 0,{messageid:this.panel.context.srfsessionid,messagename:"command",type:"COMMAND",subtype:"OBJECTCREATED"}),t.splice(i,0,e),this.view.select.set(r.data),await this.move(t,i,t.length-1)}}}async move(e,t,s){const i=t>s?t:s,a=[];e.forEach(((e,t)=>{t>=0&&t<=i&&(e.srfordervalue=10*(t+1),a.push(e))}));const n=await this.service.update(this.panel.context,a);n.ok&&(Array.isArray(n.data)&&this.sendMessage(n.data,"OBJECTUPDATED"),ibiz.log.debug("排序成功"))}async remove(e,t){if((await this.service.remove(this.panel.context,{},t)).ok){const s=this.items.findIndex((e=>e.srfkey===t.srfkey)),i=e.findIndex((e=>e.srfkey===t.srfkey));if(s>-1){this.items.splice(s,1),e.splice(i,1),this.removeController(t),this.sendMessage([t],"OBJECTREMOVED");const a=e[0]||this.items.find((e=>e.srfkey===t.srfpkey));a?this.view.select.set(a):this.view.call("onActiveRoot"),this.recalculateDeppItems()}return!0}return!1}removeController(e){if("FORMPAGE"===e.srftype)return;this.controllers[e.srfkey].destroy(),delete this.controllers[e.srfkey]}getModelState(e){let t=0,s=e;for(;s;){if(s.modelstate){t=s.modelstate;break}let e=!1;const i=s.srfpkey;if(i){const t=this.controllers[i];if(t)s=t.data,e=!0;else{const t=this.items.find((e=>e.srfkey===i));t&&(s=t,e=!0)}}if(!e)break}return t}isShowMask(e){if(!e)return!1;const t=e.modelstate,s=ue.isEnablePlaceholder(t)&&this.showMaskType.includes(e.srftype);if(!s)return s;let i=e,a=!1;for(;i;){let e=!1;const t=i.srfpkey;if(t){const s=this.controllers[t];if(s)i=s.data,a=ue.isEnablePlaceholder(i.modelstate)&&this.showMaskType.includes(i.srftype)||a,e=!0;else{const s=this.items.find((e=>e.srfkey===t));s&&(i=s,a=ue.isEnablePlaceholder(i.modelstate)&&this.showMaskType.includes(i.srftype)||a,e=!0)}}if(!e)break}return!a}}var Ye=Object.defineProperty,qe=(e,t,s)=>(((e,t,s)=>{t in e?Ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class Xe{constructor(){qe(this,"component","IBizDndDesignPanelItem")}async createController(e,t,s){const i=new He(e,t,s);return await i.init(),i}}var Ke=N({name:"IBizDndDesignPanelItem",props:{modelData:{type:Object,required:!0},controller:{type:He,required:!0}},setup(e){const t=e.controller,s=z(),i=J("dnd-design"),a=J("light-theme-shell"),n=z("light");t.view.select.on((e=>{s.value=e}));const r=(e,a,n)=>{const o="dnd-design-".concat(a?a.srfkey:"root"),l=a?t.getModelState(a):0;return F(B("iBizDraggable"),{class:{[i.b("drag-container")]:!0,...a?he.getDraggableContainerClass(a,i):{}},style:a?he.getFlexLayoutStyle(a):{},itemKey:"srfkey",handle:".handle",key:o,group:{name:"dnd-design",put:ue.isEnableDrop(l)},"ghost-class":i.b("ghost"),list:e,onChange:s=>t.change(s,e,a)},{item:i=>{var o;let l;const c=i.element,d=t.providers[c.srfkey];if(!d)return null;const h=t.controllers[c.srfkey],u=B(d.component),m=t.getModelState(c);return"HIDDEN"!==c.editortype||t.state.hiddenFormItemVisible?F(B("iBizDraggableItem"),{class:a?he.calcColClass(c,a):{},style:a?he.calcStyle(c,a):{},controller:h,isSelect:(null==(o=s.value)?void 0:o.srfkey)===c.srfkey,key:c.srfkey,item:c,actions:h.actions,modelState:m,isShowMask:t.isShowMask(c),onClick:e=>((e,s)=>{e.stopPropagation(),t.view.select.set(s)})(e,c),onAction:s=>{h.onAction(s).then((i=>{!1===i&&"delete"===s.command&&t.remove(e,c)}))}},"function"==typeof(p=l=H(u,{controller:h,dndDesignController:t},n?n(e,c):c.children?()=>r(c.children,c):void 0))||"[object Object]"===Object.prototype.toString.call(p)&&!Y(p)?l:{default:()=>[l]}):null;var p}})};return G("dndDesignRenderItems",r),{ns:i,shellNS:a,theme:n,renderItems:r,renderFormPage:()=>F(B("iBizDndDesignFormPage"),{key:t.state.uuid,items:t.state.items,dndDesignController:t,select:s.value,onChange:e=>t.change(e,t.state.items),onRemove:e=>t.remove(t.state.items,e),onSelect:e=>{t.view.select.set(e)}},{default:e=>(e.children||(e.children=[]),r(e.children,e))}),onActiveRoot:e=>{e.stopPropagation(),t.view.call("onActiveRoot")}}},render(){return F("div",{class:[this.ns.b(),this.ns.m(this.theme),this.shellNS.b()],onClick:e=>{this.onActiveRoot(e)}},[F("div",{class:this.ns.b("container")},[this.renderFormPage()])])}}),We={install(e){e.component("IBizDndDesignPanelItem",Ke),d("RAWITEM_DND_DESIGN_PANEL_ITEM",(()=>new Xe))}},Je=Object.defineProperty,Ze=(e,t,s)=>(((e,t,s)=>{t in e?Je(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class $e extends h{constructor(){super(...arguments),Ze(this,"items",[]),Ze(this,"filterValue","")}}var Qe=Object.defineProperty,et=(e,t,s)=>(((e,t,s)=>{t in e?Qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class tt extends c{constructor(){super(...arguments),et(this,"codeList"),et(this,"codeItems",[]),et(this,"enableGroup",!1),et(this,"buttonGroupMap",new Map)}createState(){var e;return new $e(null==(e=this.parent)?void 0:e.state)}get view(){return this.panel.view}async onInit(){await super.onInit(),await this.load(),this.view.evt.on("onStencilSearch",(e=>{const t=e.eventArg||"";this.state.filterValue=t.trim().toLowerCase(),this.filter()}))}async load(){const e=this.model.editor;if(e){const{appCodeListId:t}=e;if(t){const e=await ibiz.hub.getApp(this.model.appId);this.codeList=e.codeList.getCodeList(t)}if(!this.codeList)throw new O(this.model,"未配置素材区代码表");this.codeItems=this.codeList.codeItems||[];const s=this.codeItems.findIndex((e=>!!(e.codeItems&&e.codeItems.length>1)));this.enableGroup=-1!==s,this.state.items=this.codeItems,this.filter()}else ibiz.log.warn("拖拽素材区控制器的 editor 为空")}filter(){this.state.filterValue?this.enableGroup?(this.state.items=[],this.codeItems.forEach((e=>{const t={...e};Array.isArray(t.codeItems)||(t.codeItems=[]),t.codeItems=t.codeItems.filter((e=>e.text&&e.text.toLowerCase().includes(this.state.filterValue))),this.state.items.push(t)}))):this.state.items=this.codeItems.filter((e=>e.text&&e.text.toLowerCase().includes(this.state.filterValue))):this.state.items=this.codeItems}async onActionClick(e,t){const s=e.uiactionId;await u.execAndResolved(s,{context:this.panel.context,params:this.panel.params,data:[],view:this.panel.view,event:t},e.appId)}}var st=Object.defineProperty,it=(e,t,s)=>(((e,t,s)=>{t in e?st(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class at{constructor(){it(this,"component","IBizDndStencilPanelItem")}async createController(e,t,s){const i=new tt(e,t,s);return await i.init(),i}}var nt=N({name:"IBizDndStencilPanelItem",props:{modelData:{type:Object,required:!0},controller:{type:tt,required:!0}},setup(e){const t=J("dnd-stencil"),s=e=>{const t=JSON.parse(e.data||"{}");return t.srftype=t.detailtype,t},i=e=>{const t=e.item;t&&t.style.setProperty("--svg-visibility","hidden")},a=e=>{const t=e.item;t&&t.style.setProperty("--svg-visibility","")},n=async(t,s)=>{await e.controller.onActionClick(t,s)};return{ns:t,renderGroup:(r,o,l,c)=>{const d=e.controller.buttonGroupMap.get(c),h=d&&d.model,u=d&&d.state,m=h&&h.uiactionGroup;return F(B("el-collapse-item"),{title:r,name:l.toString()},{title:()=>F("div",{class:t.b("group-header")},[F("div",{class:t.b("group-header-text")},[r]),m&&u?F(B("iBizActionToolbar"),{class:t.b("group-header-toolbar"),actionDetails:m.uiactionGroupDetails,actionsState:u,onActionClick:n,caption:m.name,mode:"ITEMS"===h.actionGroupExtractMode?"dropdown":"buttons"},null):null]),default:()=>0===o.length?F("div",{class:t.bm("drag-container","empty")},[U("暂无数据")]):F(B("iBizDraggable"),{itemKey:"dnd-stencil",sort:!1,group:{name:"dnd-design",pull:"clone",put:!1},class:t.b("drag-container"),list:o,clone:s,onStart:i,onEnd:a},{item:e=>{const s=e.element;return F("div",{key:e.index,class:[t.b("handle")],title:s.text},[F("svg",{class:t.be("handle","svg"),height:"100%",width:"100%",xmlns:"http://www.w3.org/2000/svg"},[F("rect",{height:"100%",width:"100%"},null)]),F("div",{class:[t.b("handle-content")]},[F("div",{class:[t.be("handle","icon")]},[s.iconPath?F("ion-icon",{src:ze.dir(s.iconPath)},null):null]),F("div",{class:[t.be("handle","text")]},[s.text])])])}})})},clone:s,actives:["0","1","2","3","4","5","6","7","8","9"]}},render(){const e=[];return this.controller.enableGroup?this.controller.state.items.forEach(((t,s)=>{e.push(this.renderGroup(t.text,t.codeItems,s,t.codeName))})):e.push(this.renderGroup(this.controller.codeList.name,this.controller.state.items,0,this.controller.codeList.codeName)),F("div",{class:this.ns.b()},[F(B("el-collapse"),{modelValue:this.actives,"onUpdate:modelValue":e=>this.actives=e},(t=e,"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!Y(t)?e:{default:()=>[e]}))]);var t}}),rt={install(e){e.component("IBizDndStencilPanelItem",nt),d("FIELD_DND_PANEL_ITEM_STENCIL",(()=>new at))}},ot=Object.defineProperty,lt=(e,t,s)=>(((e,t,s)=>{t in e?ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class ct extends h{constructor(){super(...arguments),lt(this,"items",[])}}class dt extends m{get srftext(){let e=this.caption;const t=this.psdefformitemname||this.psdefuimodename,s=this.psdeformdetailname||this.psdefname;if("FORMITEM"===this.detailtype){const i=this.logicname;return k(e)&&L(i)&&k(t)&&(e=i),L(e)?L(t)?"".concat(e,"(").concat(s,")[").concat(t,"]"):"".concat(e,"(").concat(s,")"):L(t)?"".concat(s,"(").concat(t,")"):s}return L(e)?"".concat(e,"(").concat(s,")"):s}get srftype(){return this.detailtype}set srftype(e){this.detailtype=e}get srfpkey(){return this.ppsdeformdetailid}set srfpkey(e){this.ppsdeformdetailid=e}get srfordervalue(){return this.ordervalue}set srfordervalue(e){this.ordervalue=e}clone(){const e=new dt(this._entity,this._data);return e.srfkey=this.srfkey,e}}class ht extends m{constructor(e,t,s){super(e,t),Object.defineProperty(this,"_typeCodeItems",{enumerable:!1,configurable:!0,value:s})}get srftext(){return"GROUP"===this.srftype?"".concat(this.groupop||""):"".concat(this.fdname||""," ").concat(this.psdbvalueopname||""," ").concat(this.condvalue||"")}get srftype(){return this.logictype}set srftype(e){this.logictype=e}get srficon(){const e=this._typeCodeItems.find((e=>e.value===this.srftype));return e?e.sysImage:void 0}get srfallowdrop(){return"GROUP"===this.srftype}clone(){const e=new ht(this._entity,this._data,this._typeCodeItems);return e.srfkey=this.srfkey,e}}var ut=Object.defineProperty,mt=(e,t,s)=>(((e,t,s)=>{t in e?ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class pt{constructor(e){mt(this,"entity"),mt(this,"parent",null),mt(this,"children",[]),this.entity=e}get id(){return this.entity.srfkey||""}get text(){return this.entity.srftext||""}get type(){return this.entity.srftype||""}}var ft=Object.defineProperty,gt=(e,t,s)=>(((e,t,s)=>{t in e?ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class vt extends c{constructor(){super(...arguments),gt(this,"codeList"),gt(this,"service"),gt(this,"form"),gt(this,"evt",new p),gt(this,"items",[]),gt(this,"timer",null),gt(this,"isDisableMessage",!1),gt(this,"codeItemList",[])}get view(){return this.panel.view}createState(){var e;return new ct(null==(e=this.parent)?void 0:e.state)}async onInit(){await super.onInit();const e=i(this.panel.view.model,"item");if(!e)throw new O(this.panel.view,"未找到 item 表单模型");this.form=e;const t=await ibiz.hub.getApp(this.model.appId);this.service=await t.deService.getService(this.panel.context,e.appDataEntityId);const s=this.model.editor;if(s){const{appCodeListId:e}=s;if(e&&(this.codeList=t.codeList.getCodeList(e)),!this.codeList)throw new O(this.model,"未配置结构区代码表");const i=this.codeList.codeItems||[],a=[];i.forEach((e=>{const t=e.value,s=e.codeItems;if(t&&Array.isArray(s)){const e=new Map;s.forEach((t=>{const s=t.value;s&&e.set(s,t)})),a.push({key:t,map:e})}})),this.codeItemList=a}this.view.evt.on("onSaveSuccess",(async()=>{await this.load()})),await this.load(),this.subscribeMessage()}getNodeIcon(e){const t=e.entity;for(let e=0;e<this.codeItemList.length;e++){const s=this.codeItemList[e],{key:i,map:a}=s,n=t[i];if(n&&a.get(n))return a.get(n).iconPath}}onDataUpdate(e){if(!this.isDisableMessage&&e.data&&"object"==typeof e.data){const t=e.data;if(t.srfkey){const e=this.items.findIndex((e=>e.srfkey===t.srfkey));-1!==e&&(this.items.splice(e,1),this.items.push(t),this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout((()=>{this.items=R(this.items,"srfordervalue"),this.state.items=this.transformItemsToTree(this.items),this.evt.emit("updateSelect")}),50))}}}onDataCreate(e){if(!this.isDisableMessage&&e.messageid===this.panel.context.srfsessionid&&e.data&&"object"==typeof e.data){const t=e.data;t.srfkey&&(this.items.push(t),this.items=R(this.items,"srfordervalue"),this.state.items=this.transformItemsToTree(this.items),this.evt.emit("updateSelect"))}}onDataRemove(e){if(!this.isDisableMessage&&e.data&&"object"==typeof e.data){const t=e.data;if(t.srfkey){const e=this.items.findIndex((e=>e.srfkey===t.srfkey));-1!==e&&(this.items.splice(e,1),this.items=R(this.items,"srfordervalue"),this.state.items=this.transformItemsToTree(this.items),this.evt.emit("updateSelect"))}}}sendMessage(e,t,s){this.isDisableMessage=!0,e.forEach((e=>{t?ibiz.mc.command.send(e,t):s&&ibiz.mc.command.next({...s,data:e})})),this.isDisableMessage=!1}subscribeMessage(){this.onDataUpdate=this.onDataUpdate.bind(this),this.onDataCreate=this.onDataCreate.bind(this),this.onDataRemove=this.onDataRemove.bind(this),ibiz.mc.command.update.on(this.onDataUpdate),ibiz.mc.command.create.on(this.onDataCreate),ibiz.mc.command.remove.on(this.onDataRemove)}unsubscribeMessage(){ibiz.mc.command.update.off(this.onDataUpdate),ibiz.mc.command.create.off(this.onDataCreate),ibiz.mc.command.remove.off(this.onDataRemove)}destroy(){super.destroy(),this.unsubscribeMessage()}async load(){const e=await this.service.fetchDefault(this.panel.context);if(e.ok&&Array.isArray(e.data)){const t=R(e.data,"srfordervalue");this.items=t,this.state.items=this.transformItemsToTree(t)}else this.state.items=[]}transformItemsToTree(e){const t={},s=[];return e.forEach((e=>{const s=e.srfkey;s&&(t[s]=new pt(e))})),e.forEach((e=>{const i=t[e.srfkey];if(i)if(e.srfpkey){const s=e.srfpkey?t[e.srfpkey]:null;s&&(i.parent=s,s.children.push(i))}else i.parent=null,s.push(i)})),s}change(e,t,s){s?(e.parent=s,e.entity.srfpkey=s.entity.srfkey):(e.parent=null,e.entity.srfpkey=void 0),this.move(t.map((e=>e.entity)),0,t.length-1)}async move(e,t,s){const i=t>s?s:t,a=t>s?t:s,n=[];e.forEach(((e,t)=>{t>=i&&t<=a&&(e.srfordervalue=10*(t+1),n.push(e))}));const r=await this.service.update(this.panel.context,n);r.ok&&(Array.isArray(r.data)&&this.sendMessage(r.data,"OBJECTUPDATED"),ibiz.log.debug("排序成功"))}}var yt=N({name:"IBizDndStructurePanelItem",props:{modelData:{type:Object,required:!0},controller:{type:vt,required:!0}},setup(e){const t=J("dnd-structure"),s=z(null),i=z("");j(i,(()=>{s.value&&s.value.filter(i.value)}));const a=e=>{if(s.value){if(e){if(s.value.getNode(e.srfkey))return void s.value.setCurrentKey(e.srfkey)}s.value.setCurrentKey()}};e.controller.view.select.on((e=>{a(e)})),q((()=>{a(e.controller.view.select.data)}));const n=()=>{K((()=>{a(e.controller.view.select.data)}))};e.controller.evt.on("updateSelect",n);return X((()=>{e.controller.evt.off("updateSelect",n)})),{ns:t,tree:s,searchValue:i,filterNode:(e,t)=>{if(!e)return!0;const s=e.trim().toLowerCase();return t.text.includes(s)},onCurrentNodeChange:t=>{t&&e.controller.view.select.set(t.entity)},allowDrag:e=>{const t=e.data;if(0===e.level||"FORMPAGE"===t.type)return!1;if(!i.value)return!0;return!i.value.trim().toLowerCase()},allowDrop:(e,t,s)=>{const i=e.data,a=t.data;if("inner"===s){return!!["GROUPPANEL","FORMPAGE"].includes(a.type)}return 0!==t.level&&("FORMPAGE"!==a.type||"FORMPAGE"===i.type)},onNodeDrop:(t,s,i)=>{const a=t.data,n=s.data;if("inner"===i)return void e.controller.change(a,n.children,n);const r=n.parent;r?e.controller.change(a,r.children,r):e.controller.change(a,e.controller.state.items)}}},render(){return F("div",{class:this.ns.b()},[F("div",{class:this.ns.b("header")},[F(B("el-input"),{modelValue:this.searchValue,"onUpdate:modelValue":e=>this.searchValue=e,"prefix-icon":F("ion-icon",{name:"search-outline"},null),clearable:!0},null)]),F("div",{class:this.ns.b("content")},[F(B("el-tree"),{ref:"tree",data:this.controller.state.items,"node-key":"id",props:{label:"text",children:"children"},indent:8,draggable:!0,"default-expand-all":!0,"expand-on-click-node":!1,"highlight-current":!0,"filter-node-method":this.filterNode,onCurrentChange:this.onCurrentNodeChange,"allow-drag":this.allowDrag,"allow-drop":this.allowDrop,onNodeDrop:this.onNodeDrop},{default:({data:e})=>{const t=this.controller.getNodeIcon(e);return F("div",{class:this.ns.b("node")},[F("div",{class:this.ns.be("node","icon")},[t?F("ion-icon",{src:ze.dir(t)},null):null]),F("div",{class:this.ns.be("node","text"),title:e.text},[e.text])])}})])])}}),bt=Object.defineProperty,wt=(e,t,s)=>(((e,t,s)=>{t in e?bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class It{constructor(){wt(this,"component","IBizDndStructurePanelItem")}async createController(e,t,s){const i=new vt(e,t,s);return await i.init(),i}}var Dt={install(e){e.component("IBizDndStructurePanelItem",yt),d("FIELD_DND_PANEL_STRUCTURE",(()=>new It))}};class Et extends c{get view(){return this.panel.view}sendMessage(e){this.view.evt.emit("onStencilSearch",{eventArg:e})}}var Pt=N({name:"IBizDndStencilSearchInput",props:{modelData:{type:Object,required:!0},controller:{type:Et,required:!0}},setup(e){const t=J("dnd-stencil-search-input"),s=z("");return j(s,(()=>{e.controller.sendMessage(s.value)})),{ns:t,searchValue:s}},render(){return F("div",{class:this.ns.b()},[F(B("el-input"),{modelValue:this.searchValue,"onUpdate:modelValue":e=>this.searchValue=e,placeholder:"输入关键词进行过滤","prefix-icon":F("ion-icon",{name:"search-outline"},null),clearable:!0},null)])}}),Ct=Object.defineProperty,xt=(e,t,s)=>(((e,t,s)=>{t in e?Ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class At{constructor(){xt(this,"component","IBizDndStencilSearchInput")}async createController(e,t,s){const i=new Et(e,t,s);return await i.init(),i}}var Ot={install(e){e.component("IBizDndStencilSearchInput",Pt),d("FIELD_DND_PANEL_ITEM_STENCIL_SEARCH",(()=>new At))}},Mt=N({name:"IBizHiddenFormItemSwitch",props:{modelData:{type:Object,required:!0},controller:{type:c,required:!0}},setup:e=>({ns:J("hidden-form-item-switch"),isActive:z(!1),activeText:"显示",inactiveText:"隐藏",handleChange:t=>{var s;const i=e.controller.panel.view;if(!i)return;const a=null==(s=i.layoutPanel)?void 0:s.panelItems.dnd_design_panel_item;a&&a.updateHiddenFormItemVisible(t)}}),render(){return F("div",{class:this.ns.b()},[F(B("el-switch"),{modelValue:this.isActive,"onUpdate:modelValue":e=>this.isActive=e,"active-text":this.activeText,"inactive-text":this.inactiveText,"inline-prompt":!0,size:"large",title:"".concat(this.isActive?this.inactiveText:this.activeText,"隐藏表单项"),onChange:this.handleChange},null)])}}),St=Object.defineProperty,Tt=(e,t,s)=>(((e,t,s)=>{t in e?St(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class Rt{constructor(){Tt(this,"component","IBizHiddenFormItemSwitch")}async createController(e,t,s){const i=new c(e,t,s);return await i.init(),i}}var kt={install(e){e.component(Mt.name,Mt),d("FIELD_HIDDEN_FORM_ITEM_SWITCH",(()=>new Rt))}},Lt=N({name:"IBizFormPreviewContent",props:{modelData:{type:Object,required:!0},controller:{type:Object,required:!0}},setup:()=>({ns:J("form-preview-content")}),render(){return F("div",{class:this.ns.b()},[F(B("iBizFormShell"),{data:this.controller.majorData,items:this.controller.state.items,context:this.controller.panel.context},null)])}});class Nt extends C{}class _t extends x{createState(){var e;return new Nt(null==(e=this.parent)?void 0:e.state)}async initItems(){const e=this.majorData.psdeformdetails||[];M({psdeformdetails:e},(e=>{this.view.preViewProvider.getTargetDataBySourceData("FORMDETAIL",[e])}),{childrenFields:["psdeformdetails"]}),this.state.items=e}}var Ft=Object.defineProperty,Bt=(e,t,s)=>(((e,t,s)=>{t in e?Ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class zt{constructor(){Bt(this,"component","IBizFormPreviewContent")}async createController(e,t,s){const i=new _t(e,t,s);return await i.init(),i}}var jt={install(e){e.component("IBizFormPreviewContent",Lt),d("RAWITEM_FORM_PREVIEW",(()=>new zt))}},Ut={install(e){e.component("IBizDraggable",te),e.use(We),e.use(rt),e.use(Dt),e.use(Ot),e.use(kt),e.use(jt)}},Vt=Object.defineProperty,Gt=(e,t,s)=>(((e,t,s)=>{t in e?Vt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class Ht{constructor(e,t,s){Gt(this,"actions",[{icon:F("ion-icon",{name:"trash-outline"},null),text:"删除",command:"delete"}]),this.c=e,this.data=s,this.model=t,this.select=e.view.select}async onAction(e){return!1}destroy(){}change(e,t,s){this.c.change(e,t,s)}async remove(e,t){return this.c.remove(e,t)}getItemCaption(){const e=this.c.view.getPreViewProvider();let t=ee(this.data);return e&&this.data&&(t=e.getTargetDataBySourceData("FORMDETAIL",[t])[0]),t.caption}}var Yt=N({name:"IBizDndDesignFormItem",props:{controller:{type:Ht,required:!0}},setup(e){const t=J("dnd-design-form-item"),s=()=>{const t=e.controller.data;return F(B("el-input"),{placeholder:t.srftext,disabled:!0},null)},i=()=>{const i=e.controller.data,a=(()=>{const t=e.controller.data;if(t&&t.rawcssstyle){const e=t.rawcssstyle.split("\n"),s=[];for(let t=0;t<e.length;t++)s.push(...e[t].split(";").filter((e=>e)));return s.filter((e=>2===e.split(":").length)).join(";")}})(),n="".concat(i.srftext),r=new Date;if(i)switch(i.editortype){case"HIDDEN":return F("div",{style:"padding-left: 10px;",class:"design-item-hidden"},[U("隐藏表单项")]);case"SPAN":return F("span",{style:"padding-left: 10px;".concat(a),class:"design-design-editor"},[n]);case"RADIOBUTTONLIST":return F(B("el-radio-group"),{"model-value":"",disabled:!0},{default:()=>[F(B("el-radio"),{label:"1"},{default:()=>[U("选项一")]}),F(B("el-radio"),{label:"2"},{default:()=>[U("选项二")]}),F(B("el-radio"),{label:"3"},{default:()=>[U("选项三")]})]});case"ADDRESSPICKUP":case"ADDRESSPICKUP_AC":return F(B("el-select"),{mode:"tags",style:"width: 100%",placeholder:n,disabled:!0},{default:()=>[F(B("el-option"),{value:"1"},{default:()=>[U("选项一")]}),F(B("el-option"),{value:"2"},{default:()=>[U("选项二")]}),F(B("el-option"),{value:"3"},{default:()=>[U("选项三")]})]});case"TEXTAREA":return F(B("el-input"),{placeholder:n,style:i.ctrlheight?"height: ".concat(i.ctrlheight,"px;"):"",class:t.e("textarea"),disabled:!0},null);case"TEXTAREA_10":return F(B("el-input"),{placeholder:n,rows:10,disabled:!0},null);case"PASSWORD":return F(B("el-input"),{placeholder:n,disabled:!0},null);case"DATEPICKEREX":case"DATEPICKEREX_SECOND":return F(B("el-date-picker"),{"model-value":se(r).format("YYYY-MM-DD HH:mm:ss"),format:"YYYY-MM-DD HH:mm:ss",disabled:!0},null);case"DATEPICKEREX_MINUTE":return F(B("el-date-picker"),{"model-value":se(r).format("YYYY-MM-DD HH:mm"),format:"YYYY-MM-DD HH:mm",disabled:!0},null);case"DATEPICKEREX_NODAY":return F(B("el-date-picker"),{"model-value":se(r).format("HH:mm:ss"),format:"HH:mm:ss",disabled:!0},null);case"DATEPICKEREX_NODAY_NOSECOND":return F(B("el-date-picker"),{"model-value":se(r).format("HH:mm"),format:"HH:mm",disabled:!0},null);case"DATEPICKEREX_NOTIME":return F(B("el-date-picker"),{"model-value":se(r).format("YYYY-MM-DD"),format:"YYYY-MM-DD",disabled:!0},null);case"DATEPICKEREX_HOUR":return F(B("el-date-picker"),{"model-value":se(r).format("YYYY-MM-DD HH"),format:"YYYY-MM-DD HH",disabled:!0},null);case"DATEPICKER":return F(B("el-date-picker"),{class:t.e("datepicker"),"model-value":se(r).format("YYYY-MM-DD HH:mm:ss"),format:"YYYY-MM-DD HH:mm:ss",disabled:!0},null);case"TEXTBOX":return F(B("el-input"),{style:a,placeholder:n,disabled:!0},null);case"FILEUPLOADER":return F(B("el-button"),{disabled:!0,class:t.e("fileuploader")},{default:()=>[F("ion-icon",{name:"cloud-upload-outline"},null),n]});case"AC":case"AC_NOBUTTON":case"AC_FS_NOBUTTON":case"AC_FS":case"PICKEREX_LINKONLY":case"PICKER":case"PICKUPVIEW":case"PICKEREX_LINK":case"PICKEREX_NOAC_LINK":case"PICKEREX_NOAC":case"PICKEREX_NOBUTTON":case"PICKEREX_TRIGGER_LINK":case"PICKEREX_TRIGGER":case"DROPDOWNLIST":case"MDROPDOWNLIST":case"DROPDOWNLIST_100":return F(B("el-select"),{"model-value":"选项一",style:"width: 100%",disabled:!0},{default:()=>[F(B("el-option"),{value:"选项一"},{default:()=>[U("选项一")]}),F(B("el-option"),{value:"选项二"},{default:()=>[U("选项二")]}),F(B("el-option"),{value:"选项三"},{default:()=>[U("选项三")]})]});case"CHECKBOX":return F(B("el-checkbox"),{disabled:!0},{default:()=>[U("选项")]});case"CHECKBOXLIST":return F(B("el-checkbox-group"),{disabled:!0},{default:()=>[F(B("el-checkbox"),{disabled:!0},{default:()=>[U("选项一")]}),U(";"),F(B("el-checkbox"),{disabled:!0},{default:()=>[U("选项二")]}),U(";")]});case"NUMBER":return F(B("el-input-number"),{class:t.e("number"),style:"width: 100%",disabled:!0},null);case"USERCONTROL":return F("span",null,[U("用户自定义")]);case"RATING":return F(B("el-rate"),{"text-color":"#ff9900","model-value":4,disabled:!0},null);case"SLIDER":return F(B("el-slider"),{"model-value":30,"show-input":!0,class:t.e("slider")},null);case"DATERANGE":return F(B("el-date-picker"),{"model-value":[r,r],type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD HH:mm:ss",disabled:!0,class:t.e("daterange")},null);case"ARRAY":return F("div",{class:t.e("panel-array-input")},[F(B("el-input"),{placeholder:n,disabled:!0},null),F(B("el-button"),{type:"primary",circle:!0,class:t.e("panel-array-input-add-button")},{default:()=>[F("ion-icon",{name:"add-outline"},null)]}),F(B("el-button"),{type:"danger",circle:!0,class:t.e("panel-array-input-remove-button")},{default:()=>[F("ion-icon",{name:"remove-outline"},null)]})]);case"MAPPICKER":return F(B("el-cascader"),{class:t.e("mappicker"),options:[{value:"省",label:"省",children:[{value:"市",label:"市",children:[{value:"区",label:"区"}]}]}],"model-value":["省","市","区"],disabled:!0},null);case"SWITCH":return F(B("el-switch"),{disabled:!0},null);default:return s()}return s()};return{ns:t,renderDesignItem:i,renderContent:()=>{const s=e.controller.data,a=e.controller.getItemCaption(),n=s,r=n.labelpos?n.labelpos.toLowerCase():"left",o=Object.is(r,"top")||Object.is(r,"bottom")?"":"width: ".concat(n.labelwidth||130,"px;"),l=((e,t)=>{let s="";return Object.is(t,"none")||Object.is(t,"top")||Object.is(t,"bottom")||"0"===e.showcaption?e.ctrlwidth?s+="width: ".concat(e.ctrlwidth,"px;"):s+="width: 100%;":e.ctrlwidth?s+="width: ".concat(e.ctrlwidth,"px;"):s+="width: calc(100% - ".concat(e.labelwidth||130,"px);"),e.ctrlheight?s+="height: ".concat(e.ctrlheight,"px;"):s+="height: 100%;",s})(n,r);return"FIELD"===n.itemtype?F("div",{class:"design-form-item ".concat(r||"left")},[F("div",{class:t.e("container-content"),style:{width:"100%",height:"100%"}},[i()])]):F("div",{class:"".concat(t.e("item-content")," ").concat(t.em("item-content",r||"left"))},["0"===n.showcaption?null:F("div",{class:t.e("label-content"),style:o},["1"===n.emptycaption?null:F("label",{class:t.e("label")},[Object.is(r,"right")?"：":"",a||"",Object.is(r,"right")?"":"："])]),F("div",{class:t.e("container-content"),style:l},[i()])])}}},render(){return F("div",{class:this.ns.b()},[F("div",{class:this.ns.e("wrapper")},null),this.renderContent()])}}),qt=Object.defineProperty,Xt=(e,t,s)=>(((e,t,s)=>{t in e?qt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class Kt{constructor(){Xt(this,"type","PSDEFORMDETAIL_FORMITEM"),Xt(this,"component","IBizDndDesignFormItem")}createController(e,t,s){return new Ht(e,t,s)}}var Wt={install(e){e.component(Yt.name,Yt);const t=new Kt;ne.registerItemProvider(t.type,t)}};function Jt(){return W("dndDesignRenderItems")}var Zt=N({name:"IBizDndDesignFormPanel",props:{controller:{type:Ht,required:!0}},setup:()=>({ns:J("dnd-design-group-panel"),renderItems:Jt()}),render(){const e=this.controller.data,t=0===e.showcaption;return F("div",{class:this.ns.b()},[t?F("div",{class:this.ns.b("info")},[e.srftext||""]):F("div",{class:this.ns.b("header")},[F("div",null,[F("div",{class:this.ns.be("header","text")},[e.srftext||""]),F("ion-icon",{class:this.ns.be("header","icon"),name:"caret-down"},null)])]),F("div",{class:this.ns.b("content")},[this.renderItems(e.children,e)])])}}),$t=Object.defineProperty,Qt=(e,t,s)=>(((e,t,s)=>{t in e?$t(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class es{constructor(){Qt(this,"type","PSDEFORMDETAIL_GROUPPANEL"),Qt(this,"component","IBizDndDesignFormPanel")}createController(e,t,s){return new Ht(e,t,s)}}var ts={install(e){e.component(Zt.name,Zt);const t=new es;ne.registerItemProvider(t.type,t)}};var ss=N({name:"IBizDndDesignRawItem",props:{controller:{type:Ht,required:!0}},setup(e){const t=J("dnd-design-raw-item");return{ns:t,renderContent:()=>{switch(e.controller.data.contenttype){case"RAW":return(()=>{const s=e.controller.data;return F("div",{class:t.e("raw")},[s.rawcontent||s.srftext||""])})();case"HTML":return(()=>{const s=e.controller.data;return s.htmlcontent?F("div",{class:t.e("html"),innerHTML:s.htmlcontent},null):F("div",{class:t.e("html")},[s.srftext||""])})();case"IMAGE":return F("div",{class:t.e("image")},[F("svg",{width:"56px",height:"56px",viewBox:"0 0 56 56",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},[F("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},[F("g",{id:"image-fill",transform:"translate(4.000000, 0.000000)",style:"fill: currentColor;","fill-rule":"nonzero"},[F("rect",{id:"矩形",opacity:"0",x:"0",y:"0",width:"48",height:"48"},null),F("path",{d:"M43.5,7.5 L4.5,7.5 C3.6703125,7.5 3,8.1703125 3,9 L3,39 C3,39.8296875 3.6703125,40.5 4.5,40.5 L43.5,40.5 C44.3296875,40.5 45,39.8296875 45,39 L45,9 C45,8.1703125 44.3296875,7.5 43.5,7.5 Z M15.84375,14.25 C17.4984375,14.25 18.84375,15.5953125 18.84375,17.25 C18.84375,18.9046875 17.4984375,20.25 15.84375,20.25 C14.1890625,20.25 12.84375,18.9046875 12.84375,17.25 C12.84375,15.5953125 14.1890625,14.25 15.84375,14.25 Z M39.9328125,34.7390625 C39.8671875,34.7953125 39.778125,34.828125 39.6890625,34.828125 L8.30625,34.828125 C8.1,34.828125 7.93125,34.659375 7.93125,34.453125 C7.93125,34.3640625 7.9640625,34.2796875 8.0203125,34.209375 L16.003125,24.740625 C16.134375,24.58125 16.3734375,24.5625 16.5328125,24.69375 C16.546875,24.7078125 16.565625,24.721875 16.5796875,24.740625 L21.2390625,30.271875 L28.65,21.4828125 C28.78125,21.3234375 29.0203125,21.3046875 29.1796875,21.4359375 C29.19375,21.45 29.2125,21.4640625 29.2265625,21.4828125 L39.9890625,34.2140625 C40.1109375,34.36875 40.0921875,34.6078125 39.9328125,34.7390625 Z",id:"形状"},null)])])])]);case"VIDEO":return F("div",{class:t.e("video")},[F("svg",{width:"56px",height:"56px",viewBox:"0 0 56 56",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},[F("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},[F("g",{id:"video",transform:"translate(4.000000, 4.000000)","fill-rule":"nonzero"},[F("rect",{id:"矩形",style:"fill: currentColor;",opacity:"0",x:"0",y:"0",width:"48",height:"48"},null),F("rect",{id:"矩形",style:"stroke: currentColor;","stroke-width":"2",x:"5",y:"5",width:"38",height:"38",rx:"2"},null),F("path",{d:"M19.842,16.7706563 L30.3061875,22.4005313 C31.4090625,22.993875 31.822125,24.369 31.2287812,25.4717812 C30.9959833,25.9045408 30.6289074,26.2499678 30.1828125,26.4560625 L19.7187188,31.290375 C18.5818125,31.8156563 17.2343438,31.3198125 16.7090625,30.1828125 C16.571335,29.8846905 16.5,29.560211 16.5,29.2318125 L16.5,18.767625 C16.5,17.5153125 17.5153125,16.5 18.767625,16.5 C19.142625,16.5 19.5118125,16.593 19.842,16.7706563 Z",id:"形状",style:"fill: currentColor;"},null)])])])]);case"PLACEHOLDER":return F("div",{class:t.e("placeholder")},[U("占位(PLACEHOLDER)")]);case"DIVIDER":return F(B("el-divider"),{class:t.e("divider")},{default:()=>[U("分割线(DIVIDER)")]});case"INFO":return F("div",{class:t.e("info")},[U("常规提示(INFO)")]);case"WARNING":return F("div",{class:t.e("warning")},[U("警告提示(WARNING)")]);case"ERROR":return F("div",{class:t.e("error")},[U("错误提示(ERROR)")]);default:return F("div",{class:t.e("default")},[U("直接内容")])}}}},render(){return F("div",{class:this.ns.b()},[this.renderContent()])}}),is=Object.defineProperty,as=(e,t,s)=>(((e,t,s)=>{t in e?is(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class ns{constructor(){as(this,"type","PSDEFORMDETAIL_RAWITEM"),as(this,"component","IBizDndDesignRawItem")}createController(e,t,s){return new Ht(e,t,s)}}var rs={install(e){e.component(ss.name,ss);const t=new ns;ne.registerItemProvider(t.type,t)}},os=N({name:"IBizDndDesignTabPage",setup:()=>()=>F("div",null,[U("分页面板")])}),ls=Object.defineProperty,cs=(e,t,s)=>(((e,t,s)=>{t in e?ls(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class ds{constructor(){cs(this,"type","PSDEFORMDETAIL_TABPAGE"),cs(this,"component","IBizDndDesignTabPage")}createController(e,t,s){return new Ht(e,t,s)}}var hs={install(e){e.component(os.name,os);const t=new ds;ne.registerItemProvider(t.type,t)}},us=N({name:"IBizDndDesignTabPanel",props:{controller:{type:Object,required:!0},dndDesignController:{type:Object,required:!0}},setup(e){const t=J("dnd-design-tab-panel"),s=e.controller,i=Jt(),a=z(),n=z(s.select.data);s.select.on((e=>{n.value=e}));j(n,(()=>{const e=s.data.children;if(Array.isArray(e)&&e.length&&n.value){const t=e.find((e=>e.srfkey===n.value.srfkey));t&&(a.value=t.srfkey)}}),{immediate:!0});return{ns:t,activePage:a,select:n,onActivePageChange:e=>{a.value=e.srfkey,s.select.set(e)},onPagePositionChange:async e=>{const t=s.data.children;Array.isArray(t)&&s.change(e,t,s.data)},onPageAdd:async()=>{const e=s.data.children;Array.isArray(e)&&(e.push({detailtype:"TABPAGE"}),s.change({added:{element:e[e.length-1],newIndex:e.length-1}},e,s.data))},onPageRemove:async e=>{const t=s.data.children;Array.isArray(t)&&s.remove(t,e)},renderItems:i}},render(){const e=this.controller.data.children||[];return F("div",{class:this.ns.b()},[F(B("iBizDraggableTabs"),{value:this.activePage,dndDesignController:this.dndDesignController,items:e,dragSwitchPage:!1,select:this.select,class:this.ns.b("content"),onChange:this.onActivePageChange,onDragChange:this.onPagePositionChange,onAdd:this.onPageAdd,onRemove:this.onPageRemove},{default:e=>this.renderItems(e.children,e)})])}}),ms=Object.defineProperty,ps=(e,t,s)=>(((e,t,s)=>{t in e?ms(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class fs{constructor(){ps(this,"type","PSDEFORMDETAIL_TABPANEL"),ps(this,"component","IBizDndDesignTabPanel")}createController(e,t,s){return new Ht(e,t,s)}}var gs={install(e){e.component(us.name,us);const t=new fs;ne.registerItemProvider(t.type,t)}},vs=N({name:"IBizDndDesignFormPage",props:{items:{type:Array,required:!0,default:()=>[]},select:{type:Object},dndDesignController:{type:Object,required:!0}},emits:["change","remove","select"],setup(e,{emit:t}){const s=J("dnd-design-form-page"),i=z();j((()=>e.select),(()=>{const t=e.items;if(Array.isArray(t)&&t.length&&e.select){const s=t.find((t=>t.srfkey===e.select.srfkey));s&&(i.value=s.srfkey)}}),{immediate:!0});return{ns:s,activePage:i,onActivePageChange:e=>{i.value=e.srfkey,t("select",e)},onPagePositionChange:async e=>{t("change",e)},onPageAdd:async()=>{const s=e.items;s.push({detailtype:"FORMPAGE"}),t("change",{added:{element:s[s.length-1],newIndex:s.length-1}})},onPageRemove:async e=>{t("remove",e)}}},render(){return F("div",{class:this.ns.b()},[F(B("iBizDraggableTabs"),{value:this.activePage,items:this.items,dndDesignController:this.dndDesignController,select:this.select,onChange:this.onActivePageChange,onDragChange:this.onPagePositionChange,onAdd:this.onPageAdd,onRemove:this.onPageRemove},{default:e=>{var t,s;return null==(s=(t=this.$slots).default)?void 0:s.call(t,e)}})])}}),ys={install(e){e.component(vs.name,vs)}},bs=N({name:"IBizDndDesignButton",props:{controller:{type:Ht,required:!0}},setup:()=>({ns:J("dnd-design-button")}),render(){const e=this.controller.data;return F("div",{class:this.ns.b()},[F(B("el-button"),{class:this.ns.b("content")},{default:()=>[0!==e.showcaption?e.srftext||"":"*"]})])}}),ws=Object.defineProperty,Is=(e,t,s)=>(((e,t,s)=>{t in e?ws(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class Ds{constructor(){Is(this,"type","PSDEFORMDETAIL_BUTTON"),Is(this,"component","IBizDndDesignButton")}createController(e,t,s){return new Ht(e,t,s)}}var Es={install(e){e.component(bs.name,bs);const t=new Ds;ne.registerItemProvider(t.type,t)}},Ps=N({name:"IBizDndDesignIframe",props:{controller:{type:Ht,required:!0}},setup:()=>({ns:J("dnd-design-iframe")}),render(){const e=this.controller.data;return F("div",{class:this.ns.b()},[F("div",{class:this.ns.b("content")},[e.srftext||"",U("[直接嵌入页面（iframe）]")])])}}),Cs=Object.defineProperty,xs=(e,t,s)=>(((e,t,s)=>{t in e?Cs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class As{constructor(){xs(this,"type","PSDEFORMDETAIL_IFRAME"),xs(this,"component","IBizDndDesignIframe")}createController(e,t,s){return new Ht(e,t,s)}}var Os={install(e){e.component(Ps.name,Ps);const t=new As;ne.registerItemProvider(t.type,t)}},Ms=N({name:"IBizDndDesignDRUIPart",props:{controller:{type:Ht,required:!0}},setup:()=>({ns:J("dnd-design-druipart")}),render(){const e=this.controller.data;return F("div",{class:this.ns.b()},[F("div",{class:this.ns.b("content")},[e.srftext||"",U("[关系]")])])}}),Ss=Object.defineProperty,Ts=(e,t,s)=>(((e,t,s)=>{t in e?Ss(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class Rs{constructor(){Ts(this,"type","PSDEFORMDETAIL_DRUIPART"),Ts(this,"component","IBizDndDesignDRUIPart")}createController(e,t,s){return new Ht(e,t,s)}}var ks={install(e){e.component(Ms.name,Ms);const t=new Rs;ne.registerItemProvider(t.type,t)}},Ls=N({name:"IBizDndDesignMDCtrl",props:{controller:{type:Ht,required:!0}},setup:()=>({ns:J("dnd-design-mdctrl")}),render(){const e=this.controller.data;return F("div",{class:this.ns.b()},[F("div",{class:this.ns.b("content")},[e.srftext||"",U("[多数据部件]")])])}}),Ns=Object.defineProperty,_s=(e,t,s)=>(((e,t,s)=>{t in e?Ns(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class Fs{constructor(){_s(this,"type","PSDEFORMDETAIL_MDCTRL"),_s(this,"component","IBizDndDesignMDCtrl")}createController(e,t,s){return new Ht(e,t,s)}}var Bs={install(e){e.component(Ls.name,Ls);const t=new Fs;ne.registerItemProvider(t.type,t)}},zs=N({name:"IBizDndDesignFormItemEx",props:{controller:{type:Object,required:!0}},setup:()=>({ns:J("dnd-design-form-item-ex")}),render(){const e=this.controller.data;return F("div",{class:this.ns.b()},[F("div",{class:this.ns.b("content")},[e.srftext||"",U("[复合表单项]")])])}}),js=Object.defineProperty,Us=(e,t,s)=>(((e,t,s)=>{t in e?js(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class Vs{constructor(){Us(this,"type","PSDEFORMDETAIL_FORMITEMEX"),Us(this,"component","IBizDndDesignFormItemEx")}createController(e,t,s){return new Ht(e,t,s)}}var Gs={install(e){e.component(zs.name,zs);const t=new Vs;ne.registerItemProvider(t.type,t)}},Hs=N({name:"IBizDndDesignButtonList",props:{controller:{type:Ht,required:!0}},setup(e){const t=J("dnd-design-button-list"),s=z([]),i=z(0);return j((()=>e.controller.data),((t,a)=>{i.value<=1&&(i.value+=1);const n=null==a?void 0:a.psdeuagroupid;(null==t?void 0:t.psdeuagroupid)!==n&&(async()=>{s.value=[];const t=e.controller.c.panel.context.clone(),a=e.controller.data,n=ibiz.hub.getApp(t.srfappid),r=await n.deService.getService(t,"PSDEUAGroup");if(r&&a.psdeuagroupid){t.psdeuagroup=a.psdeuagroupid;const e=await r.get(t);if(e&&e.ok&&e.data){if(i.value>1&&(!Array.isArray(e.data.psdeuagrpdetails)||!e.data.psdeuagrpdetails.length))return void ibiz.message.warning("当前绑定界面行为组未配置界面行为");Array.isArray(e.data.psdeuagrpdetails)&&(s.value=e.data.psdeuagrpdetails)}}})()}),{immediate:!0}),{ns:t,items:s}},render(){const e=this.controller.data;if(e)return e.psdeuagroupid?"ITEMS"===e.updatedvt?F("div",{class:this.ns.b()},[F("div",{class:this.ns.b("item")},[F(B("el-button"),null,{default:()=>[U("...")]})])]):F("div",{class:this.ns.b()},[this.items.map((e=>F("div",{class:this.ns.b("item")},[F(B("el-button"),null,{default:()=>[e.uacaption||""]})])))]):F("div",{class:this.ns.b()},[F("div",{class:this.ns.b("placeholder")},[F("ion-icon",{class:this.ns.be("placeholder","icon"),src:ze.dir("./assets/svg/action-button.svg")},null),F("div",{class:this.ns.be("placeholder","text")},[U("按钮组")])])])}}),Ys=Object.defineProperty,qs=(e,t,s)=>(((e,t,s)=>{t in e?Ys(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class Xs{constructor(){qs(this,"type","PSDEFORMDETAIL_BUTTONLIST"),qs(this,"component","IBizDndDesignButtonList")}createController(e,t,s){return new Ht(e,t,s)}}var Ks={install(e){e.component(Hs.name,Hs);const t=new Xs;ne.registerItemProvider(t.type,t)}},Ws={install(e){e.use(Wt),e.use(ts),e.use(rs),e.use(hs),e.use(gs),e.use(ys),e.use(Es),e.use(Os),e.use(ks),e.use(Bs),e.use(Gs),e.use(Ks)}},Js=Object.defineProperty,Zs=(e,t,s)=>(((e,t,s)=>{t in e?Js(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class $s extends tt{constructor(){super(...arguments),Zs(this,"app"),Zs(this,"form"),Zs(this,"service"),Zs(this,"fieldForm"),Zs(this,"fieldService"),Zs(this,"fieldItems",[]),Zs(this,"items",[]),Zs(this,"enableGroup",!0),Zs(this,"mdCtrlFieldType",["ONE2MANYDATA","ONE2ONEDATA","ONE2MANYDATA_MAP","ONE2MANYOBJ","ONE2ONEOBJ","ONE2MANYOBJ_MAP"])}get view(){return this.panel.view}async onInit(){this.app=await ibiz.hub.getApp(this.model.appId);const e=i(this.panel.view.model,"item");if(!e)throw new O(this.panel.view,"未找到 item 表单模型");this.form=e,this.service=await this.app.deService.getService(this.panel.context,e.appDataEntityId);const t=i(this.panel.view.model,"EDITFORM"===this.view.state.data.formtype?"field":"uimode");if(!t)throw new O(this.panel.view,"未找到 field 表单模型");this.fieldForm=t,this.fieldService=await this.app.deService.getService(this.panel.context,t.appDataEntityId);const s=this.model.editor;if(s){const{appCodeListId:e}=s;if(e&&(this.codeList=this.app.codeList.getCodeList(e)),!this.codeList)throw new O(this.model,"未配置属性项代码表")}else ibiz.log.warn("拖拽素材区控制器的 editor 为空");await this.initButtonGroup(),this.view.evt.on("onSaveSuccess",(async()=>{await this.load()})),await super.onInit(),this.debounceTransformFieldItems=Q(this.debounceTransformFieldItems,50),this.subscribeMessage()}async initButtonGroup(){var e;if(this.fieldForm){const t=this.fieldForm.deformPages;if(!Array.isArray(t)||!t[0])return void ibiz.log.warn("field 表单模型未配置表单分页");const s=t[0].deformDetails,i=null==s?void 0:s.find((e=>"filed_group"===e.codeName));if(!i)return void ibiz.log.warn("field 表单模型未配置标识为 filed_group 表单分组");const a=await this.initActionStates(i);null==(e=this.codeList.codeItems)||e.forEach((e=>{e.codeName&&a&&this.buttonGroupMap.set(e.codeName,{model:i,state:a})}))}}async initActionStates(e){var t;const{uiactionGroup:s}=e;if(!(null==(t=null==s?void 0:s.uiactionGroupDetails)?void 0:t.length))return;const i=new f;return s.uiactionGroupDetails.forEach((e=>{const t=e.uiactionId;if(t){const s=new g(e.id,this.panel.context.srfappid,t);i.addState(e.id,s)}})),await i.update(this.panel.context),i}onDataUpdate(e){if(e.data&&"object"==typeof e.data){const t=e.data;if(t.srfkey){const e=this.items.findIndex((e=>e.srfkey===t.srfkey));-1!==e&&(this.items[e]=t,this.debounceTransformFieldItems())}}}onDataCreate(e){if(e.messageid===this.panel.context.srfsessionid&&e.data&&"object"==typeof e.data){const t=e.data;t.srfkey&&(this.items.push(t),this.transformFieldItems())}}onDataRemove(e){if(e.data&&"object"==typeof e.data){const t=e.data;if(t.srfkey){-1!==this.items.findIndex((e=>e.srfkey===t.srfkey))&&this.loadItems()}}}subscribeMessage(){this.onDataUpdate=this.onDataUpdate.bind(this),this.onDataCreate=this.onDataCreate.bind(this),this.onDataRemove=this.onDataRemove.bind(this),ibiz.mc.command.update.on(this.onDataUpdate),ibiz.mc.command.create.on(this.onDataCreate),ibiz.mc.command.remove.on(this.onDataRemove)}unsubscribeMessage(){ibiz.mc.command.update.off(this.onDataUpdate),ibiz.mc.command.remove.off(this.onDataRemove),ibiz.mc.command.create.off(this.onDataCreate)}destroy(){super.destroy(),this.unsubscribeMessage()}async load(){const e=await this.fieldService.exec("fetchcurde",this.panel.context,{n_psdeid_eq:this.view.state.data.psdeid,n_usertag4_noteq:"INTENAL"});this.state.items=this.codeList.codeItems||[],e.ok&&Array.isArray(e.data)&&(this.fieldItems=e.data,await this.loadItems())}async loadItems(){const e=await this.service.fetchDefault(this.panel.context);e.ok&&Array.isArray(e.data)&&(this.items=e.data,this.transformFieldItems())}filterFieldItems(){const e=[],t=this.view.state.data,s=this.items.map((s=>{if("FORMITEM"===s.detailtype){if("EDITFORM"===t.formtype)return"|".concat(s.psdefid);if("SEARCHFORM"===t.formtype)return"|".concat(s.psdefsfitemid)}return"MDCTRL"===s.detailtype&&s.psdefid&&e.push(s.psdefid),""})).join("");return this.fieldItems.filter((t=>this.mdCtrlFieldType.includes(t.psdatatypeid)?!e.includes(t.srfkey):!(!t.srfkey||-1!==s.indexOf("|".concat(t.srfkey)))))}debounceTransformFieldItems(){this.transformFieldItems()}transformFieldItems(){const e=this.filterFieldItems();this.state.items.forEach((t=>{const s=JSON.parse(t.data||"{}");t.codeItems=e.map((e=>{let i=e.logicname||e.caption;return(e.psdefsfitemname||e.psdefieldname)&&(i+="[".concat(e.psdefsfitemname||e.psdefieldname,"]")),"EDITFORM"===this.view.state.data.formtype?{appId:t.appId,text:i,iconPath:t.iconPath,data:JSON.stringify({...s,caption:e.logicname,logicname:e.logicname,psdefid:e.psdefieldid,psdefname:e.psdefieldname,detailtype:this.mdCtrlFieldType.includes(e.psdatatypeid)?"MDCTRL":"FORMITEM",formtype:this.view.state.data.formtype})}:{appId:t.appId,text:i,iconPath:t.iconPath,data:JSON.stringify({...s,caption:e.logicname,logicname:e.logicname,psdefsfitemid:e.psdefsfitemid,psdefsfitemname:e.psdefsfitemname,psdefname:e.psdefname,psdefid:e.psdefid,detailtype:"FORMITEM",formtype:this.view.state.data.formtype})}}))})),this.codeItems=this.state.items,this.filter()}}var Qs=Object.defineProperty,ei=(e,t,s)=>(((e,t,s)=>{t in e?Qs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class ti{constructor(){ei(this,"component","IBizDndStencilPanelItem")}async createController(e,t,s){const i=new $s(e,t,s);return await i.init(),i}}var si={install(e){d("FIELD_DND_PANEL_ITEM_STENCIL_FIELD",(()=>new ti))}};class ii extends v{async execAction(e,t){const s=t.view.layoutPanel;if(s){const e=s.panelItems;if(e){const t=e.dnd_panel_item_stencil_field;t&&await t.load()}}return{}}}var ai={install(e){y("FRONT_RefreshField",(()=>new ii))}},ni=Object.defineProperty,ri=(e,t,s)=>(((e,t,s)=>{t in e?ni(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class oi{constructor(){ri(this,"uiModes",[]),ri(this,"fields",[])}async init(e){const t=e.model,s=ibiz.hub.getApp(t.appId),a=e.context.psdataentity,n=i(t,"uimode");if(n){const t=await s.deService.getService(e.context,n.appDataEntityId),i=await t.fetchDefault(e.context,{n_psdeid_eq:a,size:1e3});i.ok&&i.data&&(this.uiModes=i.data)}const r=i(t,"field");if(r){const t=await s.deService.getService(e.context,r.appDataEntityId),i=await t.fetchDefault(e.context,{size:1e3});i.ok&&i.data&&(this.fields=i.data)}}findUIMode(e){return this.uiModes.find((t=>{if("SEARCHFORM"===e.formtype&&e.psdefsfitemid===t.psdefsfitemid||"EDITFORM"===e.formtype&&e.psdefid===t.psdefid)return t}))}getFormItemPreviewData(e){if("FORMITEM"===e.detailtype&&L(e.psdefid)){const t=this.findUIMode(e);if(t&&(k(e.caption)&&t.caption&&(e.caption=t.caption),k(e.editortype)&&t.editortype&&(e.editortype=t.editortype),k(e.ctrlheight)&&t.ctrlheight&&(e.ctrlheight=t.ctrlheight),k(e.ctrlwidth)&&t.ctrlwidth&&(e.ctrlwidth=t.ctrlwidth)),!k(e.editortype)&&!k(e.caption))return e;const s=this.fields.find((t=>{if(t.psdefieldid===e.psdefid)return t}));s&&k(e.caption)&&(e.caption=s.logicname)}return e}getTargetDataBySourceData(e,t){return"FORMDETAIL"===e?t.map((e=>this.getFormItemPreviewData(e))):t}getPropertyByTag(e){return[]}}class li{async init(e){}getTargetDataBySourceData(e,t){return t}getPropertyByTag(e){return[]}}var ci={install(e){be.getInstance().registerProvider("DESIGN",new oi),be.getInstance().registerProvider("RUNTIME",new li)}};class di extends b{async exec(e,t,s,i){return"Create"===e&&s&&(Array.isArray(s)?await Promise.all(s.map((e=>this.calcDefault(t,e)))):await this.calcDefault(t,s)),super.exec(e,t,s,i)}async calcDefault(e,t){let s=1;const i=t.detailtype;let a=i;if("FORMITEM"===i&&(s=0,a=t.detailtype,t.psdefname&&(a=t.psdefname),"SEARCHFORM"===t.formtype&&(a=t.psdefsfitemname),k(a)&&(a=t.srfdecodename)),k(a))return;a=a.toLowerCase();const n=await this.fetchTempDefault(e);if(n.ok&&n.data){const e=n.data,i=new Map,r=new Map;for(e.forEach((e=>{L(e.psdeformdetailname)&&i.set(e.psdeformdetailname.toLowerCase(),e),L(e.psdeformdetailid)&&r.set(e.psdeformdetailid.toLowerCase(),e)}));;){const e=a+(0===s?"":s);if(!i.has(e)&&!r.has(e)){t.psdeformdetailname=e,t.psdeformdetailid=e;break}s+=1}}k(t.srfdecodename)&&k(t.logicname)&&("FORMPAGE"===i?t.logicname="表单分页":"GROUPPANEL"===i?t.logicname="分组面板":"TABPAGE"===i?t.logicname="分页":"BUTTON"===i?t.logicname="按钮":"USERCONTROL"===i?t.logicname="自定义部件":"RAWITEM"===i?t.logicname="直接内容":"DRUIPART"===i?t.logicname="关系界面":"FORMITEM"===i?t.logicname="表单项":"FORMITEMEX"===i?t.logicname="复合表单项":"FORMPART"===i?t.logicname="表单部件":"IFRAME"===i?t.logicname="嵌入页面(iframe)":"TABPANEL"===i?t.logicname="分页面板":"DATAGRID"===i&&(t.logicname="数据表格"))}newEntity(e){return e instanceof dt?e.clone():new dt(this.model,e)}}var hi=Object.defineProperty,ui=(e,t,s)=>(((e,t,s)=>{t in e?hi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class mi extends b{constructor(e,t){super(e,t),ui(this,"typeCodeItems");const s=ibiz.hub.getApp(t.appId);this.typeCodeItems=s.codeList.getCodeList("Config__FDLogicType").codeItems}newEntity(e){return e instanceof ht?e.clone():new ht(this.model,e,this.typeCodeItems)}}e("default",{install(e){w.register("formdesign.psdeformdetail",(async(e,t)=>new di(e,t))),w.register("formdesign.psdefdlogic",(async(e,t)=>new mi(e,t))),e.use(ci),e.use(ai),e.use(A),e.use(Be),e.use(Ue),e.use(Ut),e.use(Ws),e.use(si),I("VIEW_CUSTOM_DndDesign",(()=>new Ce)),I("VIEW_CUSTOM_DndDesign_DESIGN",(()=>new Ce)),I("VIEW_CUSTOM_FORM_PREVIEW_VIEW",(()=>new Se)),D("EDITOR_CUSTOMSTYLE_EditorParamCustom",(()=>new Le))}})}}}));
